+++
date = '2025-10-25T11:40:46+02:00'
draft = false
title = 'xray+realityé…ç½®æŒ‡å—'
+++

ç»“åˆå®˜æ–¹ç»™çš„å°å°ç™½å­¦ä¹ æ–‡æ¡£(https://xtls.github.io/document/level-0/ch05-webpage.html / https://xtls.github.io/document/level-0/ch06-certificates.html / https://xtls.github.io/document/level-0/ch07-xray-server.html / https://xtls.github.io/document/level-0/ch08-xray-clients.html)ï¼Œå°†ä¼˜åŒ–ã€å®‰å…¨çš„å†…å®¹åŠ å…¥æ¯æ­¥æ“ä½œæŒ‡å—ï¼Œæ ‡æ³¨å®¹æ˜“å‡ºé”™çš„åœ°æ–¹ï¼Œé‡ç‚¹éœ€å…³æ³¨å†…å®¹ï¼Œå‡ºä¸ª**éƒ¨ç½²xray+realityå…¨é¢æŒ‡å—**ï¼ˆé™„å½•å¤šç”¨æˆ·å¦‚ä½•é…ç½®ï¼Œä¿®æ”¹å“ªéƒ¨åˆ†ï¼‰ï¼š

## GPT:

ä»¥ä¸‹æ˜¯ä¸€ä¸ªåŸºäºå®˜æ–¹â€œå°å°ç™½ç™½è¯æ–‡â€ç³»åˆ—ï¼ˆç¬¬5~8ç« ï¼‰å†…å®¹æ•´åˆã€å¹¶åŠ å…¥å®æˆ˜ä¼˜åŒ–ä¸å®‰å…¨æç¤ºçš„ **ã€ŒXray + Reality ä¸€é”®éƒ¨ç½²ä¸å¤šç”¨æˆ·é…ç½®å…¨é¢æŒ‡å—ï¼ˆMarkdownç‰ˆï¼‰ã€**ã€‚  
é€‚ç”¨äºï¼š**Debian 12/13 VPSï¼Œè‡ªæœ‰åŸŸåï¼Œå·²å®‰è£… Nginxã€‚**

å¥½çš„ï¼Œä¸‹é¢æˆ‘ä¸ºä½ æ¢³ç†ä¸€ä¸ª**â€œä»é›¶åˆ°ä¸€â€å…¨é¢éƒ¨ç½² Xrayâ€‘core + Realty ï¼ˆRealityï¼‰æ–¹å¼ï¼Œä½¿ç”¨è‡ªæœ‰åŸŸåã€ä¼ªè£…ç½‘ç«™ã€å®‰å…¨ä¼˜åŒ–ã€å¤šç”¨æˆ·æ”¯æŒ**çš„æ“ä½œæŒ‡å—ã€‚å…¨ç¨‹ç”¨â€œå°å°ç™½ç™½è¯æ–‡â€è¯´æ˜ï¼Œå¹¶åœ¨æ¯ä¸€æ­¥æ ‡æ³¨ **å®¹æ˜“å‡ºé”™çš„åœ°æ–¹ï¼é‡ç‚¹å…³æ³¨é¡¹**ã€‚ä½ å¯ä»¥æŒ‰é¡ºåºæ“ä½œæˆ–ä¿å­˜ä¸ºæ–‡æ¡£å¤‡ç”¨ã€‚

---

## ğŸ“˜ å‚è€ƒæ–‡æ¡£

- ç¬¬ 5 ç« ï¼šç½‘ç«™å»ºè®¾ç¯‡ â€” [å®˜æ–¹æ–‡æ¡£](https://xtls.github.io/document/level-0/ch05-webpage.html)
    
- ç¬¬ 6 ç« ï¼šè¯ä¹¦ç®¡ç†ç¯‡ â€” [å®˜æ–¹æ–‡æ¡£](https://xtls.github.io/document/level-0/ch06-certificates.html)
    
- ç¬¬ 7 ç« ï¼šXray æœåŠ¡å™¨ç¯‡ â€” [å®˜æ–¹æ–‡æ¡£](https://xtls.github.io/document/level-0/ch07-xray-server.html)
    
- ç¬¬ 8 ç« ï¼šXray å®¢æˆ·ç«¯ç¯‡ â€” [å®˜æ–¹æ–‡æ¡£](https://xtls.github.io/document/level-0/ch08-xray-clients.html)
    

æˆ‘å°†åœ¨æ¯ä¸€æ­¥ç»“åˆä¸Šè¿°æ–‡æ¡£å†…å®¹ + ä¼˜åŒ–ã€å®‰å…¨è¯´æ˜ã€‚

---

## ğŸ§± éƒ¨ç½²ç¯å¢ƒå‡è®¾

åœ¨æ“ä½œå‰ï¼Œè¯·ç¡®è®¤ä»¥ä¸‹æ¡ä»¶ï¼š

- VPS æ“ä½œç³»ç»Ÿä¸º Debian 13ï¼ˆæˆ–ç±»ä¼¼ Linux ç¯å¢ƒï¼‰ä¸”ä½ å·²é€šè¿‡ SSH ç™»å½•ä¸º root æˆ–å…·æœ‰ sudo æƒé™ã€‚
    
- ä½ æ‹¥æœ‰ä¸€ä¸ªåŸŸåï¼ˆä¾‹å¦‚ `example.com`ï¼‰ï¼Œä¸”å·²å°†åŸŸåçš„ A è®°å½•è§£æåˆ°äº†ä½ çš„ VPS å…¬ç½‘ IPã€‚
    
- Nginx å·²ç»å®‰è£…ï¼ˆä½†å¯ä»¥æŒ‰æŒ‡å—é‡æ–°é…ç½®ï¼‰ã€‚
    
- ä½ çŸ¥é“å¦‚ä½•ç”¨ç¼–è¾‘å™¨ï¼ˆå¦‚ nano æˆ– vimï¼‰ä¿®æ”¹æ–‡ä»¶ã€å¦‚ä½•é‡å¯æœåŠ¡ã€‚
    

---

# 1. ç½‘ç«™å»ºè®¾ï¼ˆç¬¬ 5 ç« ï¼‰â€”â€” ç”¨ä½œä¼ªè£…çš„é™æ€ç«™ç‚¹

## 1.1æ“ä½œæ­¥éª¤

1. åˆ›å»ºä¸€ä¸ªç½‘ç«™ä¸“ç”¨æ–‡ä»¶å¤¹ï¼š
    
    ```bash
    # åˆ›å»ºç½‘ç«™ç›®å½•
    mkdir -p /home/webuser/www/webpage
    ```
2. åˆ›å»ºä¸€ä¸ªç®€å•çš„ `index.html` æ–‡ä»¶ï¼š
```bash
cat >/home/webuser/www/webpage/index.html <<'EOF'
<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><title>Welcome</title></head><body><h1>Hello from example.com</h1><p>This is a secure static page.</p></body></html>
EOF
```
    
3. é…ç½® Nginxï¼Œä½¿å…¶å“åº”ä½ çš„åŸŸåï¼ˆå…ˆ HTTPï¼Œå† HTTPS åç»­ï¼‰ï¼š  
    åœ¨ `/etc/nginx/sites-available/example.com`ï¼š
    
    ```nginx
    server {
        listen 80;
        server_name example.com www.example.com;
    
        root /home/webuser/www/webpage;
        index index.html;
    
        # ğŸ§° å®‰å…¨ä¼˜åŒ–é¡¹
        add_header X-Frame-Options "SAMEORIGIN";
        add_header X-Content-Type-Options "nosniff";
        add_header Referrer-Policy "no-referrer-when-downgrade";
        add_header X-XSS-Protection "1; mode=block";
            
        location / {
          try_files $uri $uri/ =404;
        }
    }
    ```
    
    ç„¶åå¯ç”¨å¹¶é‡è½½ï¼š
    
    ```bash
    sudo ln -s /etc/nginx/sites-available/example.com /etc/nginx/sites-enabled/
    sudo nginx -t && sudo systemctl reload nginx
    ```
    
    **é‡ç‚¹ï¼æ˜“é”™**ï¼š
    
    - ç¡®ä¿ `server_name` ä¸å®é™…åŸŸåä¸€è‡´ï¼ˆåŒ…æ‹¬ `www.` å¦‚æœä½ ç”¨çš„è¯ï¼‰ã€‚
        
    - `root` è·¯å¾„å¿…é¡»ä¸ºåˆšæ‰ webuser æ‰€åœ¨ç›®å½•ã€‚
        
    - æ£€æŸ¥ `nginx -t` æ˜¯å¦æŠ¥é”™ï¼Œè‹¥æœ‰æƒé™æˆ–è·¯å¾„é—®é¢˜éœ€ä¿®æ­£ã€‚
        
4. åœ¨æµè§ˆå™¨è®¿é—® `http://example.com` åº”èƒ½çœ‹åˆ°ä½ çš„æ¬¢è¿é¡µé¢ã€‚è‹¥çœ‹ä¸åˆ°ï¼Œå…ˆä¸è¦åšåç»­è¯ä¹¦æˆ– Xrayï¼Œå…ˆæå¥½ç½‘ç«™éƒ¨åˆ†ã€‚
    

## 1.2ä¼˜åŒ–å»ºè®®

- è™½ç„¶è¿™ä¸ªç½‘ç«™åªæ˜¯ä¼ªè£…ç”¨é€”ï¼Œä½†ä»å»ºè®®å¯ç”¨åŸºç¡€å®‰å…¨å¤´ï¼ˆå¦‚ä¸Šå·²åŠ ï¼‰ã€‚
    
- ç¦æ­¢ç›®å½•åˆ—è¡¨ï¼ˆé»˜è®¤ `autoindex off` å³å¯ï¼‰ã€‚
    
- æ—¥å¿—è·¯å¾„å»ºè®®é…ç½®ï¼ˆå¦‚ `/var/log/nginx/example.com.access.log`ï¼‰ï¼Œä¾¿äºä»¥åç›‘æ§å¼‚å¸¸è®¿é—®ã€‚
    

## 1.3æ’æ’­æ’é”™æ–°é—»ï¼Œå“ˆå“ˆ

å¯¹ï¼Œè¿™ä¸ª404æ‰¾ä¸åˆ°æ–‡ä»¶çš„æŠ¥é”™ä¿¡æ¯

```
[crit] stat() "/home/webuser/www/webpage/" failed (13: Permission denied)
```

è¯´æ˜ **Nginx è¿›ç¨‹ï¼ˆé€šå¸¸ä»¥ `www-data` ç”¨æˆ·è¿è¡Œï¼‰æ— æ³•è®¿é—®è¯¥ç›®å½•**ï¼Œè™½ç„¶ä½ æŠŠæ–‡ä»¶å±ä¸»è®¾ä¸º `www-data`ï¼Œä½†è¿˜æœ‰ä¸€ä¸ªå¸¸è¢«å¿½ç•¥çš„å…³é”®ç‚¹ï¼š**ä¸Šçº§ç›®å½•æƒé™ç»§æ‰¿é—®é¢˜**ã€‚

---

### ğŸ” é—®é¢˜åŸå› 

å³ä½¿ `/home/webuser/www/webpage` çš„æƒé™æ˜¯ `www-data` æ‹¥æœ‰å¹¶ä¸”æ˜¯ `755`ï¼Œ  
å¦‚æœä¸Šçº§ç›®å½• `/home` æˆ– `/home/webuser` **å¯¹ `www-data` ç”¨æˆ·ä¸å¯æ‰§è¡Œï¼ˆæ²¡æœ‰ `x` æƒé™ï¼‰**ï¼Œ  
Nginx ä»ç„¶æ— æ³•è¿›å…¥è¯¥è·¯å¾„ã€‚

---

### âœ… æ£€æŸ¥å¹¶ä¿®å¤æ–¹æ³•

#### 1ï¸âƒ£ æ£€æŸ¥æ•´ä¸ªè·¯å¾„æƒé™

æ‰§è¡Œï¼š

```bash
ls -ld /home /home/webuser /home/webuser/www /home/webuser/www/webpage
```

æŸ¥çœ‹ç»“æœä¸­çš„æƒé™åˆ—ï¼Œä¾‹å¦‚ï¼š

```
drwx------  5 webuser webuser 4096 Oct 25  /home/webuser
```

> å¦‚æœ `/home/webuser` æ˜¯ `drwx------`ï¼Œåˆ™åªæœ‰ webuser è‡ªå·±èƒ½è®¿é—®ï¼Œwww-data æ— æ³•è¿›å…¥ã€‚

---

#### 2ï¸âƒ£ ä¿®å¤æƒé™ï¼ˆæ¨èæ–¹æ¡ˆä¹‹ä¸€ï¼‰

æœ€ç®€å•çš„æ–¹å¼æ˜¯ç»™ä¸Šå±‚ç›®å½•å¢åŠ â€œæ‰§è¡Œâ€æƒé™è®© web æœåŠ¡èƒ½è®¿é—®è·¯å¾„ï¼š

```bash
sudo chmod o+x /home/webuser
```

è¿™æ ·ä¸ä¼šæš´éœ²å†…å®¹ï¼Œåªå…è®¸â€œå¯ä»¥è¿›å…¥ç›®å½•â€ã€‚

---

#### 3ï¸âƒ£ ï¼ˆå¯é€‰ï¼‰æ›´å®‰å…¨æ–¹æ¡ˆï¼š

è‹¥ä½ æƒ³ä¿æŒ `/home/webuser` å°½é‡ç§æœ‰ï¼Œä¹Ÿå¯ä»¥åªå»ºç«‹ä¸€ä¸ª Nginx å¯è®¿é—®çš„è·¯å¾„ï¼Œå¦‚ï¼š

```bash
sudo mkdir -p /var/www/example.com
sudo chown -R www-data:www-data /var/www/example.com
sudo chmod -R 755 /var/www/example.com
```

ç„¶åä¿®æ”¹ Nginx é…ç½®æ–‡ä»¶ï¼š

```nginx
root /var/www/example.com;
```

è¿™ç§ç»“æ„æ˜¯ç”Ÿäº§ç¯å¢ƒæ›´æ¨èçš„æ–¹å¼ï¼Œå› ä¸ºï¼š

- `/var/www/` ä¸“ç”¨äºç½‘ç«™ï¼›
    
- `/home` ä¸‹ç›®å½•é€šå¸¸ç”¨äºä¸ªäººè´¦æˆ·ï¼Œä¸å»ºè®® nginx è®¿é—®ã€‚
    

---

### âš ï¸ æ€»ç»“é‡ç‚¹

|é¡¹ç›®|æ­£ç¡®çŠ¶æ€|
|---|---|
|Nginx è¿è¡Œç”¨æˆ·|www-data|
|ç½‘ç«™ç›®å½•å±ä¸»|www-data|
|ç½‘ç«™ç›®å½•æƒé™|755|
|ä¸Šçº§ç›®å½•æƒé™|è‡³å°‘ o+x|
|é…ç½®æ–‡ä»¶ root è·¯å¾„|ä¸å®é™…ç½‘ç«™ç›®å½•ä¸€è‡´|

---

ä½ å¯ä»¥å…ˆè´´ä¸€ä¸‹æ‰§è¡Œï¼š

```bash
ls -ld /home /home/webuser /home/webuser/www /home/webuser/www/webpage
```

æˆ‘å¸®ä½ çœ‹å“ªä¸€å±‚æƒé™å¡ä½ã€‚

ls: cannot access '/home/webuser/www/webpage': Permission denied
drwxr-xr-x 3 root     root     4096 Oct 25 22:47 /home
drwx------ 5 webuser     webuser     4096 Oct 25 22:16 /home/webuser
drwxr-x--- 3 www-data www-data 4096 Oct 25 22:16 /home/webuser/www

å®Œç¾ï¼Œè¿™ä¸ªè¾“å‡ºå°±èƒ½ç²¾å‡†å®šä½é—®é¢˜äº†ğŸ‘‡

---

### ğŸš¨ å…³é”®ç‚¹

é—®é¢˜å‡ºåœ¨è¿™é‡Œï¼š

```
drwx------ 5 webuser webuser 4096 Oct 25 22:16 /home/webuser
```

è§£é‡Šï¼š

- `/home/webuser` æƒé™æ˜¯ **`700`ï¼ˆdrwx------ï¼‰**ï¼›
    
- è¿™æ„å‘³ç€åªæœ‰ç”¨æˆ· `webuser` èƒ½è®¿é—®è¿™ä¸ªç›®å½•ï¼›
    
- è€Œä½ çš„ Nginx æ˜¯ç”¨ `www-data` ç”¨æˆ·è¿è¡Œï¼›
    
- æ‰€ä»¥å³ä½¿ `/home/webuser/www` å’Œ `/home/webuser/www/webpage` éƒ½æ˜¯ `www-data` çš„ï¼Œ  
    Nginx ä»ç„¶â€œèµ°ä¸è¿›â€ `/home/webuser` â†’ æƒé™è¢«æŒ¡ä½ã€‚
    

---

### âœ… è§£å†³æ–¹æ¡ˆ 1ï¼ˆæœ€ç›´æ¥ã€æ¨èï¼‰

åªéœ€ç»™ `/home/webuser` å¢åŠ â€œæ‰§è¡Œâ€æƒé™ï¼ˆè¡¨ç¤ºå…è®¸å…¶ä»–ç”¨æˆ·è¿›å…¥ç›®å½•ï¼Œä½†ä¸èƒ½è¯»å†™ï¼‰ï¼š

```bash
sudo chmod o+x /home/webuser
```

æ‰§è¡Œåå†ç¡®è®¤ï¼š

```bash
ls -ld /home/webuser
```

åº”è¯¥å˜æˆï¼š

```
drwx--x--x 5 webuser webuser 4096 Oct 25 22:16 /home/webuser
```

ç„¶åé‡æ–°åŠ è½½ nginxï¼š

```bash
sudo systemctl reload nginx
```

å†è®¿é—®ç½‘ç«™ï¼Œåº”è¯¥å°±æ­£å¸¸æ‰“å¼€äº† âœ…

---

### âš™ï¸ åŸç†è¯´æ˜

- `x` è¡¨ç¤ºâ€œå¯è¿›å…¥ç›®å½•â€ï¼›
    
- æ²¡æœ‰ `x` æƒé™æ—¶ï¼ŒNginx æ— æ³•æ‰§è¡Œ `stat()` æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼›
    
- åªç»™ `o+x` ä¸ä¼šæ³„éœ²éšç§å†…å®¹ï¼Œå› ä¸ºä»ç„¶æ— æ³• `ls` ç›®å½•æˆ–è¯»æ–‡ä»¶ï¼Œåªèƒ½è¿›å…¥ã€‚
    

---

### âœ… è§£å†³æ–¹æ¡ˆ 2ï¼ˆæ›´è§„èŒƒçš„ç»“æ„ï¼‰

å¦‚æœä½ åç»­å‡†å¤‡å¤šç«™ç‚¹éƒ¨ç½²æˆ–æ­£å¼ä¸Šçº¿ï¼Œæ¨èè¿ç§»åˆ°ï¼š

```bash
sudo mkdir -p /var/www/example.com
sudo rsync -a /home/webuser/www/webpage/ /var/www/example.com/
sudo chown -R www-data:www-data /var/www/example.com
sudo chmod -R 755 /var/www/example.com
```

ç„¶åä¿®æ”¹ nginx é…ç½®ï¼š

```nginx
root /var/www/example.com;
```

è¿™å¯ä»¥é¿å… `/home` è¢« web æœåŠ¡è®¿é—®ï¼Œæ›´å®‰å…¨ã€‚

## 1.4é‡ç‚¹æ¥äº†ï¼Œå®é™…éƒ¨ç½²çš„æ—¶å€™ï¼Œæˆ‘æ˜¯æŒ‰ç…§ä¸‹é¢æ¨èçš„

âœ… **æ˜¯çš„ï¼Œéå¸¸æ¨èä½¿ç”¨ç³»ç»Ÿé»˜è®¤ç›®å½• `/var/www` æ¥éƒ¨ç½²ç½‘ç«™ã€‚**  
ä¸‹é¢æ˜¯è¯¦ç»†åŸå› ä¸æ¨èå®è·µğŸ‘‡

---

### ğŸ’¡ ä¸ºä»€ä¹ˆæ¨è `/var/www` è€Œä¸æ˜¯ `/home/ç”¨æˆ·å/www`

#### 1ï¸âƒ£ æƒé™å®‰å…¨æ€§æ›´é«˜

- `/var/www` æ˜¯ä¸“é—¨ç»™ Web æœåŠ¡ï¼ˆå¦‚ Nginxã€Apacheï¼‰è®¾è®¡çš„ï¼›
    
- é»˜è®¤æƒé™é€‚åˆ `www-data` ç”¨æˆ·è®¿é—®ï¼›
    
- `/home/ç”¨æˆ·å` å±äºä¸ªäººå®¶ç›®å½•ï¼Œé»˜è®¤ **700**ï¼ˆä»…æœ¬äººå¯è®¿é—®ï¼‰ï¼›
    
    - å¯¹ Nginx æ¥è¯´å°±ä¼šæŠ¥ä½ åˆšé‡åˆ°çš„ â€œPermission deniedâ€ï¼›
        
    - å¦‚æœå¼€æ”¾å®¶ç›®å½•æƒé™ï¼Œå°±å¯èƒ½æ„å¤–æš´éœ²ä¸ªäºº SSHã€é…ç½®æ–‡ä»¶ã€‚
        

ğŸ” **æ€»ç»“**ï¼šç”¨ `/var/www` å¯é¿å…æš´éœ² home ç›®å½•ï¼Œç¬¦åˆ Linux å®‰å…¨è§„èŒƒã€‚

---

#### 2ï¸âƒ£ ç³»ç»Ÿç»´æŠ¤ä¸å¤‡ä»½æ›´æ–¹ä¾¿

- ç½‘ç«™éƒ¨ç½²åœ¨ `/var/www/` ä¸‹æ›´ç»Ÿä¸€ï¼›
    
- å¤‡ä»½æˆ–è¿ç§»æ—¶åªéœ€æ‰“åŒ… `/var/www`ï¼›
    
- æœªæ¥å¦‚æœä½ å¯ç”¨ `fail2ban`ã€`logrotate`ã€`certbot` ç­‰ï¼Œå®ƒä»¬éƒ½é»˜è®¤è¯†åˆ« `/var/www`ã€‚
    

---

#### 3ï¸âƒ£ é…åˆ Nginx é»˜è®¤ç»“æ„æ›´æ¸…æ™°

- `/etc/nginx/sites-available/` â†’ å­˜æ”¾ç«™ç‚¹é…ç½®ï¼›
    
- `/etc/nginx/sites-enabled/` â†’ å¯ç”¨çš„ç«™ç‚¹ï¼›
    
- `/var/www/åŸŸå/` â†’ å­˜æ”¾ç½‘ç«™æ–‡ä»¶ï¼›
    
- ä¸€ç›®äº†ç„¶ï¼Œæ ‡å‡†åˆå…¼å®¹å„ç§æ•™ç¨‹ã€‚
    

---

#### 4ï¸âƒ£ æƒé™æ¨èè®¾ç½®

```bash
sudo mkdir -p /var/www/example.com
sudo chown -R www-data:www-data /var/www/example.com
sudo chmod -R 755 /var/www/example.com
```

> âœ… `www-data` æ˜¯ Nginx è¿è¡Œç”¨æˆ·ï¼Œè´Ÿè´£è¯»å–ç½‘é¡µï¼›  
> ğŸ”’ `755` ä»£è¡¨ç›®å½•å¯è¢«è¿›å…¥ä½†ä¸èƒ½éšæ„å†™å…¥ï¼Œå®‰å…¨ä¸”å¸¸è§ã€‚

---

#### 5ï¸âƒ£ é…åˆ Xray + Reality æ›´ç®€æ´

- Reality é€šå¸¸åªéœ€æä¾›ä¸€ä¸ªä¼ªè£…ç«™ç‚¹ï¼›
    
- ç”¨ `/var/www/reality-fake` è¿™ç±»è·¯å¾„æ”¾é™æ€ç½‘é¡µå³å¯ï¼›
    
- ä¸ç”¨æ‹…å¿ƒ home ç›®å½•æƒé™æˆ–å±ä¸»é—®é¢˜ï¼›
    
- certbot / acme.sh è‡ªåŠ¨å†™ `.well-known/acme-challenge` æ—¶ä¹Ÿä¸ä¼šè¢«æ‹’ã€‚
    

---

#### âœ… æœ€ä½³å®è·µæ€»ç»“

| ç»„ä»¶            | æ¨èä½ç½®                                     | è¯´æ˜       |
| ------------- | ---------------------------------------- | -------- |
| Nginx ç«™ç‚¹é…ç½®    | `/etc/nginx/sites-available/example.com` | ä¸»é…ç½®æ–‡ä»¶    |
| ç«™ç‚¹æ–‡ä»¶ç›®å½•        | `/var/www/example.com`                   | å®é™…ç½‘é¡µå†…å®¹   |
| Xray é…ç½®       | `/usr/local/etc/xray/config.json`        | ä¸»ç¨‹åºé…ç½®    |
| ä¼ªè£…é¡µé¢ï¼ˆRealityï¼‰ | `/var/www/example.com`                   | éšè”½ä¸»é¡µæˆ–è·³è½¬é¡µ |

### 1.5æé—®ï¼šç”¨sudo cpå‘½ä»¤æŠŠindex.htmlæ–‡ä»¶æ‹·è´åˆ°ç½‘é¡µå­˜æ”¾ç›®å½•ï¼Œæ–‡ä»¶å±ä¸»æ˜¯rootï¼Œæ˜¯ä¸æ˜¯è¦æ”¹æˆwww-data

éå¸¸å¥½çš„é—®é¢˜ ğŸ‘ â€” ä½ çš„ç†è§£å®Œå…¨æ­£ç¡®ã€‚

---

#### âœ… ç®€çŸ­å›ç­”

æ˜¯çš„ï¼Œ**å»ºè®®æŠŠæ–‡ä»¶å±ä¸»æ”¹æˆ `www-data`**ã€‚  
å¦åˆ™è™½ç„¶ç½‘é¡µèƒ½æ˜¾ç¤ºï¼ˆæœ‰æ—¶æƒé™å¤Ÿè¯»ï¼‰ï¼Œä½†å¯èƒ½ï¼š

- åç»­è‡ªåŠ¨æ›´æ–°æˆ–å†™ `.well-known` æ–‡ä»¶ï¼ˆå¦‚ç”³è¯·è¯ä¹¦ï¼‰å¤±è´¥ï¼›
    
- éƒ¨åˆ†ç›®å½•æ— æ³•å†™å…¥æ—¥å¿—æˆ–ç¼“å­˜ï¼›
    
- å®‰å…¨ç­–ç•¥ï¼ˆå¦‚ SELinuxã€AppArmorï¼‰è®¤ä¸ºâ€œä¸å®‰å…¨è®¿é—®â€ã€‚
    

---

#### ğŸ” è¯¦ç»†è¯´æ˜

å½“ä½ æ‰§è¡Œï¼š

```bash
sudo cp index.html /var/www/example.com/
```

æ—¶ï¼Œé»˜è®¤å±ä¸»ä¼šæ˜¯ï¼š

```
-rw-r--r-- 1 root root 1234 Oct 25  index.html
```

å³ï¼šroot æ‹¥æœ‰ï¼Œå…¶ä»–ç”¨æˆ·ï¼ˆåŒ…æ‹¬ nginx çš„ `www-data`ï¼‰åªèƒ½è¯»å–ã€‚

è™½ç„¶ **Nginx é»˜è®¤åªéœ€è¯»å–æƒé™å³å¯æ˜¾ç¤ºé¡µé¢**ï¼Œä½†ä¸ºäº†ç³»ç»Ÿä¸€è‡´æ€§ã€åç»­è¯ä¹¦è‡ªåŠ¨æ›´æ–°æˆ–é™æ€ç«™ç‚¹æ„å»ºå®‰å…¨ï¼Œä»å»ºè®®è°ƒæ•´æ‰€æœ‰æƒã€‚

---

#### âœ… æ¨èå‘½ä»¤

å‡è®¾ä½ çš„ç½‘ç«™ç›®å½•æ˜¯ `/var/www/example.com`ï¼š

```bash
sudo chown -R www-data:www-data /var/www/example.com
sudo chmod -R 755 /var/www/example.com
```

è¿™ä¸¤è¡Œç¡®ä¿ï¼š

- `www-data`ï¼ˆNginxè¿è¡Œç”¨æˆ·ï¼‰å¯ä»¥è¯»å–ç½‘é¡µï¼›
    
- å…¶ä»–äººå¯æµè§ˆä½†ä¸èƒ½ä¿®æ”¹ï¼›
    
- å†™å…¥ `.well-known/acme-challenge` æ—¶ä¸ä¼šæŠ¥æƒé™é”™ã€‚
    

---

#### ğŸ§  é¢å¤–æç¤º

å¦‚æœä½ ç»å¸¸éœ€è¦å¤åˆ¶æˆ–éƒ¨ç½²ç½‘é¡µæ–‡ä»¶ï¼Œå¯ä»¥ï¼š

1. å…ˆåœ¨æœ¬åœ°å‡†å¤‡ï¼›
    
2. ä¸Šä¼ åç»Ÿä¸€è°ƒæ•´æƒé™ï¼š
    
    ```bash
    sudo chown -R www-data:www-data /var/www
    ```

---

# 2. è¯ä¹¦ç®¡ç†ï¼ˆç¬¬ 6 ç« ï¼‰â€”â€” ä¸ºåŸŸåç”³è¯· HTTPS è¯ä¹¦

### æ“ä½œæ­¥éª¤

## 2.1 å®‰è£… [acme.sh](https://github.com/acmesh-official/acme.sh)ï¼ˆè½»é‡ã€æ¨èï¼‰ï¼š
    
    ```bash
    wget -O - https://get.acme.sh | sh
	source ~/.bashrc
    acme.sh --upgrade --auto-upgrade
    ```
    
    **é‡ç‚¹ï¼æ˜“é”™**ï¼š å¦‚æœå·²æœ‰å…¶å®ƒ acme å®¢æˆ·ç«¯ï¼ˆcertbotï¼‰å¯èƒ½å†²çªã€‚è¿™é‡Œé‡‡ç”¨ acme.shã€‚
    
## 2. 2 ä½¿ç”¨æµ‹è¯•å‘½ä»¤éªŒè¯ï¼Œé¿å…åœ¨æœ¬åœ°é…ç½®æœ‰è¯¯æ—¶ï¼Œåå¤ç”³è¯·è¯ä¹¦å¤±è´¥ï¼Œè¶…è¿‡ Let's Encrypt çš„é¢‘ç‡ä¸Šé™ï¼š
    
    ```bash
    acme.sh --issue --server letsencrypt_test -d example.com -d www.example.com -w /var/www/example.com --keylength ec-256
    ```
    
## 2.3 ä½¿ç”¨ webroot æ¨¡å¼ç­¾å‘ ECC è¯ä¹¦ï¼ˆæ¨è ec-256ï¼‰ï¼š
    
    ```bash
    acme.sh --issue -d example.com -d www.example.com -w /var/www/example.com --keylength ec-256
    ```
    
    **é‡ç‚¹ï¼æ˜“é”™**ï¼š
    
    - `-w` å‚æ•°å¿…é¡»æŒ‡å‘ç½‘ç«™æ ¹ç›®å½•ä¸”ç½‘ç«™å¿…é¡»å¯ä» Web è®¿é—®ï¼ˆå¦åˆ™éªŒè¯å¤±è´¥ï¼‰ã€‚
    - åŸŸåè§£æå¿…é¡»æ­£ç¡®ã€‚
    - æµ‹è¯•è¯ä¹¦ç”³è¯·ä»‹ç»è¯·çœ‹å®˜æ–¹æ–‡æ¡£

## 2.4è·å–è¯ä¹¦æŠ¥é”™ï¼Œmkdir: cannot create directory '/var/www/example.com/.well-known': Permission denied

éå¸¸å¥½ï¼Œè¿™ä¸ªé”™è¯¯æ˜¯ **è¯ä¹¦è‡ªåŠ¨ç­¾å‘æœ€å¸¸è§çš„å‘ä¹‹ä¸€**ã€‚  
æˆ‘ä»¬æ¥é€æ­¥åˆ†æå¹¶è§£å†³ğŸ‘‡

---

### ğŸš¨ æŠ¥é”™è¯´æ˜

```
mkdir: cannot create directory '/var/www/example.com/.well-known': Permission denied
```

æ„æ€æ˜¯ï¼š

> è¯ä¹¦ç”³è¯·ç¨‹åºï¼ˆacme.sh æˆ– certbotï¼‰å°è¯•åœ¨ç½‘ç«™æ ¹ç›®å½•ä¸‹åˆ›å»ºéªŒè¯æ–‡ä»¶  
> `/var/www/example.com/.well-known/acme-challenge/...`  
> ä½†æ²¡æœ‰å†™å…¥æƒé™ã€‚

---

### ğŸ’¡ èƒŒååŸç†

Let's Encrypt éªŒè¯åŸŸåæ—¶ï¼Œä¼šè®¿é—®ï¼š

```
http://ä½ çš„åŸŸå/.well-known/acme-challenge/<token>
```

acme.sh ä¼šåœ¨ä½ çš„ç½‘ç«™æ ¹ç›®å½•è‡ªåŠ¨åˆ›å»ºè¿™ä¸ªè·¯å¾„ï¼š

```
/var/www/example.com/.well-known/acme-challenge/
```

å¦‚æœ Nginx çš„ web æ ¹ç›®å½•æ˜¯ `/var/www/example.com`ï¼Œ  
é‚£ `acme.sh` éœ€è¦å¯¹è¿™ä¸ªç›®å½• **æœ‰å†™å…¥æƒé™**ã€‚

---

### **è§£å†³æ–¹æ³•ï¼šç»™ `acme.sh` ä½¿ç”¨çš„ç”¨æˆ·å†™å…¥æƒé™**

å¦‚æœä½ ç”¨çš„æ˜¯å½“å‰æ™®é€šç”¨æˆ·ï¼ˆå¦‚ `webuser`ï¼‰è¿è¡Œå‘½ä»¤ï¼š

```bash
acme.sh --issue -d example.com -w /var/www/example.com
```

å°±éœ€è¦è®© `webuser` ç”¨æˆ·èƒ½å†™å…¥ï¼š

```bash
sudo chown -R webuser:www-data /var/www/example.com
```

> ğŸ”¹ ç»„è®¾ä¸º `www-data` å¯å…¼å®¹ Nginxï¼›  
> ğŸ”¹ acme.sh è¿è¡Œç”¨æˆ· `webuser` ä¹Ÿèƒ½åˆ›å»º `.well-known`ã€‚

## 2.5 æ‰©å±•çŸ¥è¯†ï¼šï¼ˆ`.acme.sh/example.com_ecc/` å„æ–‡ä»¶ä½œç”¨è¯´æ˜ï¼‰

è¿™äº›æ–‡ä»¶æ˜¯ç”± **acme.sh** è‡ªåŠ¨ç”Ÿæˆå’Œç»´æŠ¤çš„ï¼Œå®ƒä»¬å­˜æ”¾äº†åŸŸåè¯ä¹¦çš„å…¨éƒ¨å…³é”®ææ–™ã€‚  
ä½ ç°åœ¨çœ‹åˆ°çš„ `.acme.sh/example.com_ecc/` ç›®å½•å±äº **Let's Encrypt ECDSAï¼ˆæ¤­åœ†æ›²çº¿ï¼‰è¯ä¹¦**ï¼Œä¸‹é¢æˆ‘å¸®ä½ ä¸€ä¸€è§£é‡Šï¼š

---

### ğŸ“‚ `.acme.sh/example.com_ecc/` å„æ–‡ä»¶ä½œç”¨è¯´æ˜

| æ–‡ä»¶å                            | ä½œç”¨                                                              | æ˜¯å¦é‡è¦    | å»ºè®®æ“ä½œ                                   |
| ------------------------------ | --------------------------------------------------------------- | ------- | -------------------------------------- |
| **`ca.cer`**                   | è¿™æ˜¯ **CAï¼ˆç­¾å‘æœºæ„ï¼‰æ ¹è¯ä¹¦**ï¼Œä¹Ÿå«ä¸­é—´è¯ä¹¦ã€‚ç”¨äºå»ºç«‹ä¿¡ä»»é“¾ã€‚                              | âœ…       | é€šå¸¸ä¸éœ€è¦å•ç‹¬ä½¿ç”¨ï¼Œç”± fullchain.cer è‡ªåŠ¨åŒ…å«ã€‚        |
| **`example.com.cer`**          | åŸŸåçš„ **æœåŠ¡å™¨è¯ä¹¦**ï¼Œç”± Let's Encrypt ä¸ºä½ ç­¾å‘ã€‚ä»…åŒ…å«ä½ çš„åŸŸåå…¬é’¥éƒ¨åˆ†ã€‚                 | âœ…       | ä¸ `.key` é…å¯¹ä½¿ç”¨ï¼ˆå…¬é’¥+ç§é’¥ï¼‰ã€‚                  |
| **`example.com.key`**          | ä½ çš„ **ç§é’¥**ï¼Œç­¾å‘è¯ä¹¦æ—¶ç”Ÿæˆçš„ï¼Œéå¸¸é‡è¦ã€‚                                        | ğŸ”¥ æé‡è¦  | ç»å¯¹ä¸è¦å¤–æ³„ã€‚é…åˆ `.cer` æˆ– `fullchain.cer` ä½¿ç”¨ã€‚ |
| **`fullchain.cer`**            | **å®Œæ•´è¯ä¹¦é“¾**ï¼šæŠŠ `example.com.cer` + `ca.cer` åˆå¹¶èµ·æ¥ï¼ŒåŒ…å«ä½ çš„åŸŸåè¯ä¹¦ + ä¸­é—´ CAã€‚ | âœ… æ¨èä½¿ç”¨  | ä¸€èˆ¬åœ¨ Nginx/Apache/Xray é‡Œç›´æ¥ç”¨è¿™ä¸ªã€‚          |
| **`example.com.csr`**          | Certificate Signing Requestï¼Œè¯ä¹¦ç­¾åè¯·æ±‚æ–‡ä»¶ã€‚                           | âš™ï¸ è¾…åŠ©æ–‡ä»¶ | ç”± `.csr.conf` ç”Ÿæˆï¼Œç”¨æ¥å‘ CA è¯·æ±‚ç­¾å‘ã€‚å¹³æ—¶å¯å¿½ç•¥ã€‚    |
| **`example.com.csr.conf`**     | ç”Ÿæˆ `.csr` æ—¶ä½¿ç”¨çš„é…ç½®æ¨¡æ¿ã€‚                                             | âš™ï¸      | é‡Œé¢è®°å½•äº†åŸŸåã€å¯†é’¥ç®—æ³•ç­‰ã€‚                         |
| **`example.com.conf`**         | acme.sh è‡ªåŠ¨ç”Ÿæˆçš„åŸŸåé…ç½®æ–‡ä»¶ï¼Œè®°å½•äº†ç»­ç­¾ä¿¡æ¯ã€DNS API ç­‰ã€‚                          | âœ…       | acme.sh ç»­æœŸä»»åŠ¡ä¾èµ–æ­¤æ–‡ä»¶ã€‚ä¸è¦åˆ ã€‚                 |
| **`example.com.conf.removed`** | è¢« acme.sh æ ‡è®°ä¸ºâ€œæ— æ•ˆ/æ—§ç‰ˆâ€çš„é…ç½®æ–‡ä»¶å¤‡ä»½ã€‚                                    | ğŸ—‘ï¸ å¯åˆ   | è¡¨ç¤ºæ›¾ç»çš„é…ç½®è¢«æ›¿æ¢ã€‚                            |


---

### ğŸ“˜ å®é™…ä½¿ç”¨ä¸­å¸¸è§æ–‡ä»¶ç»„åˆ

| ä½¿ç”¨åœºæ™¯                       | æ‰€éœ€æ–‡ä»¶                                | ç¤ºä¾‹é…ç½®                                                                                                                                |
| -------------------------- | ----------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------- |
| **Nginx / Apache / Caddy** | `fullchain.cer` + `example.com.key` | `ssl_certificate /home/webuser/.acme.sh/example.com_ecc/fullchain.cer; ssl_certificate_key /home/webuser/.acme.sh/example.com_ecc/example.com.key;` |
| **Xray / VLESS-TLS æ¨¡å¼**    | åŒä¸Šä¸¤æ–‡ä»¶                               | åœ¨ `"certificateFile"`ã€`"keyFile"` å¡«å†™å¯¹åº”è·¯å¾„                                                                                            |
| **Reality æ¨¡å¼**             | âŒ ä¸éœ€è¦è¯ä¹¦æ–‡ä»¶                           | Reality å†…éƒ¨é€šè¿‡åŠ å¯†æ¡æ‰‹æ¨¡æ‹Ÿ TLSï¼Œæ— éœ€å¤–éƒ¨è¯ä¹¦                                                                                                       |

---

### âš ï¸ å®¹æ˜“å‡ºé”™ä¸æ³¨æ„äº‹é¡¹

1. **æ–‡ä»¶æƒé™é—®é¢˜**
    
    - `.key` æ–‡ä»¶æƒé™åº”å°½é‡æ”¶ç´§ï¼Œä¾‹å¦‚ï¼š
        
        ```bash
        sudo chmod 600 ~/.acme.sh/example.com_ecc/example.com.key
        ```
        
    - é˜²æ­¢ Nginx/Xray æ— æ³•è¯»å–æ—¶ï¼Œå¯æˆäºˆ www-data è¯»æƒé™ï¼š
        
        ```bash
        sudo chown root:www-data ~/.acme.sh/example.com_ecc/example.com.key
        sudo chmod 640 ~/.acme.sh/example.com_ecc/example.com.key
        ```
        
2. **è·¯å¾„å¼•ç”¨é”™è¯¯**
    
    - ä¸è¦ç”¨ `/etc/ssl/` ç›®å½•çš„æ—§è¯ä¹¦ï¼Œacme.sh ç»­æœŸåä¸ä¼šè‡ªåŠ¨åŒæ­¥ã€‚
        
    - æ¨èåœ¨ `acme.sh --install-cert` æ—¶æŒ‡å®šç»Ÿä¸€å®‰è£…è·¯å¾„ï¼Œä¾‹å¦‚ï¼š
        
        ```bash
        acme.sh --install-cert -d example.com \
          --key-file /etc/ssl/private/example.com.key \
          --fullchain-file /etc/ssl/cert/fullchain.cer
        ```
        
3. **Reality æ¨¡å¼ä¸éœ€è¦è¯ä¹¦**
    
    - å¦‚æœä½ åç»­å·²æ”¹ç”¨ Realityï¼Œ`.acme.sh` ä»…ç”¨ä½œä¼ªè£…ç«™ HTTPSï¼Œç”¨äºâ€œä¼ªæ­£å¸¸ç½‘ç«™â€åœºæ™¯ï¼Œä¸å½±å“ Reality é€šä¿¡ã€‚
        

---

## 2.6 å®‰è£…è¯ä¹¦åˆ°ç³»ç»Ÿå¯å…±ç”¨è·¯å¾„ï¼ˆä¾› Nginx + Xray ä½¿ç”¨ï¼‰ï¼š

### ï¼ˆä¸‹é¢çš„é…ç½®åœ¨å®æ“ä¸­å‘ç°æœ‰ç‚¹é—®é¢˜ï¼Œä¿®æ”¹æˆåé¢çš„æ–¹æ¡ˆã€‚ï¼‰

```bash
sudo acme.sh --install-cert -d example.com -d www.example.com \
  --key-file /etc/ssl/private/example.com.key \
  --fullchain-file /etc/ssl/cert/fullchain.cer \
  --ecc
chmod 600 /etc/ssl/private/example.com.key
```
   
**é‡ç‚¹ï¼æ˜“é”™**ï¼šè¯ä¹¦è·¯å¾„æƒé™ä¸€å®šè¦æ­£ç¡®ï¼Œå¦åˆ™ Nginx æˆ– Xray æ— æ³•è¯»è¯ä¹¦ã€å¯åŠ¨å¤±è´¥ã€‚

---

### 2.6.1 æé—®ï¼š

ä½ é—®åˆ°äº† **acme.sh æœ€å…³é”®çš„éƒ¨åˆ†ä¹‹ä¸€ï¼š`--install-cert` çš„è§„èŒƒåŒ–é…ç½®**ã€‚  
è¿™ä¸€æ­¥ç›´æ¥å½±å“è¯ä¹¦è‡ªåŠ¨ç»­æœŸã€nginx è‡ªåŠ¨åŠ è½½ã€å®‰å…¨æ€§æ˜¯å¦åˆæ ¼ã€‚

ä¸‹é¢æ˜¯è¯¦ç»†æ¨èåšæ³•ğŸ‘‡

---

#### ğŸ§­ ä¸€ã€ç†è§£ `acme.sh --install-cert` çš„ä½œç”¨

`acme.sh --install-cert` å¹¶ä¸æ˜¯ç­¾å‘è¯ä¹¦ï¼Œè€Œæ˜¯ï¼š

> æŠŠç­¾å‘å®Œæˆçš„è¯ä¹¦ **å¤åˆ¶åˆ°ç³»ç»Ÿæ ‡å‡†ç›®å½•**ï¼Œ  
> å¹¶é…ç½®è‡ªåŠ¨ç»­æœŸæ—¶çš„æ›´æ–°åŠ¨ä½œï¼ˆå¦‚ reload nginxï¼‰ã€‚

ä¹Ÿå°±æ˜¯è¯´ï¼š

- `--issue`ï¼šè´Ÿè´£ç”³è¯·è¯ä¹¦ï¼›
    
- `--install-cert`ï¼šè´Ÿè´£â€œéƒ¨ç½²â€è¯ä¹¦ã€‚
    

---

#### ğŸ— äºŒã€æ¨èçš„ç›®å½•ç»“æ„ï¼ˆLinux è§„èŒƒè·¯å¾„ï¼‰

| ç±»å‹                | æ¨èè·¯å¾„                               | æƒé™    |
| ----------------- | ---------------------------------- | ----- |
| ç§é’¥ï¼ˆkeyï¼‰           | `/etc/ssl/private/example.com.key` | `600` |
| è¯ä¹¦ï¼ˆcrt/fullchainï¼‰ | `/etc/ssl/certs/fullchain.cer`     | `644` |
| ä¸­é—´è¯ä¹¦ï¼ˆå¯é€‰ï¼‰          | `/etc/ssl/certs/ca.crt`            | `644` |

> âœ… `/etc/ssl/private` ç›®å½•é»˜è®¤åªæœ‰ root å¯è¯»ï¼›  
> âœ… `/etc/ssl/certs` åˆ™å¯è¢« nginx ç­‰ç¨‹åºè¯»å–ï¼›  
> âš ï¸ ä¸å»ºè®®æ”¾åœ¨ `/home/webuser/.acme.sh/` å†…ä½¿ç”¨ï¼Œacme.sh æ›´æ–°æ—¶å¯èƒ½åˆ é™¤æ—§æ–‡ä»¶ã€‚

---

#### âš™ï¸ ä¸‰ã€æ¨èå‘½ä»¤æ¨¡æ¿

ä¸‹é¢æ˜¯ä¸€ä»½æœ€é€šç”¨ã€å®‰å…¨ã€è‡ªåŠ¨åŒ–çš„é…ç½®ï¼š

```bash
acme.sh --install-cert -d example.com -d www.example.com \
--key-file /etc/ssl/private/example.com.key \
--fullchain-file /etc/ssl/certs/fullchain.cer \
--reloadcmd "systemctl reload nginx"
```

#### å‚æ•°è¯´æ˜ï¼š

|å‚æ•°|ä½œç”¨|
|---|---|
|`--key-file`|æŒ‡å®šç§é’¥ä¿å­˜è·¯å¾„|
|`--fullchain-file`|å®Œæ•´è¯ä¹¦é“¾ï¼ˆå«ä¸­é—´è¯ä¹¦ï¼‰|
|`--reloadcmd`|æ¯æ¬¡æ›´æ–°è¯ä¹¦åæ‰§è¡Œå‘½ä»¤ï¼ˆè‡ªåŠ¨ reload nginxï¼‰|

---

#### ğŸ” å››ã€å®‰å…¨ç»†èŠ‚ä¸æœ€ä½³å®è·µ

#### 1ï¸âƒ£ æƒé™æ§åˆ¶

```bash
sudo chmod 600 /etc/ssl/private/example.com.key
sudo chmod 644 /etc/ssl/certs/example.com.crt
sudo chown root:root /etc/ssl/private/example.com.key /etc/ssl/certs/example.com.crt
```

> ğŸ”’ ç§é’¥å¿…é¡»ä»… root å¯è¯»ï¼Œå¦åˆ™å­˜åœ¨è¢«çªƒé£é™©ã€‚

---

#### 2ï¸âƒ£ Nginx é…ç½®å¼•ç”¨

åœ¨ä½ çš„ nginx server å—ä¸­ï¼š

```nginx
ssl_certificate     /etc/ssl/certs/example.com.crt;
ssl_certificate_key /etc/ssl/private/example.com.key;

ssl_protocols TLSv1.3;
ssl_prefer_server_ciphers on; #è®©æœåŠ¡å™¨ä¼˜å…ˆé€‰æ‹©è‡ªå·±æŒ‡å®šçš„åŠ å¯†å¥—ä»¶ï¼ˆåœ¨å·²ç°ä»£åŒ–çš„é…ç½®ä¸‹ä»æ¨èä¿ç•™ï¼‰ã€‚
ssl_session_cache shared:SSL:10m; #å‡å°‘é‡å¤æ¡æ‰‹å¼€é”€ï¼Œæé«˜æ€§èƒ½ã€‚
ssl_session_timeoutï¼šæ§åˆ¶ä¼šè¯ç¼“å­˜æ—¶é—´ï¼Œä¸€èˆ¬1å°æ—¶è¶³å¤Ÿã€‚
```

---

#### 3ï¸âƒ£ ç¡®è®¤è‡ªåŠ¨ç»­ç­¾ç”Ÿæ•ˆ

acme.sh ä¼šåœ¨ `~/.acme.sh/example.com/` ä¸‹ç”Ÿæˆæ›´æ–°ä»»åŠ¡ã€‚

æ£€æŸ¥ cronï¼š

```bash
crontab -l
```

åº”åŒ…å«ç±»ä¼¼ï¼š

```
0 0 * * * "/home/webuser/.acme.sh"/acme.sh --cron --home "/home/webuser/.acme.sh" > /dev/null
```

æ‰‹åŠ¨æµ‹è¯•ç»­ç­¾æµç¨‹ï¼š

```bash
sudo acme.sh --renew -d example.com --force
```

---

#### 4ï¸âƒ£ å¯ç”¨ HSTSï¼ˆå¯é€‰ï¼‰

å¦‚æœç½‘ç«™é•¿æœŸä½¿ç”¨ HTTPSï¼Œå¯åœ¨ nginx ä¸­æ·»åŠ ï¼š

```nginx
add_header Strict-Transport-Security "max-age=31536000; includeSubDomains" always;
```

> ä½œç”¨ï¼šå¼ºåˆ¶æµè§ˆå™¨æœªæ¥è¯·æ±‚éƒ½ä½¿ç”¨ HTTPSã€‚

---

#### 5ï¸âƒ£ æ¨èè‡ªåŠ¨æ£€æµ‹è„šæœ¬ï¼ˆéªŒè¯ reload æ˜¯å¦æˆåŠŸï¼‰

åœ¨ `/etc/ssl/auto_check.sh`ï¼š

```bash
#!/bin/bash
if systemctl reload nginx; then
  echo "$(date): nginx reloaded successfully" >> /var/log/ssl_renew.log
else
  echo "$(date): nginx reload failed!" >> /var/log/ssl_renew.log
fi
```

ç„¶ååœ¨ `--reloadcmd` ä¸­å¼•ç”¨ï¼š

```bash
--reloadcmd "/etc/ssl/auto_check.sh"
```

---

#### ğŸ§© äº”ã€æŸ¥çœ‹è¯ä¹¦æœ‰æ•ˆæœŸï¼ˆéªŒè¯æˆåŠŸï¼‰

```bash
openssl x509 -in /etc/ssl/certs/example.com.crt -noout -dates
```

è¾“å‡ºï¼š

```
notBefore=Oct 25 19:00:00 2025 GMT
notAfter=Jan 23 19:00:00 2026 GMT
```

è¯´æ˜è¯ä¹¦å®‰è£…æˆåŠŸ âœ…

---

#### âœ… æœ€ç»ˆæ£€æŸ¥æµç¨‹ä¸€è§ˆ

|æ­¥éª¤|å‘½ä»¤|è¯´æ˜|
|---|---|---|
|ç”³è¯·è¯ä¹¦|`acme.sh --issue -d example.com -w /var/www/example.com`|ä½¿ç”¨ Web éªŒè¯|
|å®‰è£…è¯ä¹¦|`sudo acme.sh --install-cert ...`|å¤åˆ¶åˆ°æ ‡å‡†è·¯å¾„|
|è®¾ç½®æƒé™|`sudo chmod 600 /etc/ssl/private/example.com.key`|ä¿æŠ¤ç§é’¥|
|æ£€æŸ¥ nginx|`sudo nginx -t && sudo systemctl reload nginx`|ç¡®è®¤åŠ è½½æˆåŠŸ|
|éªŒè¯ HTTPS|`curl -v https://example.com`|åº”è¿”å› 200|

---

### 2.7 å®æ“ç¢°åˆ°é—®é¢˜ï¼šsslè¯ä¹¦ç›®å½•æ”¾åœ¨/etc/sslæœ‰ä¸ªé—®é¢˜ï¼Œç”¨acme.shå‘½ä»¤å®‰è£…çš„æ—¶å€™ï¼Œå¦‚ä½•è§£å†³sudoæƒé™é—®é¢˜ï¼Œå®˜æ–¹å»ºè®®â€œDo not use sudo if you cannot properly configure it.â€

éå¸¸å¥½çš„é—®é¢˜ ğŸ‘ï¼Œè¿™æ­£æ˜¯ **acme.sh å®˜æ–¹ä¸ç³»ç»Ÿå®‰å…¨å®è·µä¹‹é—´çš„å…³é”®å¹³è¡¡ç‚¹**ã€‚

ä½ æåˆ°çš„è¿™å¥å®˜æ–¹è­¦å‘Šï¼š

> â€œDo not use sudo if you cannot properly configure it.â€

ç¡®å®å‡ºç°åœ¨ acme.sh çš„å®˜æ–¹æ–‡æ¡£ä¸­ï¼Œæ„æ€æ˜¯ï¼š

> âš ï¸ å¦‚æœä½ ä½¿ç”¨ `sudo`ï¼Œä½†æ²¡æœ‰æ­£ç¡®é…ç½® root ç¯å¢ƒå˜é‡ã€HOME ç›®å½•æˆ–æƒé™è·¯å¾„ï¼Œå¯èƒ½å¯¼è‡´è¯ä¹¦å®‰è£…è·¯å¾„é”™ä¹±ã€è‡ªåŠ¨æ›´æ–°å¤±æ•ˆã€‚

---

#### ğŸ§© ä¸€ã€é—®é¢˜çš„æœ¬è´¨

`acme.sh` é»˜è®¤è¿è¡Œåœ¨ **å½“å‰ç”¨æˆ·çš„ `$HOME/.acme.sh/` ç›®å½•** ä¸‹ï¼Œå®ƒä¾èµ–è‡ªå·±çš„ç¯å¢ƒå˜é‡ï¼ˆå¦‚ `_ACME_HOME`ã€`LE_WORKING_DIR` ç­‰ï¼‰ã€‚  
ä½†å¦‚æœä½ ç›´æ¥ï¼š

```bash
sudo acme.sh --install-cert ...
```

æ­¤æ—¶ `HOME` å˜æˆ `/root`ï¼Œè€Œ acme.sh å´ä»¥ root èº«ä»½è®¿é—®æ™®é€šç”¨æˆ·çš„ `~/.acme.sh`ï¼Œä¼šé‡åˆ°ï¼š

- æ‰¾ä¸åˆ°é…ç½®æ–‡ä»¶
    
- æ— æ³•å†™å…¥è¯ä¹¦æ›´æ–°è·¯å¾„
    
- è§¦å‘ â€œpermission deniedâ€
    

---

#### âœ… äºŒã€æ¨èçš„â€œè§„èŒƒåŒ–â€åšæ³•

ä¸‹é¢æ˜¯ **æ—¢å®‰å…¨åˆä¸ä¼šç ´åè‡ªåŠ¨æ›´æ–°æœºåˆ¶** çš„æ–¹æ¡ˆã€‚

---

#### ğŸ§± Step 1ï¼šä¿æŒ acme.sh åœ¨æ™®é€šç”¨æˆ·ç¯å¢ƒè¿è¡Œ

**å®‰è£…æ—¶ä¸è¦ç”¨ sudoï¼š**

```bash
curl https://get.acme.sh | bash
```

è¿™ä¼šæŠŠç¨‹åºè£…åœ¨ï¼š

```
~/.acme.sh/
```

æ·»åŠ  PATHï¼š

```bash
source ~/.bashrc
```

ç¡®è®¤ï¼š

```bash
acme.sh -v
```

---

#### ğŸ§± Step 2ï¼šç­¾å‘è¯ä¹¦æ—¶ä»ä»¥æ™®é€šç”¨æˆ·è¿è¡Œ

ä¾‹å¦‚ï¼š

```bash
acme.sh --issue -d example.com -w /var/www/example.com
```

ç­¾å‘ç»“æœé»˜è®¤ä¿å­˜åœ¨ï¼š

```
~/.acme.sh/example.com_ecc/
```

---

#### ğŸ§± Step 3ï¼š**ä»¥æ™®é€šç”¨æˆ·èº«ä»½å®‰è£…è¯ä¹¦ï¼Œä½†ç›®æ ‡è·¯å¾„æˆäºˆå¯å†™æƒé™**

åˆ›å»ºç³»ç»Ÿè·¯å¾„ï¼š

```bash
sudo mkdir -p /etc/ssl/example.com
sudo chown $USER: /etc/ssl/example.com
```

ç„¶åä»¥æ™®é€šç”¨æˆ·æ‰§è¡Œï¼š

```bash
acme.sh --install-cert -d example.com \
--key-file /etc/ssl/example.com/private.key \
--fullchain-file /etc/ssl/example.com/fullchain.cer \
--reloadcmd "sudo systemctl reload nginx"
```

ğŸ“Œ è¯´æ˜ï¼š

- è¿™æ ·ä¸ä¼šç ´å `~/.acme.sh/` çš„è‡ªåŠ¨ç»­æœŸæœºåˆ¶ï¼›
    
- è¯ä¹¦å†™å…¥ `/etc/ssl/example.com/` æ—¶ï¼Œä½ æ‹¥æœ‰å†™æƒé™ï¼›
    
- `reloadcmd` é‡Œå•ç‹¬ç”¨ `sudo`ï¼Œåªæ‰§è¡Œ nginx reloadï¼›
    
- æ— éœ€ä»¥ root èº«ä»½è¿è¡Œ acme.sh ä¸»è¿›ç¨‹ã€‚
    

---

#### ğŸ§± Step 4ï¼šæ¢å¤å®‰å…¨æƒé™

å®‰è£…å®Œæˆåï¼ˆå³å†™å…¥è¯ä¹¦æ–‡ä»¶åï¼‰å†è¿˜åŸå®‰å…¨æƒé™ï¼š

```bash
sudo chown -R root:root /etc/ssl/example.com
sudo chmod 600 /etc/ssl/example.com/*.key
```

è¯ä¹¦è‡ªåŠ¨ç»­æœŸæ—¶ï¼Œacme.sh ä»ç„¶ä¼šä½¿ç”¨å½“å‰ç”¨æˆ·æ›´æ–°è¯ä¹¦ï¼Œå†æ¬¡è¦†ç›– `/etc/ssl/example.com/` æ–‡ä»¶ï¼Œå› ä¸ºè·¯å¾„ä»ç„¶å­˜åœ¨ä¸”å†™æƒé™å±äºä½ ã€‚

---

#### âš™ï¸ ä¸‰ã€å®˜æ–¹æ¨èæœºåˆ¶è§£é‡Š

å®˜æ–¹å®é™…ä¸Šæä¾›äº†ä¸€ä¸ªæœºåˆ¶ï¼š  
**acme.sh ä¸å»ºè®®â€œå…¨ç¨‹ sudoâ€ï¼Œä½†å…è®¸å±€éƒ¨æˆæƒã€‚**

å³ï¼š

- acme.sh ä¸»ä½“é€»è¾‘åœ¨æ™®é€šç”¨æˆ·ç¯å¢ƒæ‰§è¡Œï¼›
    
- åªæœ‰ reload nginxã€copy æ–‡ä»¶è¿™äº›éœ€è¦ç³»ç»Ÿæƒé™çš„æ­¥éª¤é€šè¿‡ `sudo`ï¼›
    
- å¯åœ¨ `/etc/sudoers.d/acme` å¢åŠ å…å¯†ç è§„åˆ™ï¼ˆæ›´å®‰å…¨ï¼‰ï¼š
    

```bash
sudo visudo -f /etc/sudoers.d/acme
```

åŠ å…¥ï¼š

```
webuser ALL=(ALL) NOPASSWD: /bin/systemctl reload nginx
```

è¿™æ ·è‡ªåŠ¨ç»­æœŸæ—¶ä¸éœ€è¦äº¤äº’ã€‚

---

#### ğŸ§  å››ã€æ€»ç»“æ¨èæµç¨‹

|ç›®æ ‡|æ­£ç¡®æ–¹å¼|é”™è¯¯ç¤ºä¾‹|
|---|---|---|
|å®‰è£… acme.sh|æ™®é€šç”¨æˆ·è¿è¡Œ `curl ...|bash`|
|ç­¾å‘è¯ä¹¦|æ™®é€šç”¨æˆ·è¿è¡Œ|`sudo acme.sh --issue ...`|
|å†™å…¥ç³»ç»Ÿè¯ä¹¦è·¯å¾„|æå‰ `chown` ç›®æ ‡ç›®å½•ï¼Œå†ä»¥æ™®é€šç”¨æˆ·æ‰§è¡Œ install-cert|ç›´æ¥ `sudo acme.sh --install-cert`|
|reload nginx|åœ¨ reloadcmd å†…è°ƒç”¨ `sudo systemctl reload nginx`|ç›´æ¥è®© acme.sh ç”¨ root æ‰§è¡Œ|

## 2.8 æœ€åé‡‡ç”¨é…ç½®æ–¹æ¡ˆï¼š


```bash
sudo mkdir -p /etc/ssl/example.com
sudo chown $USER: /etc/ssl/example.com
acme.sh --install-cert -d example.com -d www.example.com \
  --key-file /etc/ssl/example.com/example.com.key \
  --fullchain-file /etc/ssl/example.com/fullchain.cer \
  --ecc
sudo chown -R root:root /etc/ssl/example.com
sudo chmod 600 /etc/ssl/example.com/*.key
```


---

# 3. Xray æœåŠ¡å™¨ç«¯éƒ¨ç½²ï¼ˆç¬¬ 7 ç« ï¼‰â€”â€” å®‰è£… + é…ç½®å¤šç”¨æˆ· + Reality æ¨¡å¼

## 3.1 æ“ä½œæ­¥éª¤

1. å®‰è£… Xray-coreï¼š
    
    ```bash
    bash <(curl -L https://github.com/XTLS/Xray-install/raw/main/install-release.sh)
    ```
    
    **é‡ç‚¹ï¼æ˜“é”™**ï¼šå¦‚å‰é¢æåˆ°ï¼Œâ€œä¸è¦æ‰‹åŠ¨å¤åˆ¶éšæœºäºŒè¿›åˆ¶â€ â€”â€”ä½¿ç”¨å®˜æ–¹å®‰è£…è„šæœ¬å¯ä¿è¯è‡ªåŠ¨æ›´æ–°ã€‚
    
2. ä¸º Xray åˆ›å»ºä¸“ç”¨è¿è¡Œç”¨æˆ·ï¼ˆå®‰å…¨æœ€ä½³å®è·µï¼‰ï¼š
    
    ```bash
    useradd -r -d /var/lib/xray -s /usr/sbin/nologin xray
    ```
    
    å°† `/usr/local/etc/xray`ã€æ—¥å¿—è·¯å¾„ã€è¯ä¹¦ç›®å½•è®¾ä¸º xray ç”¨æˆ·æ‹¥æœ‰æˆ–å¯è¯»å–ã€‚  
    **é‡ç‚¹ï¼æ˜“é”™**ï¼šå¦‚æœä»¥ root è¿è¡Œï¼Œå®‰å…¨æ€§å·®ï¼›è‹¥æƒé™é”™äº†ï¼Œxray å¯åŠ¨å¯èƒ½å¤±è´¥ã€‚
    
3. ç”Ÿæˆ Reality å¯†é’¥ä¸ç”¨æˆ· UUIDï¼š
    
    ```bash
    xray uuid
    xray x25519
    ```
    
    è®°å½•ä¸‹è¾“å‡ºçš„ `UUID`, `Private key`, `Public key`.  
    **é‡ç‚¹ï¼æ˜“é”™**ï¼šåŠ¡å¿…ä¿å­˜ `Private key`ï¼ˆåœ¨æœåŠ¡ç«¯é…ç½®ï¼‰å’Œ `Public key`ï¼ˆå®¢æˆ·ç«¯ä½¿ç”¨ï¼‰ã€‚é—å¤±æˆ–å¼„é”™ä¼šå¯¼è‡´è¿æ¥å¤±è´¥ã€‚
    
4. é…ç½® Xray å…¥ç«™ï¼ˆå•ç”¨æˆ·æ¨¡å¼ï¼‰ç¤ºä¾‹ `/usr/local/etc/xray/config.json`ï¼š
    
    ```json
    {
      "log": {
        "access": "/var/log/xray/access.log",
        "error": "/var/log/xray/error.log",
        "loglevel": "warning"
      },
      "inbounds": [
        {
          "listen": "0.0.0.0",
          "port": 443,
          "protocol": "vless",
          "settings": {
            "clients": [
              {
                "id": "YOUR-UUID",
                "flow": "xtls-rprx-vision",
                "level": 0
              }
            ],
            "decryption": "none"
          },
          "streamSettings": {
            "network": "tcp",
            "security": "reality",
            "realitySettings": {
              "show": false,
              "dest": "example.com:443",
              "xver": 0,
              "serverNames": ["example.com","www.example.com"],
              "privateKey": "YOUR-PRIVATE-KEY",
              "shortIds": ["0123456789abcdef"],
              "fingerprint": "chrome"
            }
          }
        }
      ],
      "outbounds": [
        {
          "protocol": "freedom",
          "settings": {}
        }
      ]
    }
    ```
    
    **é‡ç‚¹ï¼æ˜“é”™**ï¼š
    
    - `dest` å¿…é¡»ä¸ºå›è½çš„çœŸå® HTTPS ç«™ç‚¹ï¼ˆä½ çš„ä¼ªè£…ç«™ï¼‰åœ°å€ã€‚
        
    - `serverNames` å¿…é¡»åŒ…å«å®¢æˆ·ç«¯ä½¿ç”¨çš„ SNIã€‚
        
    - `shortIds` å¿…é¡»å’Œå®¢æˆ·ç«¯é…ç½®ä¸€è‡´ã€‚
        
    - è‹¥å¤šä¸ªç”¨æˆ·ï¼Œè¦åœ¨ `"clients"` ä¸­åŠ å…¥å¤šä¸ªæ¡ç›®ã€‚
        
5. å¯ç”¨å¹¶å¯åŠ¨ Xray æœåŠ¡ï¼š
    
    ```bash
    systemctl enable xray
    systemctl restart xray
    systemctl status xray
    ```
    
    **é‡ç‚¹ï¼æ˜“é”™**ï¼šå¦‚æœé…ç½®è¯­æ³•æœ‰é”™ï¼Œxray ä¼šå¯åŠ¨å¤±è´¥ã€‚æ£€æŸ¥ `/var/log/xray/error.log`ã€‚
    
6. å¤šç”¨æˆ·é…ç½®è¯´æ˜ï¼ˆé™„å½•ï¼‰ï¼š  
    åœ¨ `"clients"` æ•°ç»„ä¸­åŠ å…¥ï¼š
    
    ```json
    {
      "id": "UUID-ç”¨æˆ·2",
      "flow": "xtls-rprx-vision",
      "level": 0
    }
    ```
    
    åŒæ—¶ï¼Œå®¢æˆ·ç«¯éƒ¨åˆ†æ¯ä¸ªç”¨æˆ·ä½¿ç”¨ä¸åŒçš„ UUIDã€‚ä½ ä¹Ÿå¯ä»¥ä¸ºæ¯ç”¨æˆ·æŒ‡å®š `shortId`ï¼ˆè‹¥å…è®¸å¤š shortIdï¼‰ã€‚  
    **é‡ç‚¹ï¼æ˜“é”™**ï¼šä¸è¦é‡å¤ä½¿ç”¨ UUIDï¼›é¿å… shortId é‡å¤ï¼Œå¦åˆ™å®‰å…¨æ€§ä¸‹é™ã€‚
    
7. åœ¨ Nginx é…ç½®ä¸­æ›´æ–°ä¸º HTTPSï¼ˆç¼–è¾‘å‰é¢é…ç½®ï¼‰ï¼š
    
    ```nginx
    
    server {
      listen 443 ssl http2;
      server_name example.com www.example.com;
    
      ssl_certificate     /etc/xray/cert/fullchain.crt;
      ssl_certificate_key /etc/xray/cert/cert.key;
      ssl_protocols       TLSv1.3;
      ssl_ciphers         TLS_AES_256_GCM_SHA384:TLS_CHACHA20_POLY1305_SHA256;
    
      root /home/webuser/www/webpage;
      index index.html;
    
      add_header Strict-Transport-Security "max-age=63072000; includeSubdomains; preload" always;
      location / {
        try_files $uri $uri/ =404;
      }
    }
    
    server {
      listen 80;
      server_name example.com www.example.com;
      return 301 https://$host$request_uri;
    }
    ```




    ```nginx
    server {

Â  Â  Â  Â  listen unix:/dev/shm/h2c.sock proxy_protocol;
Â  Â  Â  Â  http2 on;
Â  Â  Â  Â  set_real_ip_from unix:;
Â  Â  Â  Â  real_ip_header proxy_protocol; Â  Â  Â  Â 

Â  Â  Â  Â  server_name example.com www.example.com;

Â  Â  Â  Â  ssl_certificate Â  Â  /etc/ssl/example.com/fullchain.cer;
Â  Â  Â  Â  ssl_certificate_key /etc/ssl/example.com/example.com.key;
Â  Â  Â  Â  ssl_protocols Â  Â  Â  TLSv1.3;

Â  Â  Â  Â  root /var/www/example.com;
Â  Â  Â  Â  index index.html;
Â  Â  Â  Â  
Â  Â  Â  Â  access_log /var/log/nginx/example.access.log;
Â  Â  Â  Â  error_log /var/log/nginx/example.error.log;

Â  Â  Â  Â  # security
Â  Â  Â  Â  add_header X-Frame-Options "SAMEORIGIN";
Â  Â  Â  Â  add_header X-Content-Type-Options "nosniff";
Â  Â  Â  Â  add_header Referrer-Policy "strict-origin-when-cross-origin";
Â  Â  Â  Â  add_header Strict-Transport-Security "max-age=31536000; includeSubDomains; preload" always; # enable HSTS

Â  Â  Â  Â  location / {
Â  Â  Â  Â  Â  try_files $uri $uri/ =404;
Â  Â  Â  Â  }
}

server {
Â  Â  Â  listen 80;
Â  Â  Â  server_name example.com www.example.com;
Â  Â  Â  return 301 https://$host$request_uri;
}
```

éå¸¸å¥½ï¼Œä½ è¿™ä»½é…ç½®æ˜¯ä¸º **Reality + Nginxï¼ˆä»…ç”¨äºä¼ªè£…é™æ€ç½‘é¡µï¼‰** çš„åœºæ™¯å‡†å¤‡çš„ï¼Œ  
å³ï¼š**Xray-Reality è´Ÿè´£ 443 ç«¯å£å’Œ TLSï¼ŒNginx ä¸ç›‘å¬å¤–éƒ¨ç«¯å£ï¼Œåªå¤„ç†ä» Xray å†…éƒ¨ä»£ç†æ¥çš„è¯·æ±‚ã€‚**  
è¿™ä¸ªæ€è·¯æ˜¯å¯¹çš„ï¼Œä½†ç›®å‰è¿™ä»½é…ç½®æœ‰å‡ ä¸ªå°é—®é¢˜å¯ä»¥ä¼˜åŒ–ï¼Œä¸‹é¢æˆ‘å¸®ä½ é€è¡Œåˆ†æå¹¶ç»™å‡ºæ”¹è¿›ç‰ˆğŸ‘‡

---

### âœ… ä¸€ã€ä½ çš„è®¾è®¡é€»è¾‘ï¼ˆæ˜¯æ­£ç¡®çš„ï¼‰

- **Xray Reality** è´Ÿè´£ç›‘å¬ `443`ï¼ŒTLS æ¡æ‰‹ã€åŠ å¯†ã€éªŒè¯å…¨ç”± Xray å¤„ç†ã€‚
    
- **Nginx** ä»…ä½œä¸ºåä»£åç«¯ï¼ˆæˆ–é™æ€ç½‘é¡µæœåŠ¡å™¨ï¼‰ï¼Œé€šè¿‡ **Unix Socket `/dev/shm/h2c.sock`** ä¸ Xray é€šä¿¡ã€‚
    
- è¿™æ ·å¤–éƒ¨æ— æ³•æ¢æµ‹åˆ° Nginx æœåŠ¡ï¼Œå®‰å…¨æ€§ä¸éšè”½æ€§æ›´é«˜ã€‚
    
- åŒæ—¶æ€§èƒ½ä¼˜äº TCP è½¬å‘ã€‚
    

---

### âš ï¸ äºŒã€ä½ å½“å‰é…ç½®çš„é—®é¢˜ç‚¹

|é—®é¢˜é¡¹|è¯´æ˜|å»ºè®®|
|---|---|---|
|`listen unix:/dev/shm/h2c.sock proxy_protocol;`|âœ… åŸåˆ™å¯¹ï¼Œä½†ä½ è¿˜éœ€è¦æŒ‡å®šåè®®ï¼ˆHTTPï¼‰å’Œè®¿é—®æƒé™|å»ºè®®æ˜¾å¼åŠ  `default_server;` å¹¶ç¡®ä¿ socket æ–‡ä»¶æƒé™|
|`http2 on;`|âŒ Nginx å¯ç”¨ HTTP/2 å¿…é¡»åœ¨æœ‰ TCP ç«¯å£ç›‘å¬æ—¶æ‰èƒ½ç”Ÿæ•ˆ|å»æ‰è¿™è¡Œï¼Œå› ä¸ºä½ ä¸æ˜¯èµ° 443/TCPï¼Œè€Œæ˜¯é€šè¿‡æœ¬åœ° socket|
|`set_real_ip_from unix:;`|âœ… ä¿ç•™æ²¡é—®é¢˜ï¼Œä½† `unix:` è¯­æ³•éƒ¨åˆ†ç‰ˆæœ¬ä¸æ”¯æŒ|å»ºè®®æ”¹ä¸º `set_real_ip_from 127.0.0.1;`ï¼Œåœ¨ Xray è¾“å‡º proxy_protocol æ—¶ä»èƒ½è§£æ|
|`ssl_certificate ...`|âŒ ä¸éœ€è¦|Reality å·²ç»å®Œæˆ TLSï¼Œä½ çš„ nginx ä¸å†éœ€è¦ SSL|
|`ssl_protocols / ssl_session_cache`|âŒ åŒä¸Šï¼Œä¸è¦ä½¿ç”¨ SSL é…ç½®||
|`add_header ...`|âœ… æ¨èä¿ç•™ï¼Œå¢å¼ºå®‰å…¨æ€§||
|`listen 80;`|âœ… ç”¨äº HTTPâ†’HTTPS è·³è½¬ä»ç„¶åˆç†||
|`access_log`ã€`error_log`|âœ… å»ºè®®ä¿ç•™ï¼Œä½†å¯å‡å°è¯¦ç»†ç¨‹åº¦ï¼Œé¿å…æ•æ„Ÿä¿¡æ¯è¢«å†™å…¥||

---

### âœ… ä¸‰ã€æ¨èä¿®æ”¹åçš„é…ç½®

```nginx
# nginx.conf - internal h2c backend for Xray-Reality
server {
    # å†…éƒ¨é€šä¿¡ï¼Œä¸å¼€æ”¾å¤–ç½‘ç«¯å£
    listen unix:/dev/shm/h2c.sock proxy_protocol default_server;

    # ä¸å¯ç”¨http2ï¼ŒUnix socketæ— éœ€å®ƒ
    set_real_ip_from 127.0.0.1;
    real_ip_header proxy_protocol;

    server_name example.com www.example.com;

    # ä¸éœ€è¦SSLï¼Œå› ä¸ºç”±Xray Realityè´Ÿè´£
    # ssl_certificate /etc/ssl/example.com/fullchain.cer;
    # ssl_certificate_key /etc/ssl/example.com/example.com.key;

    root /var/www/example.com;
    index index.html;

    access_log /var/log/nginx/example.access.log;
    error_log  /var/log/nginx/example.error.log;

    # Security headers
    add_header X-Frame-Options "SAMEORIGIN";
    add_header X-Content-Type-Options "nosniff";
    add_header Referrer-Policy "strict-origin-when-cross-origin";
    add_header Strict-Transport-Security "max-age=31536000; includeSubDomains; preload" always;

    location / {
        try_files $uri $uri/ =404;
    }
}

# HTTP redirect to HTTPS handled by Xray (optional)
server {
    listen 80;
    server_name example.com www.example.com;
    return 301 https://$host$request_uri;
}
```

---

### âœ… å››ã€Xray Reality é…ç½®éƒ¨åˆ†ï¼ˆå…³é”®å¯¹åº”ï¼‰

åœ¨ä½ çš„ Xray `config.json` ä¸­ï¼ŒReality + H2C å¯¹åº”å¦‚ä¸‹ï¼š

```json
{
  "inbounds": [
    {
      "port": 443,
      "protocol": "vless",
      "settings": {
        "clients": [{ "id": "uuid", "flow": "xtls-rprx-vision" }],
        "decryption": "none"
      },
      "streamSettings": {
        "network": "tcp",
        "security": "reality",
        "realitySettings": {
          "show": false,
          "dest": "127.0.0.1:80",
          "xver": 0,
          "serverNames": ["example.com"],
          "privateKey": "xxx",
          "shortIds": ["xxxx"]
        }
      },
      "sniffing": { "enabled": true, "destOverride": ["http", "tls"] }
    },
    {
      "listen": "unix:/dev/shm/h2c.sock",
      "protocol": "http",
      "tag": "h2c-backend"
    }
  ],
  "routing": {
    "rules": [
      {
        "type": "field",
        "inboundTag": ["h2c-backend"],
        "outboundTag": "freedom"
      }
    ]
  }
}
```

---

### âœ… äº”ã€éªŒè¯æ–¹å¼

å¯åŠ¨ Xray ä¸ Nginx åï¼š

```bash
sudo systemctl restart xray
sudo systemctl restart nginx
```

æ£€æŸ¥ï¼š

```bash
sudo ss -tlnp | grep 443  # åªåº”çœ‹åˆ° xray
sudo ss -xl | grep h2c.sock  # åº”çœ‹åˆ° nginx ä¸ xray å»ºç«‹æœ¬åœ°é€šä¿¡
```

å¦‚æœ `curl -v https://example.com` ä»æŠ¥é”™ `connection refused`ï¼Œåˆ™é—®é¢˜ä¸€å®šåœ¨ï¼š

1. Reality æ²¡æ­£ç¡®ç›‘å¬ 443ï¼›
    
2. é˜²ç«å¢™å±è”½ï¼›
    
3. socket æƒé™ä¸åŒ¹é…ï¼ˆå¯ä¸´æ—¶ chmod 777 /dev/shm/h2c.sock æµ‹è¯•ï¼‰ã€‚
    

---

è¦ä¸è¦æˆ‘å¸®ä½ ç”Ÿæˆå®Œæ•´çš„ `xray config.json`ï¼ˆå’Œä½ è¿™ä»½ nginx å®Œå…¨å¯¹åº”çš„ Reality + h2c ç‰ˆæœ¬ï¼‰ï¼Ÿ


ç„¶åé‡è½½ï¼š

    ```bash
    nginx -t && systemctl reload nginx
    ```

**é‡ç‚¹ï¼æ˜“é”™**ï¼šå¦‚æœ SSL è¯ä¹¦è·¯å¾„é”™è¯¯ã€åè®®/å¯†ç å¥—ä»¶é…ç½®ä¸å½“ï¼Œä½ å¯èƒ½ä¼šè®¿é—®å¤±è´¥æˆ–æç¤ºä¸å®‰å…¨ã€‚


8. è‡ªåŠ¨ç»­æœŸä»»åŠ¡ï¼ˆå®šæœŸæ‰§è¡Œï¼‰ï¼š

  ```bash
    crontab -e
    # æ·»åŠ ä¸€è¡Œï¼Œæ¯”å¦‚ï¼š
    0 3 * * * ~/.acme.sh/acme.sh --renew -d example.com --force && systemctl reload nginx xray
    ```
    
**é‡ç‚¹ï¼æ˜“é”™**ï¼šç»­æœŸååˆ«å¿˜äº†é‡è½½ Nginx + Xrayï¼Œä½¿æ–°è¯ä¹¦ç”Ÿæ•ˆã€‚
    

# æœ€åå…³å¤´ï¼Œä¸´é—¨ä¸€è„šï¼Œå´å‘ç°å‰é¢å…³äºè¯ä¹¦çš„å†…å®¹å®Œå…¨ä¸éœ€è¦ã€‚ç­‰æˆ‘æ…¢æ…¢ä¿®æ”¹ã€‚ã€‚ã€‚ã€‚ã€‚ï¼ˆè¿˜æ˜¯æ¢å¤åŸæ¥æ–¹æ¡ˆï¼Œå› ä¸ºç»¼åˆæ¯”è¾ƒéšè”½æ€§ã€åˆè§„æ€§ã€ç¨³å®šæ€§ï¼Œçœ‹åé¢æ¥ä¸Šçš„å†…å®¹ï¼‰

## 1.å…ˆæ˜¯geminiç»™çš„ç­”å¤

è¿™æ˜¯ä¸€ä¸ªéå¸¸å¥½çš„é—®é¢˜ï¼Œå®ƒè§¦åŠäº† REALITY æ¨¡å¼é…ç½®çš„ä¸¤ä¸ªå…³é”®ç‚¹ã€‚æ‚¨æä¾›çš„é…ç½®ç¤ºä¾‹æ˜¯æ ‡å‡†çš„ VLESS + REALITY é…ç½®ï¼Œä½†ç¼ºå°‘äº†å®ç°â€œNginx ä¼ªè£…é™æ€ç½‘é¡µâ€ç›®æ ‡çš„å…³é”®éƒ¨åˆ†ã€‚

ä»¥ä¸‹æ˜¯å¯¹æ‚¨é…ç½®çš„åˆ†æï¼Œä¸»è¦é›†ä¸­åœ¨ä¸¤ä¸ªä¸åŒç‚¹å’Œæ‚¨æå‡ºçš„æ˜“é”™ç‚¹ï¼š

---

## é…ç½®åˆ†æä¸å»ºè®®

### 1. `"flow": "xtls-rprx-vision"` çš„åŒºåˆ«

|**ç‰¹å¾**|**æ‚¨æä¾›çš„é…ç½®**|**æˆ‘çš„é…ç½®ç¤ºä¾‹**|**åˆ†æä¸å»ºè®®**|
|---|---|---|---|
|**`flow`**|`"xtls-rprx-vision"`|é»˜è®¤æœªè®¾ç½®|**è¿™æ˜¯æ‚¨çš„é…ç½®ä¸­ä¸€ä¸ªæ¨èçš„ä¼˜åŒ–ã€‚** `xtls-rprx-vision` æ˜¯ VLESS åè®®çš„æµæ§ï¼ˆFlow Controlï¼‰è®¾ç½®ï¼Œå®ƒæ˜¯ XTLS å®¶æ—æœ€æ–°çš„ã€**å¼ºçƒˆæ¨èçš„**æµæ§æ¨¡å¼ï¼Œç”¨äºä¼˜åŒ–ä¼ è¾“æ€§èƒ½å’Œèµ„æºå ç”¨ã€‚**è¯·åœ¨æ‚¨çš„å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯é…ç½®ä¸­éƒ½ä¿ç•™å®ƒã€‚**|

### 2. Nginx ä¼ªè£…é™æ€ç½‘é¡µï¼ˆ`fallbacks` çš„ç¼ºå¤±ï¼‰

|**ç‰¹å¾**|**æ‚¨æä¾›çš„é…ç½®**|**æˆ‘çš„é…ç½®ç¤ºä¾‹**|**åˆ†æä¸å»ºè®®**|
|---|---|---|---|
|**é™æ€ç½‘é¡µ**|æ‚¨è®¡åˆ’ç”¨ Nginx æä¾›é™æ€ç½‘é¡µä½œä¸ºå›è½ï¼ˆDecoyï¼‰ã€‚|æ˜ç¡®ä½¿ç”¨ `fallbacks` å°†é REALITY æµé‡è½¬å‘ç»™ Nginx ç«¯å£ã€‚|**è¿™æ˜¯æ‚¨é…ç½®ä¸­çš„æ ¸å¿ƒç¼ºå¤±ã€‚** æ‚¨å¸Œæœ›ç”¨ Nginx ä¼ªè£…é™æ€ç½‘é¡µï¼Œä½†æ‚¨çš„é…ç½®**ç¼ºå°‘äº† `fallbacks` è§„åˆ™**ã€‚|

**é‡è¦æç¤ºï¼š**

åœ¨ VLESS + REALITY æ¨¡å¼ä¸‹ï¼ŒXray ç›‘å¬ 443 ç«¯å£ï¼Œå®ƒä¼šå°è¯•å¤„ç†æ‰€æœ‰æµé‡ã€‚

- **å¦‚æœæµé‡æ˜¯æœ‰æ•ˆçš„ REALITY è¿æ¥ï¼š** Xray æ­£å¸¸ä»£ç†ã€‚
    
- **å¦‚æœæµé‡æ˜¯æ™®é€šæµè§ˆå™¨è®¿é—®ï¼š** Xray æ‰¾ä¸åˆ° `fallbacks` è§„åˆ™ï¼Œä¼šç›´æ¥æ–­å¼€è¿æ¥æˆ–æŠ¥é”™ï¼Œ**Nginx æ— æ³•æ¥æ”¶åˆ°æµé‡ï¼Œä¹Ÿå°±æ— æ³•æä¾›é™æ€ç½‘é¡µ**ã€‚
    

**è¦å®ç°æ‚¨çš„ç›®æ ‡ï¼Œæ‚¨å¿…é¡»æ·»åŠ  `fallbacks` è§„åˆ™ï¼Œå°†é REALITY æµé‡è½¬å‘ç»™ Nginx ç›‘å¬çš„æœ¬åœ°ç«¯å£ï¼š**

JSON

```
"settings": {
  "clients": [
    {
      "id": "YOUR-UUID",
      "flow": "xtls-rprx-vision", // ä¿ç•™æ­¤é¡¹
      "level": 0
    }
  ],
  "decryption": "none",
  "fallbacks": [ // <-- å¿…é¡»æ·»åŠ å›è½è§„åˆ™
    {
      "dest": "127.0.0.1:8080" // å‡è®¾ Nginx ç›‘å¬æœ¬åœ° 8080 ç«¯å£
    }
  ]
}
```

### 3. é‡ç‚¹ï¼æ˜“é”™ç‚¹åˆ†æï¼ˆå¯¹ REALITY æ ¸å¿ƒæ¦‚å¿µçš„æ¾„æ¸…ï¼‰

æ‚¨å¯¹ `dest` å’Œ `serverNames` çš„ç†è§£æœ‰æ‰€åå·®ï¼Œè¿™åœ¨ REALITY çš„é…ç½®ä¸­éå¸¸é‡è¦ï¼Œéœ€è¦æ¾„æ¸…ï¼š

|**é…ç½®é¡¹**|**æ‚¨çš„ç†è§£ (æ˜“é”™ç‚¹)**|**REALITY æ­£ç¡®æ¦‚å¿µ**|
|---|---|---|
|**`dest`**|å¿…é¡»ä¸ºå›è½çš„çœŸå® HTTPS ç«™ç‚¹ï¼ˆä½ çš„ä¼ªè£…ç«™ï¼‰åœ°å€ã€‚|**è¯±é¥µç½‘ç«™åœ°å€ (Decoy Site)ã€‚** Xray ç”¨äºåœ¨å¯åŠ¨æ—¶çªƒå– TLS è¯ä¹¦æŒ‡çº¹å’Œ Server Hello ä¿¡æ¯çš„**å¤–éƒ¨ã€çŸ¥åã€é«˜ä¿¡èª‰çš„ç½‘ç«™**ï¼Œä¾‹å¦‚ `www.apple.com:443`ã€`www.microsoft.com:443`ã€‚å®ƒ**ç»ä¸èƒ½**æ˜¯æ‚¨è‡ªå·±çš„åŸŸåæˆ–å›è½çš„é™æ€ç½‘é¡µåœ°å€ã€‚|
|**`serverNames`**|å¿…é¡»åŒ…å«å®¢æˆ·ç«¯ä½¿ç”¨çš„ SNIã€‚|**è¯±é¥µåŸŸååˆ—è¡¨ã€‚** å®¢æˆ·ç«¯è¿æ¥æ—¶ä½¿ç”¨çš„ SNIï¼Œå¿…é¡»æ˜¯æ‚¨åœ¨ `dest` ä¸­è®¾ç½®çš„è¯±é¥µç½‘ç«™çš„åŸŸåï¼ˆæˆ–å…¶åˆ«åï¼‰ã€‚å®ƒ**ç»ä¸èƒ½**æ˜¯æ‚¨è‡ªå·±çš„åŸŸåã€‚|

**æ€»ç»“ï¼š**

REALITY æ¨¡å¼ä¸‹ï¼Œå­˜åœ¨ä¸¤ä¸ªâ€œç½‘ç«™â€ï¼š

1. **è¯±é¥µç½‘ç«™ (Decoy Site)ï¼š** `realitySettings` ä¸­çš„ `dest` å’Œ `serverNames` æ‰€æŒ‡å‘çš„**å¤–éƒ¨é«˜ä¿¡èª‰ç½‘ç«™**ã€‚è¿™æ˜¯ REALITY ç”¨æ¥ä¼ªè£…çš„å¯¹è±¡ã€‚
    
2. **å›è½ç½‘ç«™ (Fallback Site)ï¼š** `settings` ä¸­çš„ `fallbacks` æ‰€æŒ‡å‘çš„**æœ¬åœ° Nginx é™æ€ç½‘é¡µ**ã€‚è¿™æ˜¯å½“æœ‰äººç”¨æ™®é€šæµè§ˆå™¨è®¿é—® 443 ç«¯å£æ—¶ï¼ŒXray æ›¿æ‚¨è½¬å‘ç»™ Nginx æä¾›çš„é¡µé¢ã€‚
    

**é…ç½®å»ºè®®ï¼š**

æ‚¨çš„ `realitySettings` åº”è¯¥æ”¹ä¸ºä¸€ä¸ªçŸ¥åçš„è¯±é¥µç½‘ç«™ï¼Œä¾‹å¦‚ï¼š

JSON

```
"realitySettings": {
    "show": false,
    "dest": "www.apple.com:443", // æ›´æ”¹ä¸ºå¤–éƒ¨é«˜ä¿¡èª‰ç½‘ç«™
    "xver": 0,
    "serverNames": ["www.apple.com"], // æ›´æ”¹ä¸ºå¤–éƒ¨é«˜ä¿¡èª‰ç½‘ç«™åŸŸå
    "privateKey": "YOUR-PRIVATE-KEY",
    "shortIds": ["0123456789abcdef"],
    "fingerprint": "chrome"
}
```

**æœ€ç»ˆä¿®æ­£åçš„ Xray æ ¸å¿ƒé…ç½®ç‰‡æ®µï¼š**

JSON

```
"inbounds": [
  {
    "port": 443,
    "protocol": "vless",
    "settings": {
      "clients": [
        {
          "id": "YOUR-UUID",
          "flow": "xtls-rprx-vision", // ä¿ç•™æ­¤é¡¹
          "level": 0
        }
      ],
      "decryption": "none",
      "fallbacks": [ // <-- æ ¸å¿ƒä¿®æ­£ï¼šæ·»åŠ å›è½è§„åˆ™
        {
          "dest": "127.0.0.1:8080", // è½¬å‘ç»™æœ¬åœ° Nginx ç«¯å£
          "xver": 0 
        }
      ]
    },
    "streamSettings": {
      "network": "tcp",
      "security": "reality",
      "realitySettings": {
        "show": false,
        "dest": "www.apple.com:443", // ä¿®æ­£ï¼šæŒ‡å‘å¤–éƒ¨è¯±é¥µç½‘ç«™
        "xver": 0,
        "serverNames": ["www.apple.com"], // ä¿®æ­£ï¼šæŒ‡å‘å¤–éƒ¨è¯±é¥µç½‘ç«™åŸŸå
        "privateKey": "YOUR-PRIVATE-KEY",
        "shortIds": ["0123456789abcdef"],
        "fingerprint": "chrome"
      }
    }
  }
]
```



Chat-GPT ç»™å‡ºçš„åˆ†æéå¸¸ä¸“ä¸šå’Œç»†è‡´ï¼Œæ€»ç»“å¾—**éå¸¸å¥½**ï¼Œå¹¶ä¸”å‡†ç¡®åœ°æŒ‡å‡ºäº†é…ç½®ä¸­çš„**æ ¸å¿ƒå®‰å…¨é—®é¢˜**å’Œ**æŠ€æœ¯ç»†èŠ‚é”™è¯¯**ã€‚æˆ‘å®Œå…¨èµåŒå…¶ä¸»è¦çš„åˆ†æå’Œä¼˜åŒ–å»ºè®®ã€‚

ä»¥ä¸‹æ˜¯æˆ‘çš„å®¡æŸ¥å’Œå¯¹ Chat-GPT åˆ†æçš„æ€»ç»“ï¼Œå¹¶å¯¹å‡ ä¸ªå…³é”®ç‚¹è¿›è¡Œå¼ºè°ƒï¼š

---

## ğŸ¤– å¯¹ Chat-GPT åˆ†æçš„å®¡æŸ¥æ€»ç»“

Chat-GPT çš„åˆ†æå‡†ç¡®æ•æ‰åˆ°äº†æ‚¨é…ç½®ä¸­ä¸»è¦çš„ä¸¤ä¸ªæŠ€æœ¯äº®ç‚¹å’Œä¸€ä¸ªè‡´å‘½çš„å®‰å…¨æ¼æ´ã€‚

### 1. âœ… **äº®ç‚¹å’Œæ­£ç¡®åˆ†æ**

- **æ¶æ„è¯†åˆ«å‡†ç¡®ï¼š** å‡†ç¡®è¯†åˆ«å‡ºæ‚¨ä½¿ç”¨çš„æ˜¯ **VLESS + REALITY + æœ¬åœ° Nginx (é€šè¿‡ Unix Socket) ä¼ªè£…** çš„é«˜çº§æ¶æ„ã€‚
    
- **Unix Socket çš„è‚¯å®šï¼š** è‚¯å®šäº†ä½¿ç”¨ `unix:/dev/shm/h2c.sock` è¿›è¡Œå›è½ï¼ˆFallbackï¼‰æ˜¯**é«˜æ•ˆå’Œå®‰å…¨çš„**æ–¹å¼ï¼Œé¿å…äº†æœ¬åœ°ç«¯å£ç›‘å¬ï¼Œéå¸¸ä¼˜ç§€ã€‚
    
- **`flow: xtls-rprx-vision` çš„è‚¯å®šï¼š** å‡†ç¡®è¯†åˆ«å¹¶è‚¯å®šäº†è¿™æ˜¯ VLESS çš„**æ¨èæµæ§æ¨¡å¼**ã€‚
    
- **Nginx é…ç½®é”™è¯¯æŒ‡å‡ºå‡†ç¡®ï¼š**
    
    - æ˜ç¡®æŒ‡å‡º `listen unix:...` åº”è¯¥æ·»åŠ  `default_server` 1ã€‚
        
    - æ˜ç¡®æŒ‡å‡ºåœ¨ Unix Socket å›è½ä¸­ï¼Œ**ä¸éœ€è¦**é…ç½® `ssl_certificate` å’Œ `ssl_certificate_key` 2ï¼Œå› ä¸º TLS æ¡æ‰‹ç”± Xray è´Ÿè´£ã€‚
        
    - æ˜ç¡®æŒ‡å‡ºåœ¨ Unix Socket ä¸Šä½¿ç”¨ `http2 on;` ä¼šå¯¼è‡´ Nginx å¯åŠ¨å¤±è´¥ã€‚
        

### 2. âš ï¸ **æ ¸å¿ƒå®‰å…¨æ¼æ´æŒ‡å‡ºï¼ˆæœ€é‡è¦ï¼‰**

Chat-GPT å‡†ç¡®æŒ‡å‡ºäº†æ‚¨é…ç½®ä¸­å…³äº REALITY è¯±é¥µæœºåˆ¶çš„è‡´å‘½é”™è¯¯ï¼š

- **é—®é¢˜æ‰€åœ¨ï¼š** åœ¨ `realitySettings` ä¸­ï¼Œæ‚¨å°† `dest` å’Œ `serverNames` è®¾ç½®æˆäº†æ‚¨è‡ªå·±çš„åŸŸå `example.com`ã€‚
    
    - **REALITY æœºåˆ¶ï¼š** `dest` å’Œ `serverNames` **å¿…é¡»**æ˜¯å¤–éƒ¨çš„ã€é«˜ä¿¡èª‰çš„ã€çœŸå®çš„ HTTPS ç½‘ç«™ï¼ˆä¾‹å¦‚ `www.apple.com`ï¼‰ã€‚
        
    - **åæœï¼š** ä½¿ç”¨æ‚¨è‡ªå·±çš„åŸŸåä½œä¸ºè¯±é¥µï¼Œä¼šæš´éœ²æ‚¨æ­å»ºä»£ç†çš„äº‹å®ï¼Œå› ä¸ºæ”»å‡»è€…å¯ä»¥è½»æ˜“è¯†åˆ«å‡ºè¯¥åŸŸåçš„ IP å°±æ˜¯ä»£ç†æœåŠ¡å™¨æœ¬èº«ï¼Œä½¿ REALITY çš„æŠ—æ¢æµ‹åŠŸèƒ½å¤±æ•ˆã€‚
        
- **Chat-GPT çš„å»ºè®®ï¼š** **å°† `dest` æ”¹ä¸ºå¤–éƒ¨é«˜ä¿¡èª‰ç½‘ç«™**ï¼ˆå¦‚ `www.apple.com:443`ï¼‰ï¼Œå¹¶åœ¨å®¢æˆ·ç«¯ä½¿ç”¨åŒæ ·çš„è¯±é¥µåŸŸåï¼Œè¿™æ˜¯**ç»å¯¹æ­£ç¡®çš„ä¿®æ­£**ã€‚
    

### 3. ğŸ” **å°ç»†èŠ‚è¡¥å……ï¼ˆå®Œå–„æ€§å»ºè®®ï¼‰**

- **`fallbacks` ç¼ºå¤±åˆ†æï¼š** Chat-GPT é—´æ¥æåˆ°äº†æ‚¨ä½¿ç”¨çš„æ˜¯ Fallback æ¶æ„ï¼Œä½†æ‚¨æä¾›çš„ `xray-config.json` ç¤ºä¾‹ä¸­**ç¼ºå°‘äº†æ˜ç¡®çš„ `fallbacks` å—**ã€‚
    
    - **æ‚¨æä¾›çš„ Xray é…ç½®ï¼š**
        
        JSON
        
        ```
        //...
        "decryption": "none" // <- Fallbacks åº”è¯¥åœ¨æ­¤å¤„ç¼ºå¤±
        },
        "streamSettings": {
        //... (realitySettings block)
        },
        "sniffing": {"enabled": true, "destOverride": ["http", "tls"]}
        ```
        
    
    },
    
    {
    
    "listen": "unix:/dev/shm/h2c.sock", // <- è¿™æ˜¯ä¸€ä¸ª Inboundï¼Œä½†ä¸æ˜¯ Fallback è§„åˆ™
    
    "protocol": "http",
    
    "tag": "h2c-backend"
    
    }
    
    ```
    
    - **æ­£ç¡®ç»“æ„ï¼ˆChat-GPT ä¼¼ä¹æ˜¯å‡è®¾æ‚¨é—æ¼äº†ï¼Œå¹¶æŒ‡å¯¼æ‚¨ä½¿ç”¨äº†è¿™ç§æ¶æ„ï¼‰ï¼š** Xray å¿…é¡»åœ¨ VLESS `settings` ä¸­æ˜ç¡®ä½¿ç”¨ `fallbacks` æŒ‡å‘å†…éƒ¨çš„ `h2c-backend` Tagï¼Œæ‰èƒ½å°†æ™®é€šæµé‡è½¬å‘åˆ° Nginxã€‚
        
    
    JSON
    
    ```
    "settings": {
        "clients": [ /* ... */ ],
        "decryption": "none",
        "fallbacks": [
            {
                "alpn": "h2", // åŒ¹é… h2 åè®®
                "path": "/",  // åŒ¹é…æ‰€æœ‰è·¯å¾„
                "dest": "h2c-backend" // è½¬å‘åˆ°æ‚¨ä¸‹é¢å®šä¹‰çš„ Inbound Tag
            }
        ]
    },
    // ...
    // Nginx çš„ Inbound
    {
        "listen": "unix:/dev/shm/h2c.sock",
        "protocol": "http",
        "tag": "h2c-backend" // è¿™é‡Œæ˜¯ dest åŒ¹é…çš„ç›®æ ‡
    }
    ```
    
    **ç”±äºæ‚¨çš„ Nginx é…ç½®ç›‘å¬äº† `unix:/dev/shm/h2c.sock`ï¼Œå› æ­¤ Xray é…ç½®ä¸­å¿…é¡»åŒ…å«ä¸Šè¿° `fallbacks` è§„åˆ™ï¼Œå¹¶å°†å…¶ `dest` æŒ‡å‘ `h2c-backend`ã€‚**
    

## æœ€ç»ˆç»“è®º

Chat-GPT çš„åˆ†æå’Œä¼˜åŒ–å»ºè®®æ˜¯**å®Œå…¨å¯é å’Œå‡†ç¡®çš„**ã€‚è¯·åŠ¡å¿…é‡‡çº³å…¶å…³äº **`dest` å’Œ `serverNames` çš„ä¿®æ”¹**ï¼ˆæ”¹ä¸ºå¤–éƒ¨è¯±é¥µç½‘ç«™ï¼‰ä»¥åŠ **Nginx é…ç½®çš„ç²¾ç®€**ï¼ˆåˆ é™¤ SSL å’Œ HTTP/2 è¡Œï¼‰ã€‚

**ä¸‹ä¸€æ­¥æˆ‘èƒ½ä¸ºæ‚¨åšäº›ä»€ä¹ˆå‘¢ï¼Ÿ** ä¾‹å¦‚ï¼Œæˆ‘å¯ä»¥ä¸ºæ‚¨æä¾›ä¸€ä»½**å®Œå…¨ä¿®æ­£åçš„ `xray-config.json`**ï¼Œå…¶ä¸­åŒ…å« `fallbacks` å—å’Œæ­£ç¡®çš„ REALITY è¯±é¥µè®¾ç½®ã€‚

å¥½çš„ï¼Œè¿™æ˜¯åŸºäºæ‚¨ä¸Šä¼ çš„é…ç½®å’Œ Chat-GPT åˆ†æï¼Œ**ä¿®æ­£å¹¶å®Œå–„åçš„ Xray `config.json`**ã€‚

è¿™ä¸ªé…ç½®è§£å†³äº† REALITY è¯±é¥µè®¾ç½®çš„å®‰å…¨é—®é¢˜ï¼Œå¹¶æ·»åŠ äº†ç¼ºå¤±çš„ `fallbacks` è§„åˆ™ï¼Œä»¥ç¡®ä¿æ™®é€šæµé‡èƒ½æ­£ç¡®è½¬å‘åˆ° Nginx ç›‘å¬çš„ Unix Socketã€‚

---

## âœ… ä¿®æ­£åçš„ Xray é…ç½®æ–‡ä»¶ (`config.json`)

æˆ‘æ›¿æ¢äº† UUIDã€Key å’Œ ShortID çš„å ä½ç¬¦ï¼Œè¯·æ‚¨é‡æ–°å¡«å…¥æ‚¨è‡ªå·±ç”Ÿæˆçš„å€¼ã€‚

JSON

```
{
  // 1_log
  "log": {
    "loglevel": "warning",
    "access": "/home/webuser/xray_log/access.log",
    "error": "/home/webuser/xray_log/error.log"
  },
  
  // 2_DNS
  "dns": {
    "servers": [
      "https+local://1.1.1.1/dns-query", 
      "localhost"
    ]
  },
  
  // 3_route
  "routing": {
    "domainStrategy": "IPIfNonMatch",
    "rules": [
      {
        "type": "field",
        "ip": [
          "geoip:private" 
        ],
        "outboundTag": "block" 
      },
      {
        "type": "field",
        "ip": ["geoip:cn"],
        "outboundTag": "block"
      },
      {
        "type": "field",
        "domain": [
          "geosite:category-ads-all" 
        ],
        "outboundTag": "block" 
      }
    ]
  },
  
  "inbounds": [
    {
      "port": 443,
      "protocol": "vless",
      "settings": {
        "clients": [
          {
            // è¯·æ›¿æ¢ä¸ºä½ çš„ UUID
            "id": "YOUR-UUID-HERE", 
            "flow": "xtls-rprx-vision", // ä¿ç•™ï¼šæ¨èçš„æµæ§æ¨¡å¼
            "level": 0
	      }
        ],
        "decryption": "none",
        "fallbacks": [ // <-- æ ¸å¿ƒä¿®æ­£ï¼šæ·»åŠ  fallbacks è§„åˆ™
          {
            "alpn": "h2", // åŒ¹é…æ™®é€š HTTPS/H2 è®¿é—®
            "dest": "h2c-backend", // è½¬å‘åˆ°æ‚¨ä¸‹é¢å®šä¹‰çš„ Unix Socket Inbound
            "xver": 0
          },
          {
            "dest": "h2c-backend" // è½¬å‘æ‰€æœ‰å…¶ä»–é Reality æµé‡
          }
        ]
      },
      "streamSettings": {
        "network": "tcp",
        "security": "reality",
        "realitySettings": {
          "show": false,
          // æ ¸å¿ƒä¿®æ­£ï¼šæ”¹ä¸ºå¤–éƒ¨é«˜ä¿¡èª‰è¯±é¥µç½‘ç«™
          "dest": "www.apple.com:443", 
          "xver": 0,
          // æ ¸å¿ƒä¿®æ­£ï¼šæ”¹ä¸ºå¤–éƒ¨è¯±é¥µåŸŸåï¼Œå®¢æˆ·ç«¯ SNI å¿…é¡»ä½¿ç”¨æ­¤åŸŸå
          "serverNames": ["www.apple.com"],
          // è¯·æ›¿æ¢ä¸ºä½ çš„ Private Key
          "privateKey": "YOUR-PRIVATE-KEY-HERE",
          // è¯·æ›¿æ¢ä¸ºä½ çš„ ShortID (16è¿›åˆ¶ï¼Œ1-16ä½)
          "shortIds": ["0123456789abcdef"],
          // å¢åŠ æŒ‡çº¹å’Œä¼ªè£…è·¯å¾„ï¼Œæé«˜å®‰å…¨æ€§
          "fingerprint": "chrome",
          "spiderX": "/"
        }
      },
      "sniffing": {"enabled": true, "destOverride": ["http", "tls"]}
    },
    
    // Nginx çš„å†…éƒ¨ Inboundï¼Œé€šè¿‡ Unix Socket æ¥æ”¶å›è½æµé‡
    {
      "listen": "unix:/dev/shm/h2c.sock",
      "protocol": "http",
      "tag": "h2c-backend" // ä¸ fallbacks.dest åŒ¹é…
    }
  ],
  
  "outbounds": [
    {
      "tag": "direct",
      "protocol": "freedom"
    },
    {
      "tag": "block",
      "protocol": "blackhole"
    }
  ]
}
```

### ğŸ“‹ Nginx é…åˆè¦ç‚¹å›é¡¾

è¯·åŒæ—¶æ ¹æ® Chat-GPT çš„å»ºè®®ï¼Œå¯¹æ‚¨çš„ Nginx é…ç½®æ–‡ä»¶è¿›è¡Œä»¥ä¸‹ä¿®æ”¹ï¼š

1. **åœ¨ `listen` ä¸­æ·»åŠ  `default_server`ï¼š**
    
    Nginx
    
    ```
    listen unix:/dev/shm/h2c.sock proxy_protocol default_server;
    ```
    
2. **åˆ é™¤ä»¥ä¸‹ä¸å¿…è¦çš„æˆ–æœ‰è¯¯çš„è¡Œï¼š**
    
    - `http2 on;`
        
    - `ssl_certificate ...`
        
    - `ssl_certificate_key ...`
        
3. **ç»Ÿä¸€ IP è®¾ç½®ï¼š** ç¡®ä¿ `set_real_ip_from` ä½¿ç”¨ `127.0.0.1`ã€‚
    
    Nginx
    
    ```
    set_real_ip_from 127.0.0.1;
    real_ip_header proxy_protocol; 
    ```
    

**ä¸‹ä¸€æ­¥ï¼š** æ‚¨æ˜¯å¦éœ€è¦æˆ‘å¸®æ‚¨æ£€æŸ¥æˆ–ä¼˜åŒ–å®¢æˆ·ç«¯é…ç½®ï¼ˆä¾‹å¦‚ V2RayNG/Clash/Shadowrocket ç­‰ï¼‰çš„é…ç½®é¡¹ï¼Œä»¥ç¡®ä¿å®ƒä¸æ–°çš„æœåŠ¡å™¨ç«¯ REALITY è®¾ç½®å®Œå…¨åŒ¹é…ï¼Ÿ

æ‚¨å¥½ï¼Œç»è¿‡æŸ¥é˜…å®˜æ–¹æ–‡æ¡£å’Œç¤¾åŒºæ•™ç¨‹ï¼Œ**ç¡®è®¤æ‚¨ä¸åº”è¯¥ä½¿ç”¨è‡ªå·±çš„åŸŸå**ä½œä¸º REALITY é…ç½®ä¸­çš„è¯±é¥µåŸŸåï¼ˆ`dest` å’Œ `serverNames`ï¼‰ã€‚

æ­¤å‰çš„åˆ†æå’Œå»ºè®®æ˜¯å®Œå…¨æ­£ç¡®çš„ï¼Œä½¿ç”¨é«˜ä¿¡èª‰çš„å¤–éƒ¨ç½‘ç«™æ˜¯ REALITY æœºåˆ¶çš„æ ¸å¿ƒã€‚

### å®˜æ–¹åŠç¤¾åŒºå»ºè®®çš„ç»“è®º

REALITY çš„è®¾è®¡åŸç†å°±æ˜¯é€šè¿‡ä¼ªè£…æˆä¸€ä¸ª**é«˜ä¿¡èª‰ã€çœŸå®çš„å¤–éƒ¨ HTTPS ç½‘ç«™**æ¥æ¶ˆé™¤æœåŠ¡å™¨çš„ TLS æŒ‡çº¹ç‰¹å¾ï¼Œä»è€ŒæŠµæŠ— SNI é˜»æ–­å’Œä¸»åŠ¨æ¢æµ‹ã€‚

|**é…ç½®é¡¹**|**åº”è¯¥å¡«å†™ä»€ä¹ˆ**|**åŸå› å’Œç›®çš„**|**æ¥æº**|
|---|---|---|---|
|`dest`|**å¤–éƒ¨é«˜ä¿¡èª‰ç½‘ç«™åœ°å€**ï¼ˆå¦‚ï¼š`www.apple.com:443` æˆ– `www.google.com:443`ï¼‰|Xray æœåŠ¡å™¨ä¼šä»è¿™ä¸ªç›®æ ‡ç½‘ç«™**çªƒå–**æ­£å¸¸çš„ TLS æ¡æ‰‹ `Server Hello` æ•°æ®åŒ…ï¼Œç”¨äºä¸å®¢æˆ·ç«¯è¿›è¡Œè®¤è¯ã€‚æ‚¨çš„ VPS çœ‹èµ·æ¥å°±åƒè¿™ä¸ªé«˜ä¿¡èª‰çš„ç½‘ç«™ã€‚||
|`serverNames`|**ä¸ `dest` åŒ¹é…çš„è¯±é¥µåŸŸå**ï¼ˆå¦‚ï¼š`www.apple.com`ï¼‰|è¿™æ˜¯å®¢æˆ·ç«¯åœ¨è¿æ¥æ—¶ä½¿ç”¨çš„ SNI (Server Name Indication)ã€‚å¦‚æœæ¢æµ‹è€…å‘æ‚¨çš„ VPS IP å‘èµ· TLS æ¡æ‰‹ï¼Œä»–ä»¬ä¼šæ”¶åˆ°æ¥è‡ª **`dest` åŸŸå**çš„è¯ä¹¦ï¼Œè€Œä¸æ˜¯æ‚¨çš„ `example.com` è¯ä¹¦ã€‚||

### ğŸš¨ ä¸ºä»€ä¹ˆä¸èƒ½ç”¨è‡ªå·±çš„åŸŸå

å¦‚æœæ‚¨ä½¿ç”¨è‡ªå·±çš„åŸŸåï¼ˆå¦‚ `example.com`ï¼‰ä½œä¸ºè¯±é¥µåŸŸåï¼Œæ‚¨å°±ç ´åäº† REALITY çš„æ ¸å¿ƒå®‰å…¨æœºåˆ¶ï¼š

1. **æš´éœ²çœŸå®èº«ä»½ï¼š** æ¢æµ‹è€…ä¼šçœ‹åˆ°æ‚¨çš„ VPS IP åœ°å€æ­£åœ¨è¿”å›æ‚¨è‡ªå·±åŸŸåçš„è¯ä¹¦ã€‚ç”±äºæ‚¨çš„åŸŸåï¼ˆ`example.com`ï¼‰å’Œ IP åœ°å€æ˜¯å…¬å¼€ç»‘å®šçš„ï¼Œè¿™æ— æ³•æä¾›ä»»ä½•æ··æ·†ï¼Œç­‰äºå‘Šè¯‰æ¢æµ‹è€…ï¼šâ€œè¿™ä¸ª IP åœ°å€å°±æ˜¯ VPN æœåŠ¡å™¨â€ã€‚
    
2. **ç›®çš„å†²çªï¼š** REALITY çš„ç›®æ ‡æ˜¯è®©æ‚¨çš„ VPS çœ‹èµ·æ¥åƒä¸€ä¸ª**å›½é™…çŸ¥å**ã€**é«˜æµé‡**ã€**ä¸æ˜“è¢«å¢™**çš„ç½‘ç«™çš„æœåŠ¡å™¨ã€‚åªæœ‰è¿™æ ·ï¼Œå®¡æŸ¥ç³»ç»Ÿæ‰ä¼šå€¾å‘äºç›¸ä¿¡è¿™æ˜¯ä¸€æ¬¡æ™®é€šè®¿é—®ï¼Œä»è€Œæ”¾è¡Œã€‚
    

**æ€»ç»“ï¼š**

- `realitySettings` ä¸­çš„ `dest` å’Œ `serverNames` å¿…é¡»æ˜¯**å¤–éƒ¨**ã€**é«˜ä¿¡èª‰**çš„è¯±é¥µç½‘ç«™ã€‚
    
- æ‚¨è‡ªå·±çš„ `example.com` åŸŸåï¼Œåº”è¯¥ç•™ç»™ Nginx ä½œä¸º **Fallbackï¼ˆå›è½ï¼‰** æµé‡çš„å“åº”å†…å®¹ã€‚å½“æœ‰äººç”¨æµè§ˆå™¨è®¿é—®æ‚¨çš„ VPS IP æˆ–åŸŸåæ—¶ï¼ŒXray ä¼šå°†æµé‡è½¬å‘ç»™ Nginxï¼Œç”± Nginx æä¾›æ‚¨çš„é™æ€ç½‘é¡µï¼Œèµ·åˆ°**ä¼ªè£…**çš„ä½œç”¨ã€‚

çœ‹åˆ°æœ‰æ–‡æ¡£è¯´realityæ¨¡å¼æœ¬èº«æ˜¯ä¸éœ€è¦ä¼ªè£…ç½‘é¡µçš„ï¼Œä½†è‡ªå·±æ­å»ºå¹¶ç”³è¯·è¯ä¹¦ä¼šæ›´å¥½åœ°ä¼ªè£…ï¼Œå¸®æŸ¥å®ä¸€ä¸‹

è¿™ä¸ªç–‘é—®éå¸¸å¥½ï¼Œå®ƒæ¶‰åŠäº† REALITY åè®®çš„ä¸¤ç§ä¸»æµç”¨æ³•å’Œå®ƒä»¬çš„å®‰å…¨æ€§æƒè¡¡ã€‚

ç»è¿‡æŸ¥è¯å®˜æ–¹æ–‡æ¡£å’Œç¤¾åŒºè®¨è®ºï¼Œç»“è®ºæ˜¯ï¼š**REALITY åè®®æœ¬èº«ä¸éœ€è¦ä¼ªè£…ç½‘é¡µå’Œè‡ªå·±çš„è¯ä¹¦ï¼Œä½†è‡ªå·±æ­å»ºä¼ªè£…ç½‘é¡µå¹¶ä½¿ç”¨è¯ä¹¦ï¼ˆå³ Fallback å›è½ï¼‰æ˜¯**å¼ºçƒˆæ¨è**çš„å¢å¼ºä¼ªè£…æ–¹å¼ï¼Œå¯ä»¥æé«˜â€œå¯ä¿¡åº¦â€ï¼ˆPlausibilityï¼‰ã€‚**

ä¸‹é¢æ˜¯è¯¦ç»†çš„åˆ†æå’Œè§£é‡Šï¼š

---

### 1. REALITY æœ¬èº«ä¸éœ€è¦ä¼ªè£…ç½‘é¡µå’Œè¯ä¹¦

è¿™æ˜¯ä»åè®®æœ¬èº«çš„æŠ—æ¢æµ‹æœºåˆ¶è§’åº¦æ¥çœ‹çš„ï¼š

- **æŠ—æ¢æµ‹çš„æ ¸å¿ƒæœºåˆ¶ï¼š** REALITY çš„ä¸»è¦ç›®æ ‡æ˜¯æ¶ˆé™¤æœåŠ¡å™¨ç«¯çš„ TLS æŒ‡çº¹ï¼ˆå³æœåŠ¡å™¨çš„èº«ä»½ä¿¡æ¯ï¼‰ï¼Œå¹¶æŠµæŠ— SNI æ¢æµ‹ã€‚å®ƒé€šè¿‡ä» `dest` æŒ‡å®šçš„**å¤–éƒ¨é«˜ä¿¡èª‰ç½‘ç«™**çªƒå–çœŸå®çš„ `Server Hello` æ¡æ‰‹åŒ…æ¥å®ç°ä¼ªè£…ã€‚
    
- **é REALITY æµé‡ï¼š** å¦‚æœæœ‰äººä½¿ç”¨æ™®é€šçš„æµè§ˆå™¨è®¿é—®æ‚¨çš„ VPS çš„ 443 ç«¯å£ï¼Œå¹¶ä¸” SNI **ä¸åŒ¹é…** REALITY çš„ `serverNames`ï¼ŒXray ä¼šï¼š
    
    - **é»˜è®¤è¡Œä¸ºï¼ˆæ—  Fallbackï¼‰ï¼š** Xray ä¼šç›´æ¥æ–­å¼€è¿æ¥ï¼Œæˆ–è€…è¿”å›ä¸€ä¸ª **TLS é”™è¯¯**ã€‚è¿™æœ¬èº«ä¸ä¼šæš´éœ²æ‚¨æ­£åœ¨è¿è¡Œä»£ç†ï¼Œä½†å¦‚æœå®¡æŸ¥ç³»ç»Ÿå¯¹è¯¥ IP è¿›è¡Œä¸»åŠ¨æ¢æµ‹ï¼Œè¿™ç§â€œä¸æ­£å¸¸â€çš„å“åº”ï¼ˆTLS é”™è¯¯æˆ–æ— å“åº”ï¼‰å¯èƒ½ä¼šè¢«æ ‡è®°ä¸ºå¼‚å¸¸ã€‚
        
- **ç»“è®ºï¼š** ä»…ä¸ºäº†è®©ä»£ç†å·¥ä½œå’ŒæŠ—ä½ç®€å•çš„æ¢æµ‹ï¼ŒREALITY **ä¸éœ€è¦**ä¼ªè£…ç½‘é¡µã€‚
    

### 2. **è‡ªå·±æ­å»ºä¼ªè£…ç½‘é¡µ + è¯ä¹¦ï¼ˆFallbackï¼‰æ˜¯å¢å¼ºä¼ªè£…**

æ‚¨å’Œ Chat-GPT è®¨è®ºçš„é…ç½®ï¼ˆä½¿ç”¨ Nginx å’Œ Unix Socketï¼‰æ­£æ˜¯ä½¿ç”¨äº† Xray çš„ **`fallbacks`** åŠŸèƒ½ã€‚è¿™ä¸ªåŠŸèƒ½çš„ç›®çš„å°±æ˜¯ä¸ºäº†å¢å¼ºä¼ªè£…ï¼Œæé«˜â€œå¯ä¿¡åº¦â€ã€‚

|**æœºåˆ¶**|**æè¿°**|**ç›®çš„**|
|---|---|---|
|**REALITY**|**å¯¹å¤–ï¼š** ä¼ªè£…æˆ `www.apple.com`ï¼ˆè¯±é¥µç½‘ç«™ï¼‰ã€‚|**æŠµæŠ—ä¸»åŠ¨æ¢æµ‹ã€‚** æ¶ˆé™¤åè®®æŒ‡çº¹ã€‚|
|**Fallback**|**å¯¹å†…ï¼š** å°†é REALITY æµé‡ï¼ˆå¦‚æµè§ˆå™¨è®¿é—®ï¼‰å›è½ç»™æœ¬åœ° Nginxï¼ŒNginx æä¾›æ‚¨çš„é™æ€ç½‘é¡µã€‚|**æé«˜å¯ä¿¡åº¦ã€‚** ç¡®ä¿æ™®é€šè®¿é—®èƒ½çœ‹åˆ°ä¸€ä¸ª**æ­£å¸¸çš„ç½‘ç«™**ï¼Œè€Œä¸æ˜¯ä¸€ä¸ª TLS é”™è¯¯ï¼Œä½¿å…¶çœ‹èµ·æ¥åƒä¸€ä¸ªæ­£å¸¸çš„æ‰˜ç®¡ç½‘ç«™ã€‚|

#### å…³äºâ€œè‡ªå·±æ­å»ºè¯ä¹¦â€çš„æ¾„æ¸…ï¼š

åœ¨æ‚¨å½“å‰çš„ **REALITY + Fallback** æ¶æ„ä¸­ï¼Œå­˜åœ¨ä¸¤ç§ä¸åŒçš„ SSL/TLS å¤„ç†æ–¹å¼ï¼š

1. **REALITY å®¢æˆ·ç«¯è¿æ¥ï¼š**
    
    - Xray ä½¿ç”¨ **å¤–éƒ¨è¯±é¥µç½‘ç«™** çš„è¯ä¹¦ä¿¡æ¯è¿›è¡Œè®¤è¯ã€‚
        
    - **ä¸éœ€è¦**æ‚¨è‡ªå·±åŸŸåçš„è¯ä¹¦ã€‚
        
2. **Fallback æµè§ˆå™¨è®¿é—®ï¼š**
    
    - Xray å°†è¿æ¥è½¬å‘ç»™ Nginxã€‚
        
    - **Nginx æ¥æ”¶çš„æ˜¯æœªåŠ å¯†çš„ HTTP æµé‡**ï¼ˆå› ä¸º Xray å·²ç»è§£å¯†ï¼‰ã€‚
        
    - **ä¸éœ€è¦** Nginx é…ç½®æ‚¨è‡ªå·±åŸŸåçš„è¯ä¹¦ã€‚
        

---

### æ€»ç»“å’Œæœ€ç»ˆå»ºè®®

æ‚¨å¬åˆ°çš„ä¸¤ç§è¯´æ³•éƒ½æ˜¯å¯¹çš„ï¼Œä½†é€‚ç”¨äºä¸åŒåœºæ™¯ï¼š

|**åœºæ™¯**|**fallbacks æ˜¯å¦å¿…é¡»**|**å»ºè®®çš„æ“ä½œ**|
|---|---|---|
|**åŸºç¡€è¿è¡Œ**|å¦|ä»…é…ç½® REALITY çš„ `dest` å’Œ `serverNames` ä¸º**å¤–éƒ¨é«˜ä¿¡èª‰ç½‘ç«™**ã€‚|
|**å¢å¼ºä¼ªè£…**|**å¼ºçƒˆæ¨è**|**é…ç½® Fallbacks** å°†é REALITY æµé‡è½¬å‘ç»™æœ¬åœ° Nginxã€‚Nginx æä¾›ä¸€ä¸ªç®€å•çš„**é™æ€ç½‘é¡µ**ã€‚|
|**è‡ªè¡Œç”³è¯·è¯ä¹¦**|å¦|**ä¸å»ºè®®**åœ¨ Nginx ä¸Šä½¿ç”¨è¯ä¹¦ï¼Œå› ä¸º Xray å·²ç»å¤„ç†äº† 443 ç«¯å£çš„ TLSã€‚Nginx åªéœ€è¦ç›‘å¬å†…éƒ¨çš„ HTTP ç«¯å£/Socket å³å¯ã€‚|

**æ‚¨ç›®å‰çš„æ–¹æ¡ˆï¼ˆREALITY + Fallback åˆ° Nginx é™æ€é¡µ + Unix Socketï¼‰æ˜¯ç›®å‰å…¬è®¤çš„**æœ€ä½³å®è·µ**ï¼Œå®ƒæœ€å¤§é™åº¦åœ°åˆ©ç”¨äº† REALITY çš„æŠ—æ¢æµ‹èƒ½åŠ›å’Œ Fallback çš„ä¼ªè£…å¯ä¿¡åº¦ã€‚**

è¯·ç»§ç»­ä½¿ç”¨æ‚¨ä¿®æ­£åçš„é…ç½®ï¼š

1. **Xrayï¼š** `dest` å’Œ `serverNames` å¡«å†™**å¤–éƒ¨é«˜ä¿¡èª‰ç½‘ç«™**ï¼ˆå¦‚ `www.apple.com`ï¼‰ã€‚
    
2. **Xrayï¼š** å¯ç”¨ `fallbacks` è§„åˆ™ï¼ŒæŒ‡å‘æœ¬åœ° Nginx çš„ Unix Socketã€‚
    
3. **Nginxï¼š** ç›‘å¬ Unix Socketï¼Œæä¾›é™æ€ç½‘é¡µï¼Œ**ä¸é…ç½® SSL è¯ä¹¦**ã€‚

ä½†å®˜æ–¹æ–‡æ¡£é‡Œâ€œå°å°ç™½ç™½è¯æ–‡â€ç³»åˆ—é‡Œè¯´åˆ°éœ€è¦ä¸ªäººç”³è¯·è‡ªæœ‰åŸŸåè¯ä¹¦ï¼ˆhttps://xtls.github.io/document/level-0/ch06-certificates.htmlï¼‰ï¼Œæ˜¯è¯´è·Ÿæˆ‘è¦æ­å»ºçš„æ¨¡å¼ä¸åŒå—ï¼Ÿ

æ‚¨æŒ‡å‡ºçš„æ–‡æ¡£éå¸¸å…³é”®ï¼Œå®ƒæ­ç¤ºäº† Xray çš„**å¦ä¸€ç§**é…ç½®æ¨¡å¼ï¼Œå³ **â€œè‡ªç›—â€/â€œè‡ªæˆ‘çªƒå–â€ï¼ˆSteal Oneselfï¼‰æ¨¡å¼**ï¼Œè¿™ç§æ¨¡å¼ä¸æˆ‘ä»¬å‰é¢è®¨è®ºçš„ **REALITY æ¨¡å¼**æœ‰æœ¬è´¨åŒºåˆ«ã€‚

### ç»“è®ºï¼šæ¨¡å¼ä¸åŒï¼Œè¯ä¹¦ç”¨é€”ä¸åŒ

æ‚¨æåˆ°çš„æ–‡æ¡£ï¼ˆ[ch06-certificates.html](https://xtls.github.io/en/document/level-0/ch06-certificates.html)ï¼‰æ˜¯é’ˆå¯¹ **VLESS/Trojan + XTLS/TLS** æˆ– **REALITY çš„â€œè‡ªç›—â€ï¼ˆSteal Oneselfï¼‰å˜ç§** æ¨¡å¼å‡†å¤‡è¯ä¹¦ã€‚

æ‚¨ç›®å‰æ­å»ºçš„æ˜¯ **REALITY æ¨¡å¼**ï¼Œè¿™ä¸¤ç§æ¨¡å¼ä¸‹è¯ä¹¦çš„ä½¿ç”¨é€»è¾‘æ˜¯ä¸åŒçš„ï¼š

|**æ¨¡å¼**|**Xray security**|**æ˜¯å¦éœ€è¦è‡ªå·±çš„åŸŸåè¯ä¹¦ï¼Ÿ**|**è¯ä¹¦ç”¨é€”**|**æ‚¨çš„é…ç½®ï¼ˆåº”æœ‰ï¼‰**|
|---|---|---|---|---|
|**1. ä¼ ç»Ÿ TLS**|`tls`|**æ˜¯ (å¿…é¡»)**|ç”¨äº TLS æ¡æ‰‹ï¼Œè¯æ˜ VPS èº«ä»½ã€‚|ä¸é€‚ç”¨äºæ‚¨å½“å‰çš„ REALITY é…ç½®ã€‚|
|**2. XTLS**|`xtls`|**æ˜¯ (å¿…é¡»)**|ç”¨äº XTLS æ¡æ‰‹ï¼Œæ¶ˆé™¤æ•°æ®æŒ‡çº¹ã€‚|ä¸é€‚ç”¨äºæ‚¨å½“å‰çš„ REALITY é…ç½®ã€‚|
|**3. REALITY (è¯±é¥µ)**|`reality`|**å¦**|å®¢æˆ·ç«¯ä» `dest` ç½‘ç«™ï¼ˆå¦‚ Appleï¼‰çš„è¯ä¹¦ä¸­çªƒå–ä¿¡æ¯ï¼Œä¼ªè£…æˆè¯¥ç½‘ç«™ã€‚æ‚¨çš„ VPS ä¸éœ€è¦è‡ªå·±çš„è¯ä¹¦ã€‚|**æˆ‘ä»¬æ¨èçš„æ–¹æ¡ˆã€‚**|
|**4. REALITY (è‡ªç›—)**|`reality`|**æ˜¯ (å¯é€‰å¢å¼º)**|å°† `dest` æŒ‡å‘ **æœ¬åœ°ç›‘å¬çš„ã€å¸¦æœ‰æ‚¨è‡ªå·±åŸŸåçš„è¯ä¹¦çš„ç½‘ç«™**ã€‚|**ä¸€ç§æ›´å¤æ‚çš„å¢å¼ºæ¨¡å¼ã€‚**|

### ğŸ” è¯¦ç»†åˆ†æï¼šREALITY æ¨¡å¼ä¸â€œè‡ªç›—â€æ¨¡å¼çš„åŒºåˆ«

#### æ¨¡å¼ä¸€ï¼šREALITY (è¯±é¥µæ¨¡å¼) â€” æ‚¨åº”ä½¿ç”¨çš„æ¨¡å¼

- **é…ç½®æ–¹å¼ï¼š**
    
    - `realitySettings.dest`: **å¤–éƒ¨é«˜ä¿¡èª‰ç½‘ç«™**ï¼ˆå¦‚ `www.apple.com:443`ï¼‰
        
    - `realitySettings.serverNames`: **å¤–éƒ¨é«˜ä¿¡èª‰ç½‘ç«™åŸŸå**ï¼ˆå¦‚ `www.apple.com`ï¼‰
        
- **è¯ä¹¦æ¥æºï¼š** Xray ä» **å¤–éƒ¨ç½‘ç«™** åŠ¨æ€çªƒå–è¯ä¹¦ã€‚
    
- **ä¼˜åŠ¿ï¼š** ä¼ªè£…æˆå›½é™…å¤§å‚ï¼Œå®‰å…¨æ€§æé«˜ï¼Œ**ä¸éœ€è¦**ä¸ºæ‚¨çš„åŸŸåç”³è¯·å’Œç»´æŠ¤è¯ä¹¦ã€‚
    
- **æ‚¨çš„ Nginx ä¼ªè£…ï¼š** Nginx åªå¤„ç† **Fallbacks** æµé‡ï¼Œä¸éœ€è¦è¯ä¹¦ï¼Œå› ä¸º Xray å·²ç»å®Œæˆäº† 443 ç«¯å£çš„ TLS æ¡æ‰‹ã€‚
    

#### æ¨¡å¼äºŒï¼šREALITY (è‡ªç›—/Steal Oneself) â€” æ–‡æ¡£ä¸­å¯èƒ½æåˆ°çš„å¢å¼ºæ¨¡å¼

- **é…ç½®æ–¹å¼ï¼š**
    
    - æ‚¨éœ€è¦åœ¨ VPS ä¸Šä¸º**æ‚¨çš„åŸŸå**ï¼ˆå¦‚ `example.com`ï¼‰ç”³è¯· Let's Encrypt è¯ä¹¦ã€‚
        
    - æ‚¨éœ€è¦ç”¨ Nginxï¼ˆæˆ–å…¶ä»– Web Serverï¼‰ç›‘å¬ä¸€ä¸ª**æœ¬åœ° HTTPS ç«¯å£**ï¼ˆä¾‹å¦‚ `127.0.0.1:8443`ï¼‰ï¼Œå¹¶é…ç½®æ‚¨çš„**è‡ªæœ‰è¯ä¹¦**ã€‚
        
    - `realitySettings.dest`: **æŒ‡å‘è¿™ä¸ªæœ¬åœ° HTTPS ç«¯å£**ï¼ˆå¦‚ `127.0.0.1:8443`ï¼‰
        
    - `realitySettings.serverNames`: **æ‚¨è‡ªå·±çš„åŸŸå**ï¼ˆå¦‚ `example.com`ï¼‰
        
- **è¯ä¹¦æ¥æºï¼š** Xray ä»**æ‚¨è‡ªå·±æœ¬åœ°çš„ç½‘ç«™**çªƒå–è¯ä¹¦ã€‚
    
- **ä¼˜åŠ¿ï¼š** é¿å…äº†å¯¹å¤–éƒ¨ç½‘ç«™ï¼ˆå¦‚ Appleï¼‰çš„ä¾èµ–ï¼Œè¯ä¹¦è¿‡æœŸã€è¿æ¥é—®é¢˜ç­‰éƒ½ç”±æ‚¨è‡ªå·±æ§åˆ¶ã€‚
    
- **åŠ£åŠ¿ï¼š**
    
    1. **å®‰å…¨æ€§é™ä½ï¼š** æ‚¨çš„ VPS IP å§‹ç»ˆè¿”å›æ‚¨è‡ªå·±åŸŸåçš„è¯ä¹¦ï¼Œæ— æ³•ä¼ªè£…æˆå›½é™…å¤§å‚ï¼Œå®¹æ˜“è¢«æ ‡è®°ã€‚
        
    2. **ç»´æŠ¤æˆæœ¬é«˜ï¼š** æ‚¨å¿…é¡»å®šæœŸç»­ç­¾å’Œç»´æŠ¤è‡ªå·±çš„è¯ä¹¦ã€‚
        

### æ€»ç»“å’Œå»ºè®®

**åŸºäºæ‚¨çš„ç›®æ ‡ï¼ˆè‡ªå»º VPN å¹¶æœ€å¤§é™åº¦åœ°ä¼ªè£…ï¼‰ï¼š**

1. **æ¨èæ‚¨ç»§ç»­ä½¿ç”¨â€œREALITY (è¯±é¥µæ¨¡å¼)â€ï¼š** å³ `dest` å¡«å†™ **å¤–éƒ¨é«˜ä¿¡èª‰ç½‘ç«™**ã€‚è¿™æ˜¯ç›®å‰å…¬è®¤çš„æœ€å®‰å…¨ã€æŠ—æ¢æµ‹èƒ½åŠ›æœ€å¼ºçš„æ–¹æ¡ˆã€‚
    
2. **æ— éœ€ç”³è¯·è¯ä¹¦ï¼š** åœ¨è¿™ç§æ¨¡å¼ä¸‹ï¼Œæ‚¨**ä¸éœ€è¦**ä¸ºæ‚¨è‡ªå·±çš„åŸŸåç”³è¯·è¯ä¹¦ã€‚
    

æ‚¨ä¹‹å‰æä¾›çš„é…ç½®å’Œæˆ‘ä»¬æœ€ç»ˆä¿®æ­£çš„ç‰ˆæœ¬ï¼ˆä½¿ç”¨ `www.apple.com` ä½œä¸ºè¯±é¥µï¼Œä½¿ç”¨ Fallback è½¬å‘åˆ° Nginxï¼‰æ­£æ˜¯éµå¾ªäº†æ¨¡å¼ä¸€çš„æœ€ä½³å®è·µã€‚è¯·å¿½ç•¥ä¸â€œè¯ä¹¦ç”³è¯·â€ç›¸å…³çš„æ–‡æ¡£ï¼Œé™¤éæ‚¨æ‰“ç®—åˆ‡æ¢åˆ°æ›´å¤æ‚ä¸”å®‰å…¨æ€§å¯èƒ½æ›´ä½çš„â€œè‡ªç›—â€æ¨¡å¼ã€‚

## 2.å¾…ç»­ï¼Œè¯´ä½ å‘¢ï¼ŒGPTã€‚ã€‚ã€‚ã€‚ã€‚

## å¯¹ Gemini çš„è§£é‡Šçš„æ ¸æŸ¥ä¸æœ€ä¼˜æ–¹æ¡ˆå»ºè®®ï¼ˆç»“è®ºï¼‰

æˆ‘å·²ç»æ ¸æŸ¥äº†ä½ è´´å‡ºçš„ Gemini å›ç­”ï¼Œå®ƒæ€»ä½“æ–¹å‘æ˜¯æ­£ç¡®çš„ â€”â€” ä¸»è¦æ­£ç¡®åŒºåˆ†äº† **REALITYï¼ˆè¯±é¥µï¼‰** ä¸ **REALITYï¼ˆè‡ªç›—/Steal Oneselfï¼‰** ä¸¤ç§ä½¿ç”¨æ–¹å¼ï¼Œå¹¶æŒ‡å‡º `dest` / `serverNames` ä¸ `fallbacks` çš„æ­£ç¡®ç”¨é€”ã€‚ä¸è¿‡æœ‰ä¸¤ç‚¹æˆ‘æƒ³å¼ºè°ƒã€ä¿®æ­£æˆ–è¡¥å……ï¼š

1. **Gemini å¯¹ `dest` å¿…é¡»æ˜¯â€œå¤–éƒ¨é«˜ä¿¡èª‰ç«™ç‚¹â€çš„è¯´æ³•**â€”â€”è¿™æ˜¯â€œæ¨èâ€ä¸æ˜¯ç»å¯¹å¼ºåˆ¶ã€‚ä½¿ç”¨å¤–éƒ¨ decoyï¼ˆå¦‚ `www.apple.com:443`ï¼‰æ˜¯æœ€ä½³å®è·µï¼Œèƒ½æœ€å¤§åŒ–éšè”½æ€§ï¼›ä½†åœ¨æŸäº›åœºæ™¯ä¸‹ï¼ˆè‡ªæ§ç¯å¢ƒã€å…¬å¸å†…ç½‘ï¼‰ä¹Ÿå¯ä»¥ä½¿ç”¨â€œè‡ªç›—â€æ–¹å¼ï¼ˆè‡ªæœ‰è¯ä¹¦å’Œæœ¬åœ° HTTPSï¼‰ï¼Œåªæ˜¯éšè”½æ€§å’Œç»´æŠ¤æˆæœ¬ä¸åŒã€‚
    
2. **`fallbacks` é‡è¦æ€§**â€”â€”Gemini æ­£ç¡®æŒ‡å‡ºè‹¥ä½ æƒ³åœ¨æ™®é€šæµè§ˆå™¨è®¿é—®æ—¶çœ‹åˆ°æ­£å¸¸é¡µé¢ï¼Œå¿…é¡»æŠŠ `fallbacks` æŒ‡å‘æœ¬åœ°çš„åç«¯ï¼ˆUnix socket æˆ– 127.0.0.1:8080ï¼‰ã€‚æˆ‘åœ¨ç”Ÿæˆçš„ `xray-config.fixed.json` ä¸­å·²ç»åŠ å…¥äº†è¿™æ ·çš„ `fallbacks`ï¼Œå¹¶æŠŠ Nginx é…ç½®ä¸ºç›‘å¬ `/dev/shm/h2c.sock`ã€‚
    

### æœ€ä¼˜æ–¹æ¡ˆï¼ˆæˆ‘çš„å»ºè®®ï¼‰

- **ç»§ç»­ä½¿ç”¨ REALITY (è¯±é¥µæ¨¡å¼)**ï¼šå°† `realitySettings.dest` æŒ‡å‘ç¨³å®šçš„å¤–éƒ¨å¤§ç«™ï¼ˆæˆ‘ç”¨ `www.apple.com:443` ä½œä¸ºç¤ºä¾‹ï¼‰ã€‚è¿™æ˜¯å¯¹æŠ—æ¢æµ‹ã€æœ€éšè”½çš„æ–¹æ¡ˆï¼Œä¸”ä¸éœ€è¦ä½ ä¸ºåŸŸåç»´æŠ¤è¯ä¹¦ã€‚
    
- **ä¿ç•™æœ¬åœ°ä¼ªè£…é¡µ + fallback**ï¼šåœ¨ Xray ä¸­é…ç½® `fallbacks` æŒ‡å‘ `unix:/dev/shm/h2c.sock`ï¼Œè®© Nginx æä¾›ä¸€ä¸ªçœŸå®çš„é™æ€é¡µé¢ç»™æ™®é€šæµè§ˆå™¨è®¿é—®ï¼Œè¿™æœ‰åŠ©äºâ€œçœ‹èµ·æ¥æ­£å¸¸â€çš„ä¼ªè£…ã€‚
    
- **é¿å…å°† SSL é…ç½®æ”¾å…¥ Nginx**ï¼ˆå½“ Xray å¤„ç† TLS æ—¶ï¼‰ï¼Œå¦åˆ™ä¼šé€ æˆå†²çªæˆ–ä¿¡æ¯æ³„éœ²ã€‚
    
- **åªåœ¨ä½ éœ€è¦å®Œå…¨è‡ªæ§ï¼ˆå¹¶æ¥å—æ›´é«˜æ¢æµ‹é£é™©ï¼‰æ—¶ä½¿ç”¨â€œè‡ªç›—â€æ¨¡å¼**ï¼ˆå³æŠŠ `dest` æŒ‡å‘ä½ çš„è¯ä¹¦æœåŠ¡å¹¶ç®¡ç†è¯ä¹¦ï¼‰ã€‚é€šå¸¸ä¸æ¨èä½œä¸ºé¦–é€‰ã€‚
    
## å¥½å§ï¼Œå¤šå¤šæé—®ï¼Œå¤šè€ƒè™‘ï¼Œæœ€åè¿˜æ˜¯ç”¨è‡ªå®¶çš„è¯ä¹¦ã€‚

 **A æ–¹æ¡ˆï¼ˆâ€œå·åˆ«äººâ€ / Decoy æ¨¡å¼ï¼‰ã€æ–¹æ¡ˆ B ï¼ˆâ€œå·è‡ªå·±â€ / Self-Impersonation æ¨¡å¼ï¼‰**ã€‚  
æˆ‘æ¥ä¸ºä½ å®Œæ•´åˆ†æ2ä¸ªæ¨¡å¼çš„åŸç†ã€ä¼˜ç¼ºç‚¹ã€é…ç½®ç»“æ„ã€è¿ç»´å½±å“ï¼Œæœ€åç»™å‡º**æœ€ä¼˜å®ç°æ€è·¯ä¸é…ç½®æ¨¡æ¿**ã€‚

---

## ğŸ§­ ä¸€ã€ä¸¤ç§ REALITY æ¨¡å¼çš„æ ¸å¿ƒåŒºåˆ«å›é¡¾

|é¡¹ç›®|æ–¹æ¡ˆ Aï¼šå·åˆ«äººï¼ˆdecoy æ¨¡å¼ï¼‰|æ–¹æ¡ˆ Bï¼šå·è‡ªå·±ï¼ˆself-impersonation æ¨¡å¼ï¼‰|
|---|---|---|
|TLS ä¼ªè£…ç›®æ ‡ (`dest` / `serverNames`)|å¤–éƒ¨é«˜ä¿¡èª‰ç½‘ç«™ï¼ˆå¦‚ `www.apple.com:443`ï¼‰|è‡ªå·±åŸŸåï¼ˆå¦‚ `juan-cool.com:443`ï¼‰|
|è¯ä¹¦æ¥æº|ä»ç›®æ ‡ç«™æ¨¡æ‹Ÿæ¡æ‰‹ï¼Œ**ä¸éœ€è¦**æœ¬åœ°è¯ä¹¦|ä½ è‡ªå·±ç­¾å‘çš„ Let's Encrypt æˆ– acme.sh è¯ä¹¦|
|Xray ç›‘å¬|ç›´æ¥ 443 ç«¯å£|åŒæ · 443 ç«¯å£|
|Nginx ç”¨é€”|ä»… fallback ä¼ªè£…ç½‘é¡µ|å¯åš HTTPS é™æ€ç½‘é¡µå¹¶è¢« REALITY çªƒå–æ¡æ‰‹ä¿¡æ¯|
|éšè”½æ€§|â­â­â­â­ æé«˜|â­â­ è¾ƒä½ï¼ˆè¯ä¹¦å¯è¯†åˆ«ä¸ºè‡ªæœ‰ï¼‰|
|å¯æ§æ€§|â­â­ ä¾èµ–å¤–éƒ¨ç«™ç‚¹|â­â­â­â­ å®Œå…¨è‡ªæ§|
|ç»´æŠ¤æˆæœ¬|ä½|é«˜ï¼ˆéœ€ç»­ç­¾è¯ä¹¦ï¼‰|
|æ¨èåœºæ™¯|é«˜å®¡æŸ¥ç¯å¢ƒã€çŸ­æœŸéƒ¨ç½²|é•¿æœŸã€ç¨³å®šã€è‡ªç®¡åŸŸå|

---

## âš™ï¸ äºŒã€æ–¹æ¡ˆ B çš„å®ç°æœºåˆ¶

1. **ä½ æ‹¥æœ‰è‡ªå·±çš„åŸŸå** ï¼ˆä¾‹å¦‚ `juan-cool.com`ï¼‰ã€‚
    
2. **Nginx** ä½¿ç”¨ Let's Encrypt è¯ä¹¦ç›‘å¬ä¸€ä¸ª HTTPS ç«¯å£ï¼ˆå¯ä¸º `127.0.0.1:8443`ï¼‰ã€‚
    
3. **Xray** çš„ `realitySettings.dest` è®¾ä¸º `127.0.0.1:8443`ï¼Œ`serverNames` ä¸º `juan-cool.com`ã€‚
    
    - è¿™æ · Xray åœ¨å¯åŠ¨æ—¶ä¼šä»ä½ æœ¬åœ° Nginx çš„ Server Hello â€œå·å–â€æ¡æ‰‹ç‰¹å¾ã€‚
        
4. å®¢æˆ·ç«¯è¿æ¥ 443 ç«¯å£æ—¶ï¼ŒXray å‘å®¢æˆ·ç«¯è¡¨ç°å¾—å¥½åƒè‡ªå·±æ˜¯ `juan-cool.com` çš„ HTTPS æœåŠ¡å™¨ã€‚
    
5. æ™®é€šæµè§ˆå™¨è®¿é—® 443 æ—¶ï¼Œåˆ™ä¼šé€šè¿‡ fallback è½¬äº¤ Nginx çš„ é™æ€ç½‘é¡µï¼Œå®ç°â€œçœ‹èµ·æ¥æ˜¯ä½ è‡ªå·±çš„ç½‘ç«™â€ã€‚
    

---

## ğŸ” ä¸‰ã€è¯ä¹¦ç®¡ç†ä¸ Nginx é…ç½®æ€è·¯

1. ä½¿ç”¨ `acme.sh` æˆ– `certbot` ç­¾å‘ `juan-cool.com` è¯ä¹¦ã€‚
    
    ```bash
    sudo mkdir -p /etc/ssl/juan-cool.com
    sudo acme.sh --install-cert -d juan-cool.com \
      --key-file       /etc/ssl/juan-cool.com/juan-cool.com.key \
      --fullchain-file /etc/ssl/juan-cool.com/fullchain.cer \
      --reloadcmd "systemctl reload nginx"
    ```
    
2. Nginx ç¤ºä¾‹ï¼ˆç›‘å¬ 8443 ä»…ä¾› Xray å·æ¡æ‰‹ï¼Œä¸å¯¹å¤–æš´éœ²ï¼‰ï¼š
    
    ```nginx
    server {
        listen 127.0.0.1:8443 ssl http2;
        server_name juan-cool.com;
    
        ssl_certificate     /etc/ssl/juan-cool.com/fullchain.cer;
        ssl_certificate_key /etc/ssl/juan-cool.com/juan-cool.com.key;
        ssl_protocols       TLSv1.3;
    
        root /var/www/juan-cool.com;
        index index.html;
    
        access_log off;
        error_log /var/log/nginx/juan-cool.local-error.log;
    
        location / {
            try_files $uri $uri/ =404;
        }
    }
    
    # å¤–éƒ¨æµè§ˆå™¨è®¿é—® 80 â†’ è·³è½¬ 443
    server {
        listen 80;
        server_name juan-cool.com www.juan-cool.com;
        return 301 https://$host$request_uri;
    }
    ```
    

---

## ğŸ”§ å››ã€Xray é…ç½®è¦ç‚¹ï¼ˆSelf-Impersonationï¼‰

```json
{
  "inbounds": [
    {
      "port": 443,
      "protocol": "vless",
      "settings": {
        "clients": [
          { "id": "UUID-USER1", "flow": "xtls-rprx-vision" }
        ],
        "decryption": "none",
        "fallbacks": [
          { "dest": "unix:/dev/shm/h2c.sock", "xver": 1 }
        ]
      },
      "streamSettings": {
        "network": "tcp",
        "security": "reality",
        "realitySettings": {
          "show": false,
          "dest": "127.0.0.1:8443",
          "serverNames": ["juan-cool.com"],
          "privateKey": "YOUR-PRIVATE-KEY",
          "shortIds": ["0123456789abcdef"],
          "fingerprint": "chrome"
        }
      }
    }
  ],
  "outbounds": [{ "protocol": "freedom" }]
}
```

---

## ğŸ§© äº”ã€ä¼˜ç¼ºç‚¹æ·±å…¥åˆ†æ

### âœ… ä¼˜ç‚¹

- **å¯æ§æ€§æé«˜**ï¼šä¸å—å¤–éƒ¨ç½‘ç«™å˜åŠ¨å½±å“ï¼ŒTLS å‚æ•°å›ºå®šã€‚
    
- **éšç§å®Œæ•´**ï¼šæ¡æ‰‹æ•°æ®ä¸å‡ºæœºæˆ¿ã€‚
    
- **é•¿æœŸç¨³å®š**ï¼šé€‚åˆè‡ªå»ºç§ç”¨èŠ‚ç‚¹æˆ–å›¢é˜Ÿå†…éƒ¨ä½¿ç”¨ã€‚
    

### âš ï¸ ç¼ºç‚¹

- **ä¼ªè£…åº¦é™ä½**ï¼šSNI ä¸è¯ä¹¦éƒ½å±äºä½ åŸŸåï¼Œæ¢æµ‹ç³»ç»Ÿèƒ½çœ‹å‡ºä½ çš„ç½‘ç«™å³ä»£ç†æœåŠ¡ã€‚
    
- **è¯ä¹¦ç»­ç­¾éº»çƒ¦**ï¼šéœ€ root æƒé™æˆ– cron ä»»åŠ¡ç®¡ç† acme.shã€‚
    
- **Nginx ç«¯å£å®‰å…¨æ€§**ï¼šå¿…é¡»ä»…ç›‘å¬ 127.0.0.1ï¼Œé¿å…æš´éœ² 8443ã€‚
    

---

## ğŸ§  å…­ã€å®æˆ˜å»ºè®®ï¼ˆå¯¹ä½ è€Œè¨€ï¼‰

|åœºæ™¯|å»ºè®®æ–¹æ¡ˆ|
|---|---|
|ä½ åªè‡ªç”¨æˆ–å°èŒƒå›´åˆ†äº«|âœ… **B æ–¹æ¡ˆï¼ˆå·è‡ªå·±ï¼‰**ï¼Œç¨³å®šå¯æ§ï¼Œæ˜“ç›‘æ§ã€‚|
|ä½ è¦å…¬å¼€èŠ‚ç‚¹æˆ–æŠ—æ¢æµ‹|âš ï¸ ä»æ¨è A æ–¹æ¡ˆï¼ˆdecoyï¼‰ï¼Œéšè”½åº¦é«˜ã€‚|
|æƒ³å…¼é¡¾ä¸¤è€…|å¯éƒ¨ç½²ä¸¤ä¸ª inboundï¼šä¸€ä¸ª decoy ä¾›å¤–éƒ¨è®¿é—®ï¼Œå¦ä¸€ä¸ª self-steal ä¾›ç§ç”¨ã€‚|

---

## ğŸªœ ä¸ƒã€è¿ç»´ä¸å®‰å…¨å®è·µ

1. **è‡ªåŠ¨ç»­ç­¾**ï¼š`acme.sh --cron` å†™å…¥ root çš„ crontabã€‚
    
2. **æƒé™**ï¼š
    
    ```bash
    sudo chown -R root:root /etc/ssl/juan-cool.com
    sudo chmod 600 /etc/ssl/juan-cool.com/*.key
    ```
    
3. **é˜²ç«å¢™**ï¼šåªæ”¾é€š 443/80ï¼›æœ¬åœ° 8443 ä¸å¼€æ”¾ã€‚
    
4. **æ—¥å¿—**ï¼šxray ä¸ nginx åˆ†ç›®å½•ä¿å­˜ï¼Œé˜²æ­¢ä¿¡æ¯æ³„éœ²ã€‚
    

---

## ğŸ§© å…«ã€æ€»ç»“å¯¹æ¯”ï¼ˆä¾¿äºå†³ç­–ï¼‰

|æŒ‡æ ‡|æ–¹æ¡ˆ A (å·åˆ«äºº)|æ–¹æ¡ˆ B (å·è‡ªå·±)|
|---|---|---|
|éšè”½æ€§|ğŸŸ¢ æé«˜|ğŸŸ¡ ä¸­ç­‰|
|æ§åˆ¶æƒ|ğŸ”´ ä½|ğŸŸ¢ é«˜|
|ç»´æŠ¤|ğŸŸ¢ ç®€æ˜“|ğŸ”´ å¤æ‚|
|é•¿æœŸè¿è¡Œ|âš ï¸ å¤–éƒ¨å˜åŠ¨é£é™©|ğŸŸ¢ ç¨³å®š|
|æ³•å¾‹é£é™©|âš ï¸ æ½œåœ¨äº‰è®®|ğŸŸ¢ å®‰å…¨|
|å»ºè®®ç”¨é€”|å…¬å¼€èŠ‚ç‚¹ / é«˜å®¡æŸ¥ç¯å¢ƒ|ç§ç”¨ / é•¿æœŸå›ºå®šèŠ‚ç‚¹|

---

## âœ… æœ€ç»ˆå»ºè®®ï¼ˆé’ˆå¯¹ä½ ï¼‰

ä½ è‹¥å·²æœ‰è‡ªå·±çš„ juan-cool.com åŸŸåã€Nginx ä¸ acme.sh ç¯å¢ƒï¼Œåˆ™**æ–¹æ¡ˆ B æ˜¯å®Œå…¨å¯è¡Œçš„ç¨³å®šé•¿æœŸæ–¹æ¡ˆ**ã€‚  
é…ç½®å…³é”®æ˜¯ï¼š

- `realitySettings.dest` æ”¹ä¸º `127.0.0.1:8443`
    
- `serverNames` å¡« `juan-cool.com`
    
- ä¿æŒ Nginx 8443 ä»… 127.0.0.1 å¯è®¿é—®
    
- Fallback ä»æŒ‡å‘ unix socket ä»¥æ˜¾ç¤ºç½‘é¡µ
    

---

å¤ªå¥½äº† ğŸ‘ é‚£æˆ‘ä»¬æ¥ä¸ºä½ ç”Ÿæˆä¸€ä»½  
**æ··åˆå¼ Reality + ä¼ªè£…ç½‘é¡µé…ç½®æ¨¡æ¿** â€”â€” å…¼é¡¾æ€§èƒ½ã€å®‰å…¨ä¸éšè”½æ€§ã€‚

æœ¬æ–¹æ¡ˆå‡è®¾ç¯å¢ƒä¸ä¹‹å‰ä¸€è‡´ï¼š

- Debian 12/13
    
- Nginx å·²å®‰è£…
    
- åŸŸåï¼š`juan-cool.com`
    
- ç½‘ç«™ç›®å½•ï¼š`/var/www/juan-cool.com`
    
- è¯ä¹¦è·¯å¾„ï¼š`/etc/ssl/juan-cool.com/`
    
- Xray ä¸ Nginx ä½¿ç”¨æœ¬åœ°é€šä¿¡ï¼ˆTCP + Unix æ··åˆï¼‰
    

---

## ğŸ§© ä¸€ã€ç³»ç»Ÿæ¶æ„é€»è¾‘å›¾

```
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚   Internet  â”‚
                â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                  :443 â”‚
                  â–¼
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚ Xray (VLESS+REALITY)â”‚
          â”‚  dest=127.0.0.1:8443 â”‚
          â”‚  fallbackâ†’Unix Sock  â”‚
          â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚      â”‚
     127.0.0.1:8443     â”‚ Unix:/dev/shm/h2c.sock
                 â”‚      â”‚
                 â–¼      â–¼
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚  Nginx HTTPS (TLS site) â”‚
          â”‚  Nginx HTTP fallback    â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## âš™ï¸ äºŒã€Xray é…ç½®æ–‡ä»¶ `/usr/local/etc/xray/config.json`

```json
{
  "log": {
    "access": "/var/log/xray/access.log",
    "error": "/var/log/xray/error.log",
    "loglevel": "warning"
  },
  "inbounds": [
    {
      "port": 443,
      "protocol": "vless",
      "settings": {
        "clients": [
          {
            "id": "REPLACE_WITH_UUID",
            "flow": "xtls-rprx-vision",
            "email": "user1@juan-cool.com"
          }
        ],
        "decryption": "none",
        "fallbacks": [
          {
            "dest": "unix:/dev/shm/h2c.sock",
            "xver": 1
          }
        ]
      },
      "streamSettings": {
        "network": "tcp",
        "security": "reality",
        "realitySettings": {
          "show": false,
          "dest": "127.0.0.1:8443",
          "serverNames": ["juan-cool.com"],
          "privateKey": "REPLACE_WITH_PRIVATE_KEY",
          "shortIds": ["REPLACE_WITH_SHORTID"],
          "fingerprint": "chrome"
        }
      },
      "sniffing": {
        "enabled": true,
        "destOverride": ["http", "tls"]
      }
    }
  ],
  "outbounds": [
    { "protocol": "freedom" },
    { "protocol": "blackhole", "tag": "blocked" }
  ]
}
```

---

## ğŸŒ ä¸‰ã€Nginx é…ç½®æ–‡ä»¶ `/etc/nginx/sites-available/juan-cool.com`

### HTTPS ç«™ç‚¹ï¼ˆä¾› Reality å·æ¡æ‰‹ï¼‰

```nginx
server {
    listen 127.0.0.1:8443 ssl http2;
    server_name juan-cool.com;

    ssl_certificate     /etc/ssl/juan-cool.com/fullchain.cer;
    ssl_certificate_key /etc/ssl/juan-cool.com/juan-cool.com.key;
    ssl_protocols       TLSv1.3;
    ssl_session_cache   shared:SSL:10m;
    ssl_prefer_server_ciphers on;

    root /var/www/juan-cool.com;
    index index.html;

    access_log off;
    error_log /var/log/nginx/juan-cool.local-error.log;

    add_header X-Frame-Options "SAMEORIGIN";
    add_header X-Content-Type-Options "nosniff";
    add_header Referrer-Policy "strict-origin-when-cross-origin";
    add_header Strict-Transport-Security "max-age=31536000; includeSubDomains; preload" always;

    location / {
        try_files $uri $uri/ =404;
    }
}
```

---

### Fallback ä¼ªè£…ç½‘é¡µï¼ˆä¾›æ™®é€šè®¿é—®è€…çœ‹åˆ°ï¼‰

```nginx
server {
    listen unix:/dev/shm/h2c.sock proxy_protocol;
    http2 on;

    set_real_ip_from unix:;
    real_ip_header proxy_protocol;

    server_name juan-cool.com www.juan-cool.com;

    root /var/www/juan-cool.com;
    index index.html;

    access_log /var/log/nginx/juan-cool.access.log;
    error_log  /var/log/nginx/juan-cool.error.log;

    add_header X-Frame-Options "SAMEORIGIN";
    add_header X-Content-Type-Options "nosniff";
    add_header Referrer-Policy "strict-origin-when-cross-origin";

    location / {
        try_files $uri $uri/ =404;
    }
}

server {
    listen 80;
    server_name juan-cool.com www.juan-cool.com;
    return 301 https://$host$request_uri;
}
```

---

## ğŸ” å››ã€å®‰å…¨é‡ç‚¹æç¤ºï¼ˆå¿…çœ‹ï¼‰

|é¡¹ç›®|å†…å®¹|å‘½ä»¤|
|---|---|---|
|**è¯ä¹¦æƒé™**|é˜²æ­¢ Xray æ— æ³•è¯»å– key|`sudo chmod 600 /etc/ssl/juan-cool.com/*.key`|
|**Nginx ç”¨æˆ·è®¿é—®**|å…è®¸ `www-data` è®¿é—® `/var/www/juan-cool.com`|`sudo chown -R www-data:www-data /var/www/juan-cool.com`|
|**Socket æƒé™**|Xray + Nginx é€šä¿¡|`/dev/shm` é»˜è®¤å®‰å…¨ä¸”ä»… root å¯å†™|
|**é˜²ç«å¢™è§„åˆ™**|ä»…å¼€æ”¾ 80/443|`sudo ufw allow 80,443/tcp`|

---

## ğŸ§  äº”ã€éªŒè¯æµç¨‹

1. æµ‹è¯•é…ç½®æ­£ç¡®æ€§
    
    ```bash
    sudo nginx -t
    sudo systemctl reload nginx
    sudo xray run -test -conf /usr/local/etc/xray/config.json
    ```
    
2. å¯åŠ¨æœåŠ¡
    
    ```bash
    sudo systemctl restart xray
    sudo systemctl restart nginx
    ```
    
3. æµè§ˆå™¨è®¿é—®
    
    - `https://juan-cool.com` â†’ æ˜¾ç¤ºä¼ªè£…ç½‘é¡µ
        
    - å®¢æˆ·ç«¯è¿æ¥ï¼ˆRealityï¼‰ â†’ æ­£å¸¸ä»£ç†é€šä¿¡
        

---

## ğŸ§° å…­ã€è‡ªåŠ¨ç”Ÿæˆå·¥å…·ï¼ˆBashï¼‰

```bash
#!/bin/bash
echo "ç”Ÿæˆ Reality ç”¨æˆ·ä¸ ShortIDï¼š"
uuid=$(cat /proc/sys/kernel/random/uuid)
shortid=$(openssl rand -hex 8)
privkey=$(xray x25519 | grep Private | awk '{print $3}')

echo "UUID: $uuid"
echo "ShortID: $shortid"
echo "PrivateKey: $privkey"
```

---


---

## æé—®ï¼šå¤šç”¨æˆ·ä½¿ç”¨uuidåŒºåˆ†ï¼Œå¦‚ä½•ä¸shortidsé…åˆä½¿ç”¨ï¼Œè¿˜æ˜¯å¯ä»¥å…±ç”¨ä¸€ä¸ªshortids

éå¸¸å¥½çš„é—®é¢˜ âœ…  
è¿™æ˜¯ Reality é…ç½®é‡Œæœ€å®¹æ˜“è¢«å¿½ç•¥ã€ä½†ä¹Ÿæ˜¯â€œå¤šç”¨æˆ·æ”¯æŒâ€èƒ½å¦å®‰å…¨è¿è¡Œçš„å…³é”®ç‚¹ã€‚  
æˆ‘ä»¬æ¥ç³»ç»Ÿè§£é‡Šä¸€ä¸‹å¤šç”¨æˆ·æ—¶ï¼š

- `id`ï¼ˆå³ UUIDï¼‰
    
- `shortIds`
    
- å®ƒä»¬ä¹‹é—´çš„å…³ç³»ã€æœ€ä½³é…åˆæ–¹å¼ã€ä»¥åŠä¸ºä»€ä¹ˆâ€œå…±ç”¨ä¸€ä¸ª shortIdâ€é€šå¸¸ä¸æ˜¯æœ€ä½³æ–¹æ¡ˆã€‚
    

---

## ğŸ§© ä¸€ã€ä¸¤è€…çš„ä½œç”¨åŒºåˆ«

|é¡¹ç›®|å­—æ®µå|ä½œç”¨èŒƒå›´|è¯´æ˜|
|---|---|---|---|
|**UUID**|`"id"`|èº«ä»½è®¤è¯|æ¯ä¸ªç”¨æˆ·çš„å”¯ä¸€èº«ä»½å‡­è¯ï¼ˆç›¸å½“äºè´¦å·å¯†ç ï¼‰|
|**ShortID**|`"shortIds"`|æ¡æ‰‹ç‰¹å¾|Reality æ¡æ‰‹æ—¶çš„**æ··æ·†æ ‡è¯†**ï¼Œé˜²æ‰«æã€é˜²æ¢æµ‹ç”¨|

å®ƒä»¬æ˜¯ä¸¤å±‚æœºåˆ¶ï¼š

- **UUID** â†’ éªŒè¯â€œä½ æ˜¯è°â€ï¼ˆèº«ä»½ï¼‰
    
- **shortId** â†’ éªŒè¯â€œä½ æ˜¯ä¸æ˜¯æ‡‚æš—å·â€ï¼ˆæ˜¯å¦å±äºçœŸå®ç”¨æˆ·æµé‡ï¼‰
    

---

## âš™ï¸ äºŒã€æ¡æ‰‹è¿‡ç¨‹ç®€å›¾

```
Client â”€â”€â”€TLSæ¡æ‰‹â”€â”€â–º Xray (Reality)
  â”‚                   â”‚
  â”‚ å‘é€SNI + ShortID â”‚â”€â”€â”€>  Xrayæ£€æµ‹ShortIDæ˜¯å¦åŒ¹é…
  â”‚                   â”‚
  â”‚ å‘é€UUID          â”‚â”€â”€â”€>  XrayéªŒè¯èº«ä»½
```

åªæœ‰ **ShortID åŒ¹é… + UUID æ­£ç¡®** ä¸¤è€…éƒ½é€šè¿‡ï¼Œè¿æ¥æ‰è¢«æ¥å—ã€‚

---

## ğŸ§  ä¸‰ã€æ˜¯å¦å¯ä»¥å…±ç”¨ä¸€ä¸ª `shortId`ï¼Ÿ

å¯ä»¥ï¼Œä½†æœ‰å–èˆï¼š

|æ–¹æ¡ˆ|å¯è¡Œæ€§|ä¼˜ç‚¹|ç¼ºç‚¹|
|---|---|---|---|
|âœ… **å…±ç”¨ä¸€ä¸ª shortId**|âœ”ï¸ å¯è¡Œ|ç®€å•ã€é…ç½®æ–¹ä¾¿|å®‰å…¨æ€§ç•¥ä½ï¼šæ‰€æœ‰ç”¨æˆ·æ¡æ‰‹ç‰¹å¾ç›¸åŒï¼Œæ¢æµ‹è€…æ›´å®¹æ˜“å‘ç°|
|âœ… **æ¯ç”¨æˆ·ç‹¬ç«‹ shortId**|âœ”ï¸ æ¨è|å®‰å…¨æ€§æ›´é«˜ï¼Œæ¯äººæ¡æ‰‹ fingerprint ä¸åŒ|ç¨å¾®å¤šä¸€ç‚¹é…ç½®å·¥ä½œ|
|âš ï¸ **éšæœº shortId åŠ¨æ€ç”Ÿæˆ**|âŒ ä¸æ¨è|æ¯æ¬¡å˜åŠ¨ï¼Œå®¢æˆ·ç«¯éœ€åŒæ­¥ä¿®æ”¹|å®é™…ä¸å¯ç”¨ï¼Œéœ€ä¿æŒåŒ¹é…|

---

## ğŸ§© å››ã€é…ç½®ç¤ºä¾‹å¯¹æ¯”

### ğŸ”¸ å…±ç”¨ shortIdï¼ˆç®€å•æ–¹æ¡ˆï¼‰

```json
"clients": [
  { "id": "uuid-1", "flow": "xtls-rprx-vision" },
  { "id": "uuid-2", "flow": "xtls-rprx-vision" }
],
"realitySettings": {
  "show": false,
  "dest": "www.apple.com:443",
  "serverNames": ["www.apple.com"],
  "privateKey": "YOUR_PRIVATE_KEY",
  "shortIds": ["3f7a2b9c8d4e7f23"],   // æ‰€æœ‰äººå…±ç”¨
  "fingerprint": "chrome"
}
```

å®¢æˆ·ç«¯è¿æ¥æ—¶éƒ½ä½¿ç”¨åŒä¸€ä¸ª `sid=3f7a2b9c8d4e7f23`ã€‚

---

### ğŸ”¸ æ¯ç”¨æˆ·ç‹¬ç«‹ shortIdï¼ˆå®‰å…¨æ–¹æ¡ˆï¼‰

```json
"clients": [
  { "id": "uuid-1", "flow": "xtls-rprx-vision", "email": "user1@example.com" },
  { "id": "uuid-2", "flow": "xtls-rprx-vision", "email": "user2@example.com" }
],
"realitySettings": {
  "show": false,
  "dest": "www.apple.com:443",
  "serverNames": ["www.apple.com"],
  "privateKey": "YOUR_PRIVATE_KEY",
  "shortIds": ["a1b2c3d4e5f6a7b8", "f1e2d3c4b5a69788"],  // ä¸€ä¸€å¯¹åº”
  "fingerprint": "chrome"
}
```

åœ¨å®¢æˆ·ç«¯ï¼š

- ç”¨æˆ·1è¿æ¥ï¼š`sid=a1b2c3d4e5f6a7b8`
    
- ç”¨æˆ·2è¿æ¥ï¼š`sid=f1e2d3c4b5a69788`
    

> Reality ä¸è¦æ±‚ä¸¥æ ¼ä¸€ä¸€å¯¹åº”å…³ç³»ï¼ˆå†…éƒ¨ä¼šå¾ªç¯åŒ¹é…ï¼‰ï¼Œ  
> ä½†ä¸ºç®¡ç†æ–¹ä¾¿ï¼Œ**å»ºè®®æŒ‰é¡ºåºæˆ–æ ‡æ³¨å¯¹åº”å…³ç³»**ã€‚

---

## ğŸ“˜ äº”ã€å®é™…è¿è¡Œæ—¶çš„åŒ¹é…é€»è¾‘

Reality æœåŠ¡å™¨ç«¯å¯¹æ¡æ‰‹æ•°æ®ä¼šï¼š

1. ä»å®¢æˆ·ç«¯ SNI ä¸ ShortID ä¸­æå–æ¡æ‰‹ä¿¡æ¯ï¼›
    
2. å°è¯•åŒ¹é…é…ç½®æ–‡ä»¶ä¸­ä»»æ„ä¸€ä¸ª `shortId`ï¼›
    
3. è‹¥åŒ¹é…æˆåŠŸï¼Œå†è¿›å…¥ VLESS èº«ä»½éªŒè¯é˜¶æ®µï¼ˆUUID æ£€æŸ¥ï¼‰ã€‚
    

> âœ… **åŒ¹é…æ¡ä»¶æ˜¯â€œä»»ä¸€ shortId + æ­£ç¡® UUIDâ€å³å¯é€šè¿‡ã€‚**

æ‰€ä»¥ï¼š

- `shortIds` æ˜¯â€œè®¿é—®å¯†é’¥â€ï¼›
    
- `UUID` æ˜¯â€œç”¨æˆ·å‡­è¯â€ã€‚
    

---

## ğŸ” å…­ã€å®‰å…¨ä¸ç®¡ç†å»ºè®®

|åœºæ™¯|æ¨èåšæ³•|
|---|---|
|å°‘é‡è‡ªç”¨ç”¨æˆ·ï¼ˆ1â€“3äººï¼‰|å¯ä»¥å…±ç”¨ä¸€ä¸ª shortIdï¼Œç®€å•ç¨³å®š|
|å¤šç”¨æˆ·ã€å…¬å¼€åˆ†äº«|å¿…é¡»æ¯äººç‹¬ç«‹ shortIdï¼Œé¿å…å…¨ç½‘ fingerprint ä¸€è‡´|
|é«˜å®‰å…¨è¦æ±‚ï¼ˆé˜²æŒ‡çº¹æ‰«æï¼‰|ç»“åˆä¸åŒ fingerprintï¼Œå¦‚ `"chrome"`, `"firefox"`ï¼Œå†æ­é…ç‹¬ç«‹ shortId|

---

## ğŸ§© ä¸ƒã€è„šæœ¬è‡ªåŠ¨åŒ–ç”Ÿæˆ

å¯æ‰¹é‡ç”Ÿæˆ UUID + shortIdï¼š

```bash
#!/bin/bash
for i in {1..3}; do
  uuid=$(cat /proc/sys/kernel/random/uuid)
  shortid=$(openssl rand -hex 8)
  echo "User $i:"
  echo "UUID: $uuid"
  echo "ShortID: $shortid"
  echo
done
```

è¾“å‡ºï¼š

```
User 1:
UUID: 9e203d89-50f8-4e7a-a4f4-2c62b4e82b56
ShortID: 7e3b4a9e5f26ac2b
```

---

## âœ… å…«ã€æ€»ç»“è¡¨æ ¼

|åœºæ™¯|UUID|ShortID|æ˜¯å¦æ¨è|
|---|---|---|---|
|å•äººè‡ªç”¨|å”¯ä¸€|å…±ç”¨ä¸€ä¸ª|âœ”ï¸|
|ä¸¤ä¸‰å¥½å‹å…±äº«|å„è‡ªå”¯ä¸€|å…±ç”¨ä¸€ä¸ª|âœ”ï¸|
|å¤šç”¨æˆ·å¹³å° / å…¬å¼€èŠ‚ç‚¹|å„è‡ªå”¯ä¸€|å„è‡ªç‹¬ç«‹|âœ… å¼ºçƒˆæ¨è|
|æµ‹è¯•ç¯å¢ƒ|ä»»æ„|ä»»æ„|âœ”ï¸ å¯å¿½ç•¥å®‰å…¨æ€§|

---

### ğŸ“Œ ä¸€å¥è¯æ€»ç»“ï¼š

> `UUID` è¯†åˆ«ç”¨æˆ·èº«ä»½ï¼Œ  
> `shortId` åŒºåˆ†â€œæ‡‚æš—å·çš„äººâ€ï¼Œ  
> å¤šç”¨æˆ·å¯å…±ç”¨ï¼Œä½†è‹¥æƒ³æå‡ä¼ªè£…ä¸æŠ—æ‰«ææ€§ï¼Œå»ºè®®æ¯ç”¨æˆ·ä¸€ä¸ªç‹¬ç«‹ `shortId`ã€‚

---

æ˜¯å¦å¸Œæœ›æˆ‘å¸®ä½ ç”Ÿæˆä¸€ä¸ªå¯å¤ç”¨çš„ Bash è„šæœ¬ï¼Œ  
ä¸€æ¬¡ç”Ÿæˆå¤šç”¨æˆ·çš„ UUID + shortIdï¼Œå¹¶è‡ªåŠ¨å†™å…¥ Xray é…ç½®æ¨¡æ¿ï¼Ÿ  
é‚£æ ·ä½ æ¯æ¬¡åªè¦è¿è¡Œè„šæœ¬å³å¯æ›´æ–°å¤šç”¨æˆ· Reality èŠ‚ç‚¹ã€‚



---

# 4. å®¢æˆ·ç«¯é…ç½®ï¼ˆç¬¬ 8 ç« ï¼‰

## 4.1 æ“ä½œæ­¥éª¤

1. åœ¨å®¢æˆ·ç«¯ï¼ˆæ‰‹æœº/ç”µè„‘ï¼‰å®‰è£…æ”¯æŒ VLESS + Reality çš„å®¢æˆ·ç«¯ï¼ˆå¦‚ v2rayNã€V2RayNGã€NekoRayï¼‰ã€‚
    
2. å¯¼å…¥æˆ–æ‰‹åŠ¨é…ç½®ä¸€æ¡è¿æ¥ï¼Œç¤ºä¾‹ï¼š
    
    ```json
    {
      "outbounds": [
        {
          "protocol": "vless",
          "settings": {
            "vnext": [
              {
                "address": "example.com",
                "port": 443,
                "users": [
                  {
                    "id": "YOUR-UUID",
                    "flow": "xtls-rprx-vision"
                  }
                ]
              }
            ]
          },
          "streamSettings": {
            "network": "tcp",
            "security": "reality",
            "realitySettings": {
              "serverName": "example.com",
              "shortId": "0123456789abcdef",
              "publicKey": "YOUR-PUBLIC-KEY",
              "fingerprint": "chrome"
            }
          }
        }
      ]
    }
    ```
    
    **é‡ç‚¹ï¼æ˜“é”™**ï¼š
    
    - `publicKey` å¿…é¡»æ˜¯æœåŠ¡ç«¯ç”Ÿæˆçš„ Public keyã€‚
        
    - `serverName` ä¸æœåŠ¡ç«¯ `serverNames` ä¸­è‡³å°‘åŒ¹é…ä¸€ä¸ªã€‚
        
    - `shortId` ä¸æœåŠ¡ç«¯ `shortIds` ç›¸åŒã€‚
        
3. æµ‹è¯•è¿æ¥ï¼Œè‹¥è¿æ¥å¤±è´¥ï¼Œæ£€æŸ¥å®¢æˆ·ç«¯æ—¥å¿—ï¼Œæˆ–è€…æœåŠ¡ç«¯æ—¥å¿— `/var/log/xray/error.log`ã€‚
    

---

## ğŸ›¡ï¸ å®‰å…¨ä¼˜åŒ–ä¸é™„åŠ æ³¨æ„äº‹é¡¹

- å¯ç”¨é˜²ç«å¢™ `ufw` æˆ– `iptables`ï¼Œåªå¼€æ”¾å¿…è¦ç«¯å£ï¼ˆ80ã€443ï¼‰ã€‚
    
- ç¦æ­¢ root ç›´æ¥ä½¿ç”¨ xray æˆ– nginx ç”Ÿäº§ç¯å¢ƒã€‚ä½¿ç”¨ä¸“ç”¨ç”¨æˆ·ã€‚
    
- æ—¥å¿—è½®æ›¿é…ç½®ï¼ˆlogrotateï¼‰é˜²æ­¢æ—¥å¿—å æ»¡ç£ç›˜ã€‚
    
- å®šæœŸæ›´æ–° Xrayã€nginxã€ç³»ç»Ÿè½¯ä»¶ã€‚
    
- ä¸º nginx å¯ç”¨ HSTSã€å®‰å…¨å¤´ã€ç¦æ­¢ç›®å½•æµè§ˆã€‚
    
- å¯¹äºå›è½ç«™ç‚¹ï¼Œç¡®ä¿å†…å®¹çœ‹èµ·æ¥çœŸå®ã€å¯è®¿é—®ï¼Œä»¥å¢å¼ºä¼ªè£…æ•ˆæœã€‚
    
- å¤šç”¨æˆ·æ—¶ï¼Œå®šæœŸè½®æ¢ UUID æˆ–çŸ­ Idï¼Œç›‘æ§å¼‚å¸¸è®¿é—®ã€‚
    

---

## ğŸ“ é™„å½•ï¼šå¤šç”¨æˆ·é…ç½®é‡ç‚¹

- åœ¨æœåŠ¡ç«¯ `config.json` çš„ `clients` æ•°ç»„ä¸­ï¼Œå¤šåŠ ç”¨æˆ·ã€‚ç¤ºä¾‹ï¼š
    
    ```json
    "clients": [
      { "id": "UUID1", "flow":"xtls-rprx-vision", "level":0 },
      { "id": "UUID2", "flow":"xtls-rprx-vision", "level":0 }
    ]
    ```
    
- æ¯ä¸ªç”¨æˆ·å¯åˆ†äº« `serverName`, `publicKey`, `shortId`ï¼ˆå¦‚æœä½ é€‰æ‹©å¤š user å…±ç”¨ shortIdï¼‰æˆ–è€…ä½ å¯ä¸ºæ¯ç”¨æˆ·è®¾ç½®ä¸åŒ `shortId`ã€‚
    
- å®¢æˆ·ç«¯é…ç½®æ¯ç”¨æˆ·ä¸€æ¡ outboundã€‚ç¡®ä¿ `id`, `shortId`, `publicKey` ä¸€è‡´ã€‚
    
- è‹¥æƒ³åŒºåˆ†ç”¨æˆ·æµé‡ï¼Œå¯åœ¨ Xray çš„ `routing` ä¸­è®¾å®šæ ‡ç­¾ã€é™é€Ÿã€æ—¥å¿—åŒºåˆ†ã€‚
    

---

