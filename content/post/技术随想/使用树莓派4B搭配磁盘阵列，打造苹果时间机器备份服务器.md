
+++
date = '2025-08-15T16:03:46+02:00'
draft = false
title = 'ä½¿ç”¨æ ‘è“æ´¾4Bæ­é…ç£ç›˜é˜µåˆ—ï¼Œæ‰“é€ è‹¹æœæ—¶é—´æœºå™¨å¤‡ä»½æœåŠ¡å™¨'
+++

# ä¸€ã€Geminiç»™å‡ºæ–¹æ¡ˆï¼š

æœ¬æ–‡å°†è¯¦ç»†ä»‹ç»å¦‚ä½•åˆ©ç”¨æ ‘è“æ´¾4Bå’Œç£ç›˜é˜µåˆ—ï¼Œæ„å»ºä¸€ä¸ªç¨³å®šã€å¯é ä¸”ç»æµå®æƒ çš„è‹¹æœæ—¶é—´æœºå™¨ï¼ˆTime Machineï¼‰ç½‘ç»œå¤‡ä»½è§£å†³æ–¹æ¡ˆã€‚é€šè¿‡æœ¬æ•™ç¨‹ï¼Œæ‚¨å¯ä»¥å°†æ‚¨çš„Macæ•°æ®è‡ªåŠ¨å¤‡ä»½åˆ°ç”±å¤šå—ç¡¬ç›˜ç»„æˆçš„å†—ä½™å­˜å‚¨æ± ä¸­ï¼Œä»è€Œæœ‰æ•ˆä¿æŠ¤æ‚¨çš„æ•°æ®å®‰å…¨ã€‚

### æ ¸å¿ƒä¼˜åŠ¿

- **æ•°æ®å†—ä½™ä¸å®‰å…¨**: åˆ©ç”¨ç£ç›˜é˜µåˆ—ï¼ˆRAIDï¼‰ï¼Œå³ä½¿å…¶ä¸­ä¸€å—ç¡¬ç›˜æŸåï¼Œæ‚¨çš„å¤‡ä»½æ•°æ®ä¹Ÿèƒ½å®‰ç„¶æ— æ™ï¼ˆå–å†³äºæ‚¨é€‰æ‹©çš„RAIDçº§åˆ«ï¼‰ã€‚
    
- **ä½åŠŸè€—ä¸é™éŸ³**: æ ‘è“æ´¾4Bä»¥å…¶æä½çš„åŠŸè€—å’Œæ— é£æ‰‡è®¾è®¡ï¼Œå¯ä»¥7x24å°æ—¶ä¸é—´æ–­è¿è¡Œï¼Œä¸”ä¸ä¼šäº§ç”Ÿæ¼äººçš„å™ªéŸ³ã€‚
    
- **é«˜æ€§ä»·æ¯”**: ç›¸æ¯”äºå¸‚é¢ä¸Šçš„æˆå“NASï¼ˆç½‘ç»œé™„åŠ å­˜å‚¨ï¼‰ï¼Œæ­¤DIYæ–¹æ¡ˆæˆæœ¬æ›´ä½ï¼Œä¸”å…·æœ‰æ›´é«˜çš„çµæ´»æ€§å’Œå¯å®šåˆ¶æ€§ã€‚
    
- **è‡ªåŠ¨åŒ–å¤‡ä»½**: ä¸€æ—¦è®¾ç½®å®Œæˆï¼Œæ‚¨çš„Macå°†åœ¨æ¥å…¥åŒä¸€ç½‘ç»œæ—¶è‡ªåŠ¨è¿›è¡Œå¢é‡å¤‡ä»½ï¼Œæ— éœ€äººå·¥å¹²é¢„ã€‚
    

---

### å‡†å¤‡å·¥ä½œ

åœ¨å¼€å§‹ä¹‹å‰ï¼Œè¯·ç¡®ä¿æ‚¨å·²å‡†å¤‡å¥½ä»¥ä¸‹ç¡¬ä»¶å’Œè½¯ä»¶ï¼š

**ç¡¬ä»¶æ¸…å•:**

- **æ ‘è“æ´¾4B**: å»ºè®®é€‰æ‹©4GBæˆ–æ›´é«˜å†…å­˜çš„ç‰ˆæœ¬ï¼Œä»¥è·å¾—æ›´ä½³æ€§èƒ½ã€‚
    
- **ç£ç›˜é˜µåˆ—å¤–å£³**: é€‰æ‹©ä¸€ä¸ªæ”¯æŒå¤šå—ç¡¬ç›˜ï¼ˆè‡³å°‘2å—ï¼‰å¹¶å¸¦æœ‰ç‹¬ç«‹ç”µæºçš„USBç£ç›˜é˜µåˆ—ç›’ã€‚ç¡®ä¿å…¶ä¸æ ‘è“æ´¾4Bçš„USB 3.0æ¥å£å…¼å®¹ã€‚
    
- **ç¡¬ç›˜**: 2å—æˆ–ä»¥ä¸Šç›¸åŒå®¹é‡çš„æœºæ¢°ç¡¬ç›˜ï¼ˆHDDï¼‰æˆ–å›ºæ€ç¡¬ç›˜ï¼ˆSSDï¼‰ã€‚
    
- **MicroSDå¡**: è‡³å°‘16GBï¼Œç”¨äºå®‰è£…æ ‘è“æ´¾æ“ä½œç³»ç»Ÿã€‚
    
- **æ ‘è“æ´¾ç”µæº**: å®˜æ–¹æ¨èçš„5V/3A USB-Cç”µæºé€‚é…å™¨ã€‚
    
- **ä»¥å¤ªç½‘çº¿**: ç”¨äºå°†æ ‘è“æ´¾è¿æ¥åˆ°æ‚¨çš„è·¯ç”±å™¨ã€‚
    
- **ï¼ˆå¯é€‰ï¼‰æ ‘è“æ´¾å¤–å£³å’Œæ•£çƒ­ç‰‡**: ä¿æŠ¤æ ‘è“æ´¾å¹¶å¸®åŠ©å…¶æ•£çƒ­ã€‚
    

**è½¯ä»¶æ¸…å•:**

- **Raspberry Pi OS**: æ¨èå®‰è£…æœ€æ–°çš„64ä½æ¡Œé¢ç‰ˆæˆ–Liteç‰ˆã€‚
    
- **mdadm**: ç”¨äºåœ¨Linuxä¸Šåˆ›å»ºå’Œç®¡ç†è½¯ä»¶RAIDçš„å·¥å…·ã€‚
    
- **Samba**: ç”¨äºåˆ›å»ºç½‘ç»œå…±äº«ï¼Œä½¿Macå¯ä»¥è®¿é—®ã€‚
    
- **Avahi**: ç”¨äºæœåŠ¡å‘ç°ï¼Œè®©æ‚¨çš„Macèƒ½å¤Ÿè‡ªåŠ¨æ‰¾åˆ°æ—¶é—´æœºå™¨æœåŠ¡å™¨ã€‚
    

---

### æ“ä½œæ­¥éª¤

#### ç¬¬ä¸€æ­¥ï¼šå®‰è£…å’Œé…ç½®æ ‘è“æ´¾OS

1. **çƒ§å½•æ“ä½œç³»ç»Ÿ**: ä½¿ç”¨Raspberry Pi Imagerå·¥å…·å°†æœ€æ–°çš„Raspberry Pi OSçƒ§å½•åˆ°æ‚¨çš„MicroSDå¡ä¸­ã€‚åœ¨çƒ§å½•è¿‡ç¨‹ä¸­ï¼Œå»ºè®®æå‰è®¾ç½®å¥½SSHè®¿é—®å’ŒWi-Fiè¿æ¥ï¼ˆå¦‚æœä½¿ç”¨æ— çº¿ç½‘ç»œï¼‰ã€‚
    
2. **å¯åŠ¨æ ‘è“æ´¾**: å°†MicroSDå¡æ’å…¥æ ‘è“æ´¾ï¼Œè¿æ¥å¥½ç£ç›˜é˜µåˆ—ï¼ˆæš‚æ—¶ä¸è¦æ’å…¥ç¡¬ç›˜ï¼‰ã€ç½‘çº¿å’Œç”µæºï¼Œå¯åŠ¨æ ‘è“æ´¾ã€‚
    
3. **ç³»ç»Ÿæ›´æ–°**: é€šè¿‡SSHè¿æ¥åˆ°æ‚¨çš„æ ‘è“æ´¾ï¼Œæˆ–è€…ç›´æ¥è¿æ¥æ˜¾ç¤ºå™¨å’Œé”®ç›˜ï¼Œæ‰“å¼€ç»ˆç«¯å¹¶æ‰§è¡Œä»¥ä¸‹å‘½ä»¤æ›´æ–°ç³»ç»Ÿï¼š
    
    Bash
    
    ```
    sudo apt update
    sudo apt upgrade -y
    ```
    

#### ç¬¬äºŒæ­¥ï¼šè®¾ç½®ç£ç›˜é˜µåˆ—ï¼ˆRAIDï¼‰

1. **å®‰è£…mdadm**: åœ¨ç»ˆç«¯ä¸­è¾“å…¥ä»¥ä¸‹å‘½ä»¤å®‰è£…RAIDç®¡ç†å·¥å…·ï¼š
    
    Bash
    
    ```
    sudo apt install mdadm -y
    ```
    
2. **è¯†åˆ«ç¡¬ç›˜**: å°†å‡†å¤‡å¥½çš„ç¡¬ç›˜æ’å…¥ç£ç›˜é˜µåˆ—ç›’ï¼Œå¹¶è¿æ¥åˆ°æ ‘è“æ´¾çš„USB 3.0æ¥å£ã€‚ç„¶åä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹ç¡¬ç›˜è®¾å¤‡åç§°ï¼š
    
    Bash
    
    ```
    lsblk
    ```
    
    æ‚¨åº”è¯¥èƒ½çœ‹åˆ°ç±»ä¼¼ `/dev/sda`, `/dev/sdb` ç­‰è®¾å¤‡ã€‚è¯·åŠ¡å¿…ç¡®è®¤è¿™äº›æ˜¯æ‚¨æ–°æ’å…¥çš„ç¡¬ç›˜ã€‚
    
3. **åˆ›å»ºRAIDé˜µåˆ—**: æœ¬æ•™ç¨‹ä»¥åˆ›å»ºRAID 1ï¼ˆé•œåƒï¼‰ä¸ºä¾‹ï¼Œå®ƒæä¾›äº†æ•°æ®å†—ä½™ã€‚å¦‚æœæ‚¨æœ‰ä¸¤å—ç¡¬ç›˜ï¼ˆä¾‹å¦‚ `/dev/sda` å’Œ `/dev/sdb`ï¼‰ï¼Œè¯·æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š
    
    Bash
    
    ```
    sudo mdadm --create --verbose /dev/md0 --level=1 --raid-devices=2 /dev/sda /dev/sdb
    ```
    
    - `/dev/md0`: è¿™æ˜¯æ‚¨åˆ›å»ºçš„RAIDè®¾å¤‡çš„åç§°ã€‚
        
    - `--level=1`: æŒ‡å®šRAIDçº§åˆ«ä¸ºRAID 1ã€‚
        
    - `--raid-devices=2`: æŒ‡å®šç”¨äºåˆ›å»ºé˜µåˆ—çš„è®¾å¤‡æ•°é‡ã€‚
        
    - `/dev/sda /dev/sdb`: æ‚¨çš„ç¡¬ç›˜è®¾å¤‡åç§°ã€‚
        
    
    åˆ›å»ºè¿‡ç¨‹å¯èƒ½éœ€è¦ä¸€äº›æ—¶é—´ï¼Œå…·ä½“å–å†³äºæ‚¨çš„ç¡¬ç›˜å¤§å°ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹è¿›åº¦ï¼š
    
    Bash
    
    ```
    cat /proc/mdstat
    ```
    
4. **ä¿å­˜RAIDé…ç½®**: ä¸ºäº†è®©ç³»ç»Ÿåœ¨é‡å¯åèƒ½è‡ªåŠ¨è¯†åˆ«RAIDé˜µåˆ—ï¼Œéœ€è¦å°†é…ç½®ä¿å­˜åˆ°æ–‡ä»¶ä¸­ï¼š
    
    Bash
    
    ```
    sudo mdadm --detail --scan | sudo tee -a /etc/mdadm/mdadm.conf
    ```
    
5. **åˆ›å»ºæ–‡ä»¶ç³»ç»Ÿ**: åœ¨æ–°åˆ›å»ºçš„RAIDè®¾å¤‡ä¸Šåˆ›å»ºæ–‡ä»¶ç³»ç»Ÿã€‚æ¨èä½¿ç”¨`ext4`æ ¼å¼ï¼š
    
    Bash
    
    ```
    sudo mkfs.ext4 /dev/md0
    ```
    
6. **æŒ‚è½½RAIDé˜µåˆ—**: åˆ›å»ºä¸€ä¸ªæŒ‚è½½ç‚¹å¹¶æŒ‚è½½æ‚¨çš„RAIDè®¾å¤‡ï¼š
    
    Bash
    
    ```
    sudo mkdir -p /mnt/timemachine
    sudo mount /dev/md0 /mnt/timemachine
    ```
    
7. **è®¾ç½®è‡ªåŠ¨æŒ‚è½½**: ä¸ºäº†åœ¨ç³»ç»Ÿå¯åŠ¨æ—¶è‡ªåŠ¨æŒ‚è½½RAIDé˜µåˆ—ï¼Œéœ€è¦ç¼–è¾‘`/etc/fstab`æ–‡ä»¶ï¼š
    
    Bash
    
    ```
    sudo nano /etc/fstab
    ```
    
    åœ¨æ–‡ä»¶æœ«å°¾æ·»åŠ ä»¥ä¸‹è¡Œï¼š
    
    ```
    /dev/md0 /mnt/timemachine ext4 defaults,nofail 0 0
    ```
    
    ä¿å­˜å¹¶å…³é—­æ–‡ä»¶ã€‚
    

#### ç¬¬ä¸‰æ­¥ï¼šå®‰è£…å’Œé…ç½®Samba

1. **å®‰è£…Samba**:
    
    Bash
    
    ```
    sudo apt install samba -y
    ```
    
2. **åˆ›å»ºæ—¶é—´æœºå™¨ç”¨æˆ·**: åˆ›å»ºä¸€ä¸ªä¸“é—¨ç”¨äºæ—¶é—´æœºå™¨å¤‡ä»½çš„ç”¨æˆ·ï¼Œå¹¶è®¾ç½®å¯†ç ï¼š
    
    Bash
    
    ```
    sudo adduser tmuser
    ```
    
    ç„¶åå°†è¯¥ç”¨æˆ·æ·»åŠ åˆ°Sambaä¸­ï¼š
    
    Bash
    
    ```
    sudo smbpasswd -a tmuser
    ```
    
3. **é…ç½®Sambaå…±äº«**: ç¼–è¾‘Sambaçš„é…ç½®æ–‡ä»¶ï¼š
    
    Bash
    
    ```
    sudo nano /etc/samba/smb.conf
    ```
    
    åœ¨æ–‡ä»¶çš„æœ«å°¾æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š
    
    Ini, TOML
    
    ```
    [TimeMachine]
    comment = Time Machine Backup
    path = /mnt/timemachine
    valid users = tmuser
    read only = no
    vfs objects = catia fruit streams_xattr
    fruit:time machine = yes
    ```
    
    - **[TimeMachine]**: å…±äº«çš„åç§°ã€‚
        
    - **path**: æ‚¨ä¹‹å‰åˆ›å»ºçš„æŒ‚è½½ç‚¹ã€‚
        
    - **valid users**: å…è®¸è®¿é—®è¯¥å…±äº«çš„ç”¨æˆ·ã€‚
        
    - **vfs objects = catia fruit streams_xattr**: è¿™æ˜¯ä¸ºäº†æ›´å¥½åœ°å…¼å®¹macOSçš„å…³é”®é…ç½®ã€‚
        
    - **fruit:time machine = yes**: å°†æ­¤å…±äº«å£°æ˜ä¸ºæ—¶é—´æœºå™¨å…¼å®¹ã€‚
        
4. **é‡å¯SambaæœåŠ¡**:
    
    Bash
    
    ```
    sudo systemctl restart smbd
    ```
    

#### ç¬¬å››æ­¥ï¼šå®‰è£…å’Œé…ç½®Avahi

ä¸ºäº†è®©æ‚¨çš„Macèƒ½è‡ªåŠ¨åœ¨ç½‘ç»œä¸Šå‘ç°è¿™ä¸ªæ—¶é—´æœºå™¨æœåŠ¡å™¨ï¼Œæˆ‘ä»¬éœ€è¦å®‰è£…å¹¶é…ç½®Avahiã€‚

1. **å®‰è£…Avahi**:
    
    Bash
    
    ```
    sudo apt install avahi-daemon -y
    ```
    
2. **åˆ›å»ºAvahiæœåŠ¡æ–‡ä»¶**: åˆ›å»ºä¸€ä¸ªæ–°çš„æœåŠ¡æ–‡ä»¶æ¥å¹¿æ’­æ—¶é—´æœºå™¨æœåŠ¡ï¼š
    
    Bash
    
    ```
    sudo nano /etc/avahi/services/smb.service
    ```
    
    å°†ä»¥ä¸‹å†…å®¹ç²˜è´´åˆ°æ–‡ä»¶ä¸­ï¼š
    
    XML
    
    ```
    <?xml version="1.0" standalone='no'?>
    <!DOCTYPE service-group SYSTEM "avahi-service.dtd">
    <service-group>
        <name replace-wildcards="yes">%h</name>
        <service>
            <type>_smb._tcp</type>
            <port>445</port>
        </service>
        <service>
            <type>_device-info._tcp</type>
            <port>0</port>
            <txt-record>model=TimeCapsule</txt-record>
        </service>
    </service-group>
    ```
    
3. **é‡å¯AvahiæœåŠ¡**:
    
    Bash
    
    ```
    sudo systemctl restart avahi-daemon
    ```
    

---

### ç¬¬äº”æ­¥ï¼šåœ¨Macä¸Šè®¾ç½®æ—¶é—´æœºå™¨

1. **è¿æ¥åˆ°æœåŠ¡å™¨**: åœ¨æ‚¨çš„Macä¸Šï¼Œæ‰“å¼€â€œè®¿è¾¾â€ï¼ˆFinderï¼‰ï¼Œåœ¨èœå•æ ä¸­é€‰æ‹©â€œå‰å¾€â€ > â€œè¿æ¥æœåŠ¡å™¨â€ï¼ˆæˆ–ä½¿ç”¨å¿«æ·é”® `Command + K`ï¼‰ã€‚
    
2. **è¾“å…¥åœ°å€**: åœ¨æœåŠ¡å™¨åœ°å€æ ä¸­è¾“å…¥ `smb://<æ ‘è“æ´¾çš„IPåœ°å€>`ï¼Œç„¶åç‚¹å‡»â€œè¿æ¥â€ã€‚
    
3. **èº«ä»½éªŒè¯**: åœ¨å¼¹å‡ºçš„çª—å£ä¸­ï¼Œè¾“å…¥æ‚¨ä¹‹å‰åˆ›å»ºçš„`tmuser`çš„ç”¨æˆ·åå’Œå¯†ç ã€‚
    
4. **é…ç½®æ—¶é—´æœºå™¨**:
    
    - æ‰“å¼€â€œç³»ç»Ÿåå¥½è®¾ç½®â€ > â€œæ—¶é—´æœºå™¨â€ã€‚
        
    - ç‚¹å‡»â€œé€‰æ‹©ç£ç›˜...â€ã€‚
        
    - æ‚¨åº”è¯¥èƒ½çœ‹åˆ°æ‚¨åœ¨æ ‘è“æ´¾ä¸Šåˆ›å»ºçš„åä¸ºâ€œTimeMachineâ€çš„å…±äº«ç£ç›˜ã€‚
        
    - é€‰æ‹©è¯¥ç£ç›˜ï¼Œå¹¶å‹¾é€‰â€œåŠ å¯†å¤‡ä»½â€ï¼ˆå¼ºçƒˆæ¨èï¼‰ã€‚
        
    - ç‚¹å‡»â€œä½¿ç”¨ç£ç›˜â€ã€‚ç³»ç»Ÿä¼šå†æ¬¡è¦æ±‚æ‚¨è¾“å…¥`tmuser`çš„å‡­æ®ã€‚
        

è‡³æ­¤ï¼Œæ‚¨çš„Macå°±ä¼šå¼€å§‹ç¬¬ä¸€æ¬¡å¤‡ä»½ã€‚é¦–æ¬¡å¤‡ä»½å¯èƒ½éœ€è¦è¾ƒé•¿æ—¶é—´ï¼Œå…·ä½“å–å†³äºæ‚¨çš„æ•°æ®é‡ã€‚ä¹‹åçš„å¤‡ä»½å°†æ˜¯å¢é‡å¤‡ä»½ï¼Œé€Ÿåº¦ä¼šå¿«å¾ˆå¤šã€‚

### æ€»ç»“

é€šè¿‡ä»¥ä¸Šæ­¥éª¤ï¼Œæ‚¨å·²ç»æˆåŠŸåœ°å°†ä¸€å°æ ‘è“æ´¾4Bå’Œç£ç›˜é˜µåˆ—é…ç½®æˆäº†ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„è‹¹æœæ—¶é—´æœºå™¨æœåŠ¡å™¨ã€‚è¿™ä¸ä»…ä¸ºæ‚¨æä¾›äº†ä¸€ä¸ªå®‰å…¨å¯é çš„æ•°æ®å¤‡ä»½æ–¹æ¡ˆï¼Œä¹Ÿè®©æ‚¨ä½“éªŒåˆ°äº†DIYçš„ä¹è¶£å’Œçµæ´»æ€§ã€‚ç°åœ¨ï¼Œæ‚¨å¯ä»¥é«˜æ•æ— å¿§ï¼Œè®©è¿™å°é»˜é»˜æ— é—»çš„å°ç”µè„‘å®ˆæŠ¤æ‚¨çš„çè´µæ•°æ®ã€‚

---

# äºŒã€Chatgptç»™å‡ºæ–¹æ¡ˆï¼š

ä½ æƒ³ç”¨ **æ ‘è“æ´¾ 4B + ç£ç›˜é˜µåˆ—** æ¥æ­å»º **Apple Time Machine** å¤‡ä»½æœåŠ¡å™¨ï¼Œè¿™æ˜¯å®Œå…¨å¯è¡Œçš„ï¼Œæˆ‘å¯ä»¥ç»™ä½ ä¸€ä¸ªå®Œæ•´çš„æ–¹æ¡ˆï¼ŒåŒ…æ‹¬ç¡¬ä»¶å»ºè®®ã€ç³»ç»Ÿé€‰æ‹©ã€è½¯ä»¶é…ç½®å’Œæ³¨æ„äº‹é¡¹ã€‚æˆ‘ä»¬ä¸€æ­¥æ­¥æ¥ã€‚

---

## 1ï¸âƒ£ ç¡¬ä»¶å‡†å¤‡

- **æ ‘è“æ´¾ 4B**ï¼šå»ºè®® 4GB æˆ– 8GB å†…å­˜ç‰ˆæœ¬ï¼Œç½‘ç»œæ›´ç¨³å®šçš„è¯ç”¨æœ‰çº¿åƒå…†ç½‘å£ã€‚
    
- **å¤–æ¥ç£ç›˜é˜µåˆ—**ï¼š
    
    - å¯ä»¥ç”¨ USB 3.0 ç¡¬ç›˜ç›’æˆ– NAS RAID ç£ç›˜é˜µåˆ—ï¼ˆRAID 1 / RAID 5 æ¨èç”¨äºå†—ä½™ï¼‰ã€‚
        
    - æ ¼å¼åŒ–æˆ `ext4` æˆ– `btrfs`ï¼ˆbtrfs æ”¯æŒå¿«ç…§æ›´å®‰å…¨ï¼‰ã€‚
        
- **ç”µæºå’Œæ•£çƒ­**ï¼šæ ‘è“æ´¾é•¿æœŸè¿è¡Œå»ºè®®ç”¨ç¨³å®š 5V/3A ç”µæºï¼Œæœ€å¥½é…é£æ‰‡æˆ–æ•£çƒ­ç‰‡ã€‚
    

---

## 2ï¸âƒ£ ç³»ç»Ÿé€‰æ‹©

- **æ¨èç³»ç»Ÿ**ï¼š
    
    - Raspberry Pi OS Liteï¼ˆDebian ç³»ç»Ÿï¼Œè½»é‡ä¸”ç¨³å®šï¼‰
        
    - Ubuntu Server for Raspberry Piï¼ˆå¦‚æœä½ ç†Ÿæ‚‰ Ubuntu ç”Ÿæ€ï¼‰
        

> ä¸å»ºè®®ç”¨æ¡Œé¢ç‰ˆï¼Œå› ä¸ºæœåŠ¡å™¨é•¿æœŸè¿è¡Œæ—¶å ç”¨èµ„æºå¤šã€‚

---

## 3ï¸âƒ£ æ–‡ä»¶ç³»ç»Ÿä¸æŒ‚è½½

1. æ’å…¥ç¡¬ç›˜é˜µåˆ—ï¼Œç¡®è®¤ç³»ç»Ÿè¯†åˆ«ï¼š
    

```bash
lsblk
```

2. åˆ›å»ºåˆ†åŒºå¹¶æ ¼å¼åŒ–ï¼š
    

```bash
sudo mkfs.ext4 /dev/sda1   # æ ¹æ®å®é™…ç¡¬ç›˜è®¾å¤‡ä¿®æ”¹
```

3. åˆ›å»ºæŒ‚è½½ç‚¹ï¼š
    

```bash
sudo mkdir -p /mnt/timemachine
```

4. ä¿®æ”¹ `/etc/fstab` è‡ªåŠ¨æŒ‚è½½ï¼š
    

```bash
UUID=xxxx-xxxx  /mnt/timemachine  ext4  defaults,nofail  0  2
```

ç”¨ `blkid` æŸ¥çœ‹ç¡¬ç›˜ UUIDã€‚

---

## 4ï¸âƒ£ å®‰è£… Time Machine æœåŠ¡å™¨è½¯ä»¶

Time Machine å¯ä»¥ä½¿ç”¨ **Samba (SMB) åè®®** å…±äº«ï¼Œå› ä¸º macOS 10.12 ä»¥åé»˜è®¤é€šè¿‡ SMB å¤‡ä»½ã€‚

### å®‰è£… Samba

```bash
sudo apt update
sudo apt install samba
```

### é…ç½® Samba

ç¼–è¾‘ `/etc/samba/smb.conf`ï¼Œåœ¨æœ«å°¾æ·»åŠ ï¼š

```ini
[TimeMachine]
   path = /mnt/timemachine
   browseable = yes
   read only = no
   guest ok = no
   valid users = pi
   vfs objects = catia fruit streams_xattr
   fruit:time machine = yes
```

- `valid users`ï¼šæŒ‡å®šå¯å¤‡ä»½ç”¨æˆ·ï¼Œå»ºè®®å•ç‹¬åˆ›å»ºå¤‡ä»½ç”¨æˆ·ã€‚
    
- `fruit:time machine = yes`ï¼šå¯ç”¨ Time Machine åŠŸèƒ½ã€‚
    

### è®¾ç½® Samba ç”¨æˆ·

```bash
sudo smbpasswd -a pi
sudo systemctl restart smbd
```

---

## 5ï¸âƒ£ macOS é…ç½® Time Machine

1. åœ¨ Mac ä¸Šæ‰“å¼€ **ç³»ç»Ÿè®¾ç½® â†’ æ—¶é—´æœºå™¨ â†’ é€‰æ‹©ç£ç›˜**
    
2. é€‰æ‹©ç½‘ç»œä¸Šçš„ `TimeMachine` å…±äº«
    
3. è¾“å…¥ä½ åœ¨ Samba ä¸­è®¾ç½®çš„ç”¨æˆ·åå’Œå¯†ç 
    
4. å¼€å§‹å¤‡ä»½
    

> macOS ä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ª `.sparsebundle` æ–‡ä»¶åœ¨ä½ çš„å…±äº«ç£ç›˜é‡Œï¼Œè¿™å°±æ˜¯ Time Machine çš„å¤‡ä»½æ–‡ä»¶ã€‚

---

## 6ï¸âƒ£ é«˜çº§ä¼˜åŒ–

- **RAID / btrfs** æé«˜æ•°æ®å®‰å…¨æ€§
    
- **å®šæœŸå¿«ç…§**ï¼ˆbtrfs æˆ– LVMï¼‰
    
- **ç½‘ç»œä¼˜åŒ–**ï¼šæ ‘è“æ´¾å»ºè®®ç”¨æœ‰çº¿åƒå…†ï¼Œé¿å…æ— çº¿é€Ÿåº¦æ…¢
    
- **è‡ªåŠ¨æŒ‚è½½å’Œå¼€æœºè‡ªå¯ Samba**ï¼š
    

```bash
sudo systemctl enable smbd
```

---

å¦‚æœä½ éœ€è¦ï¼Œæˆ‘å¯ä»¥å¸®ä½  **å†™ä¸€ä¸ªå®Œæ•´çš„ä¸€é”®éƒ¨ç½²è„šæœ¬**ï¼Œæ ‘è“æ´¾æ’ä¸Šç£ç›˜å°±èƒ½ç›´æ¥å˜æˆ Time Machine æœåŠ¡å™¨ï¼ŒåŒ…æ‹¬ Samba é…ç½®ã€ç”¨æˆ·åˆ›å»ºå’Œè‡ªåŠ¨æŒ‚è½½ã€‚

ä½ å¸Œæœ›æˆ‘å¸®ä½ åšè¿™ä¸ªè„šæœ¬å—ï¼Ÿ

---

# ä¸‰ã€ç»§ç»­ä¼˜åŒ–ï¼Œå»æ‰AvahiæœåŠ¡ï¼ŒåŠ å¼ºå®‰å…¨

## é¦–å…ˆæ˜¯gptï¼š

å®Œå…¨å¯ä»¥**ä¸åŠ  Avahi æœåŠ¡**ã€‚Avahi ä¸»è¦ä½œç”¨æ˜¯è®© macOS è‡ªåŠ¨åœ¨å±€åŸŸç½‘å‘ç° Time Machine æœåŠ¡å™¨ï¼Œå¦‚æœä½ ä¸åœ¨æ„æ‰‹åŠ¨è¾“å…¥ IP åœ°å€æˆ–æœåŠ¡å™¨åç§°ï¼Œå®Œå…¨å¯ä»¥çœç•¥å®ƒã€‚è¿™æ ·åšåè€Œå¯¹å®‰å…¨æœ‰åˆ©ï¼Œå› ä¸ºå°‘äº†ä¸€ä¸ªå±€åŸŸç½‘å¹¿æ’­æœåŠ¡ï¼Œå‡å°‘äº†æ½œåœ¨æ”»å‡»é¢ã€‚

ä¸‹é¢æˆ‘å¸®ä½ åœ¨**ä¸ä½¿ç”¨ Avahi**çš„å‰æä¸‹ä¼˜åŒ–æ–¹æ¡ˆï¼Œå¹¶å¼ºåŒ–å®‰å…¨é…ç½®ï¼š

---

# æ ‘è“æ´¾ + ç£ç›˜é˜µåˆ— Time Machineï¼ˆä¸ä½¿ç”¨ Avahiï¼Œå¢å¼ºå®‰å…¨ï¼‰

### æ ¸å¿ƒæ€æƒ³

- **å®‰å…¨è®¿é—®**ï¼šåªå…è®¸æŒ‡å®šç”¨æˆ·è®¿é—®å…±äº«ï¼Œç¦æ­¢ guest å’ŒåŒ¿åè®¿é—®
    
- **åŠ å¯†ä¼ è¾“**ï¼šSamba ä»…ä½¿ç”¨ SMB 3 åè®®ï¼ˆæ”¯æŒåŠ å¯†ï¼‰
    
- **é˜²æ­¢æœªæˆæƒè®¿é—®**ï¼šå…³é—­ SMBv1ï¼Œé™åˆ¶é˜²ç«å¢™è§„åˆ™
    

---

## 1ï¸âƒ£ ç›®å½•å’Œæƒé™

å‡è®¾ RAID æŒ‚è½½åœ¨ `/data/smb`ï¼š

```bash
sudo mkdir -p /data/smb
sudo adduser tmuser            # åˆ›å»ºå¤‡ä»½ç”¨æˆ·
sudo chown -R tmuser:tmuser /data/smb
sudo chmod 770 /data/smb       # ä»…å…è®¸ç”¨æˆ·è¯»å†™
```

> å¦‚æœéœ€è¦å¤šç”¨æˆ·ï¼Œå¯ä»¥åˆ›å»ºç”¨æˆ·ç»„ `tmbak`ï¼Œç„¶åå°†æ‰€æœ‰å¤‡ä»½ç”¨æˆ·åŠ å…¥è¯¥ç»„ã€‚

---

## 2ï¸âƒ£ Samba é…ç½®ï¼ˆå®‰å…¨ä¼˜åŒ–ç‰ˆï¼‰

ç¼–è¾‘ `/etc/samba/smb.conf`ï¼š

```ini
[global]
   server string = Time Machine Server
   workgroup = WORKGROUP
   map to guest = never          # ç¦æ­¢ guest è®¿é—®
   smb encrypt = required        # å¼ºåˆ¶ SMB 3 åŠ å¯†
   min protocol = SMB2           # ç¦æ­¢ SMB1
   max protocol = SMB3
   log file = /var/log/samba/%m.log
   log level = 2
   disable netbios = yes         # ä¸å¯ç”¨ NetBIOSï¼Œå‡å°‘å¹¿æ’­

[TimeMachine]
   comment = Time Machine Backup
   path = /data/smb
   valid users = tmuser
   read only = no
   vfs objects = catia fruit streams_xattr
   fruit:time machine = yes
   fruit:time machine max size = 2T  # å¯é™åˆ¶å¤‡ä»½å®¹é‡
```

- `smb encrypt = required`ï¼šå¼ºåˆ¶ SMB 3 åŠ å¯†ä¼ è¾“ï¼Œé˜²æ­¢æ•°æ®åœ¨å±€åŸŸç½‘è¢«å—…æ¢
    
- `disable netbios = yes`ï¼šå…³é—­ NetBIOS å¹¿æ’­ï¼Œå‡å°‘è¢«æ‰«æé£é™©
    
- `fruit:time machine max size`ï¼šå¯ä»¥é™åˆ¶ Time Machine å ç”¨ç©ºé—´ï¼Œé˜²æ­¢ç£ç›˜è¢«æ„å¤–å¡«æ»¡
    

é‡å¯ Sambaï¼š

```bash
sudo systemctl restart smbd
sudo systemctl enable smbd
```

---

## 3ï¸âƒ£ é˜²ç«å¢™å»ºè®®

å¦‚æœæ ‘è“æ´¾æ¥å…¥å±€åŸŸç½‘ï¼Œå¯ä»¥åªå¼€æ”¾ SMB ç«¯å£ç»™å¯ä¿¡è®¾å¤‡ï¼š

```bash
sudo apt install ufw -y
sudo ufw default deny incoming
sudo ufw default allow outgoing
sudo ufw allow from 192.168.1.0/24 to any port 445 proto tcp
sudo ufw enable
```

> æ›¿æ¢ `192.168.1.0/24` ä¸ºä½ çš„å±€åŸŸç½‘ç½‘æ®µï¼Œåªå…è®¸å±€åŸŸç½‘è®¿é—® SMB æœåŠ¡ã€‚

---

## 4ï¸âƒ£ Time Machine é…ç½®ï¼ˆMacç«¯ï¼‰

1. åœ¨ Finder â†’ å‰å¾€ â†’ è¿æ¥æœåŠ¡å™¨ï¼ˆCommand+Kï¼‰
    
2. è¾“å…¥ `smb://<æ ‘è“æ´¾IP>/TimeMachine`
    
3. è¾“å…¥ `tmuser` ç”¨æˆ·åå’Œå¯†ç 
    
4. åœ¨ç³»ç»Ÿåå¥½è®¾ç½® â†’ æ—¶é—´æœºå™¨ä¸­é€‰æ‹©æ­¤ç£ç›˜ï¼Œå‹¾é€‰â€œåŠ å¯†å¤‡ä»½â€
    

> ä¸ä½¿ç”¨ Avahi åéœ€è¦æ‰‹åŠ¨è¾“å…¥ IP æˆ–ä¸»æœºåã€‚

---

### âœ… å®‰å…¨ä¼˜åŒ–æ€»ç»“

- ç¦ç”¨ guest / åŒ¿åè®¿é—®
    
- ç¦ç”¨ SMB1 / å¼ºåˆ¶ SMB3 åŠ å¯†
    
- å…³é—­ NetBIOS å¹¿æ’­
    
- é˜²ç«å¢™ä»…å…è®¸å±€åŸŸç½‘è®¿é—®
    
- å¯é™åˆ¶ Time Machine å®¹é‡
    
- æŒ‚è½½ç‚¹æƒé™ä¸¥æ ¼æ§åˆ¶
    

---

å¦‚æœä½ æ„¿æ„ï¼Œæˆ‘å¯ä»¥å¸®ä½ å†™ä¸€ä¸ª**ä¸€é”®éƒ¨ç½²è„šæœ¬**ï¼šåˆ›å»º RAIDã€æŒ‚è½½ã€é…ç½® Sambaï¼ˆå®‰å…¨å¼ºåŒ–ï¼‰ã€åˆ›å»ºç”¨æˆ·ã€è‡ªåŠ¨æŒ‚è½½ï¼Œä¸€æ¡å‘½ä»¤æå®šã€‚

ä½ å¸Œæœ›æˆ‘å†™è¿™ä¸ªè„šæœ¬å—ï¼Ÿ

## ç„¶åæ˜¯Gemini:

å½“ç„¶å¯ä»¥ã€‚å»æ‰AvahiæœåŠ¡æ˜¯å®Œå…¨å¯è¡Œçš„ï¼Œå¹¶ä¸”ä»æŸç§ç¨‹åº¦ä¸Šè¯´ï¼Œè¿™å‡å°‘äº†ä¸€ä¸ªä¸å¿…è¦çš„æœåŠ¡ï¼Œç•¥å¾®æå‡äº†ç³»ç»Ÿçš„ç®€æ´æ€§å’Œå®‰å…¨æ€§ã€‚

ä¸‹é¢æˆ‘å°†åˆ†ä¸¤éƒ¨åˆ†æ¥å›ç­”æ‚¨çš„é—®é¢˜ï¼šé¦–å…ˆè¯´æ˜**ä¸ä½¿ç”¨Avahiçš„åæœå’Œæ‰‹åŠ¨è¿æ¥æ–¹æ³•**ï¼Œç„¶åæä¾›ä¸€ç³»åˆ—**ä¼˜åŒ–å’ŒåŠ å¼ºå®‰å…¨æ€§çš„é…ç½®**ã€‚

---

### ä¸€ã€ä¸åŠ AvahiæœåŠ¡çš„æ›¿ä»£æ–¹æ¡ˆ

AvahiæœåŠ¡çš„ä½œç”¨æ˜¯**æœåŠ¡å‘ç°**ï¼Œå®ƒä½¿ç”¨mDNSï¼ˆå¤šæ’­DNSï¼‰åè®®ï¼Œä¹Ÿå°±æ˜¯è‹¹æœçš„BonjouræŠ€æœ¯ã€‚å®ƒçš„å”¯ä¸€åŠŸèƒ½å°±æ˜¯è®©æ‚¨çš„æ ‘è“æ´¾èƒ½å¤Ÿè¢«Macè‡ªåŠ¨å‘ç°ï¼Œä»è€Œåœ¨â€œæ—¶é—´æœºå™¨â€çš„ç£ç›˜é€‰æ‹©åˆ—è¡¨ä¸­è‡ªåŠ¨å‡ºç°ï¼Œæä¾›ä¾¿åˆ©æ€§ã€‚

**å»æ‰Avahiåï¼š**

- æ‚¨çš„Macå°†**æ— æ³•è‡ªåŠ¨å‘ç°**è¿™ä¸ªç½‘ç»œå¤‡ä»½ç£ç›˜ã€‚
    
- æ‚¨éœ€è¦**æ‰‹åŠ¨è¿æ¥ä¸€æ¬¡**æœåŠ¡å™¨ï¼Œä¹‹åmacOSé€šå¸¸ä¼šè®°ä½è¿™ä¸ªè®¾ç½®ã€‚
    

#### æ‰‹åŠ¨è¿æ¥æ–¹æ³•ï¼š

1. è·å–æ ‘è“æ´¾çš„IPåœ°å€ï¼š
    
    åœ¨æ ‘è“æ´¾ä¸Šæ‰§è¡Œ ip a æˆ– hostname -I å‘½ä»¤æ¥è·å–å…¶IPåœ°å€ï¼ˆä¾‹å¦‚ 192.168.1.10ï¼‰ã€‚å»ºè®®æ‚¨åœ¨è·¯ç”±å™¨ä¸Šä¸ºæ ‘è“æ´¾è®¾ç½®ä¸€ä¸ªé™æ€IPåœ°å€ï¼Œä»¥é˜²åœ°å€å˜åŒ–å¯¼è‡´è¿æ¥å¤±è´¥ã€‚
    
2. **åœ¨Macä¸Šè¿æ¥æœåŠ¡å™¨**ï¼š
    
    - æ‰“å¼€â€œè®¿è¾¾â€ï¼ˆFinderï¼‰ã€‚
        
    - åœ¨å±å¹•é¡¶éƒ¨çš„èœå•æ ä¸­ï¼Œé€‰æ‹©â€œå‰å¾€â€ > â€œè¿æ¥æœåŠ¡å™¨...â€ï¼ˆå¿«æ·é”® `Command + K`ï¼‰ã€‚
        
    - åœ¨å¼¹å‡ºçš„å¯¹è¯æ¡†ä¸­ï¼Œè¾“å…¥æœåŠ¡å™¨åœ°å€ï¼Œæ ¼å¼ä¸º `smb://<ä½ çš„æ ‘è“æ´¾IPåœ°å€>`ï¼Œä¾‹å¦‚ï¼š
        
        ```
        smb://192.168.1.10
        ```
        
    - ç‚¹å‡»â€œè¿æ¥â€ã€‚ç³»ç»Ÿä¼šæç¤ºæ‚¨è¾“å…¥å‡­æ®ï¼Œè¯·è¾“å…¥ä¹‹å‰ä¸ºæ—¶é—´æœºå™¨åˆ›å»ºçš„ä¸“ç”¨ç”¨æˆ·åï¼ˆä¾‹å¦‚ `tmuser`ï¼‰å’Œå¯†ç ã€‚
        
3. **åœ¨æ—¶é—´æœºå™¨ä¸­è®¾ç½®**ï¼š
    
    - å®Œæˆæ‰‹åŠ¨è¿æ¥åï¼Œè¿™ä¸ªç½‘ç»œå…±äº«ç£ç›˜å°±å·²ç»æŒ‚è½½åˆ°äº†æ‚¨çš„Macä¸Šã€‚
        
    - ç°åœ¨æ‰“å¼€â€œç³»ç»Ÿè®¾ç½®â€ > â€œé€šç”¨â€ > â€œæ—¶é—´æœºå™¨â€ã€‚
        
    - ç‚¹å‡»â€œæ·»åŠ å¤‡ä»½ç£ç›˜...â€ã€‚
        
    - æ­¤æ—¶ï¼Œæ‚¨æ‰‹åŠ¨æŒ‚è½½çš„é‚£ä¸ªåä¸ºâ€œTimeMachineâ€çš„ç£ç›˜åº”è¯¥ä¼šå‡ºç°åœ¨åˆ—è¡¨ä¸­ã€‚é€‰æ‹©å®ƒï¼Œç„¶åæŒ‰ç…§æç¤ºå®Œæˆè®¾ç½®å³å¯ã€‚
        

---

### äºŒã€ä¼˜åŒ–ä¸åŠ å¼ºå®‰å…¨é…ç½®

ä»¥ä¸‹æ˜¯ä¸€äº›å…³é”®çš„å®‰å…¨åŠ å›ºæªæ–½ï¼Œå¯ä»¥è®©æ‚¨çš„æ ‘è“æ´¾å¤‡ä»½æœåŠ¡å™¨æ›´åŠ å®‰å…¨å¯é ã€‚

#### 1. å¯ç”¨é˜²ç«å¢™ (UFW)

é»˜è®¤æƒ…å†µä¸‹ï¼Œæ ‘è“æ´¾OSæ²¡æœ‰å¯ç”¨é˜²ç«å¢™ã€‚æˆ‘ä»¬åº”è¯¥åªå¼€æ”¾å¿…è¦çš„ç«¯å£ã€‚

1. **å®‰è£…UFW (Uncomplicated Firewall)**ï¼š
    
    Bash
    
    ```
    sudo apt update
    sudo apt install ufw -y
    ```
    
2. è®¾ç½®è§„åˆ™ï¼š
    
    æˆ‘ä»¬éœ€è¦å…è®¸SSHï¼ˆç”¨äºç®¡ç†ï¼‰å’ŒSambaï¼ˆç”¨äºæ–‡ä»¶å…±äº«ï¼‰çš„è¿æ¥ã€‚
    
    Bash
    
    ```
    # æ‹’ç»æ‰€æœ‰ä¼ å…¥è¿æ¥
    sudo ufw default deny incoming
    
    # å…è®¸æ‰€æœ‰ä¼ å‡ºè¿æ¥
    sudo ufw default allow outgoing
    
    # å…è®¸SSHè¿æ¥ï¼ˆé‡è¦ï¼å¦åˆ™æ‚¨å°†æ— æ³•å†æ¬¡ç™»å½•ï¼‰
    sudo ufw allow ssh  # æˆ–è€… sudo ufw allow 22/tcp
    
    # å…è®¸Sambaè¿æ¥
    sudo ufw allow samba # æˆ–è€… sudo ufw allow 139/tcp && sudo ufw allow 445/tcp
    ```
    
3. **å¯ç”¨é˜²ç«å¢™**ï¼š
    
    Bash
    
    ```
    sudo ufw enable
    ```
    
    ç³»ç»Ÿä¼šè­¦å‘Šæ‚¨è¿™å¯èƒ½ä¼šä¸­æ–­ç°æœ‰è¿æ¥ï¼Œè¾“å…¥ `y` ç¡®è®¤ã€‚
    
4. **æŸ¥çœ‹çŠ¶æ€**ï¼š
    
    Bash
    
    ```
    sudo ufw status verbose
    ```
    

#### 2. å¼ºåŒ–Sambaå®‰å…¨é…ç½®

ç¼–è¾‘Sambaé…ç½®æ–‡ä»¶ `sudo nano /etc/samba/smb.conf`ï¼Œåœ¨ `[global]` éƒ¨åˆ†è¿›è¡Œä¿®æ”¹æˆ–æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š

1. é™åˆ¶è®¿é—®IPï¼š
    
    åªå…è®¸æ‚¨å±€åŸŸç½‘å†…çš„è®¾å¤‡è®¿é—®ã€‚å‡è®¾æ‚¨çš„å±€åŸŸç½‘æ˜¯ 192.168.1.xï¼Œåˆ™å¯ä»¥æ·»åŠ ï¼š
    
    Ini, TOML
    
    ```
    # åœ¨ [global] éƒ¨åˆ†æ·»åŠ 
    hosts allow = 192.168.1. 127.
    hosts deny = 0.0.0.0/0
    ```
    
    - `192.168.1.` è¡¨ç¤ºå…è®¸ `192.168.1.0` åˆ° `192.168.1.255` çš„æ‰€æœ‰è®¾å¤‡ã€‚è¯·æ ¹æ®æ‚¨çš„å®é™…ç½‘ç»œæƒ…å†µä¿®æ”¹ã€‚
        
    - `127.` æ˜¯å…è®¸æœ¬åœ°å›ç¯åœ°å€è®¿é—®ã€‚
        
    - `hosts deny` æ‹’ç»æ‰€æœ‰å…¶ä»–åœ°å€ã€‚
        
2. ç»‘å®šç½‘ç»œæ¥å£ï¼š
    
    å¦‚æœæ‚¨çš„æ ‘è“æ´¾åŒæ—¶è¿æ¥äº†æœ‰çº¿å’Œæ— çº¿ç½‘ç»œï¼Œä½†æ‚¨åªå¸Œæœ›é€šè¿‡æœ‰çº¿ç½‘ç»œæä¾›æœåŠ¡ï¼Œå¯ä»¥æŒ‡å®šSambaç›‘å¬çš„ç½‘å¡ã€‚
    
    é¦–å…ˆç”¨ ip a æŸ¥çœ‹æ‚¨çš„æœ‰çº¿ç½‘å¡åç§°ï¼ˆé€šå¸¸æ˜¯ eth0ï¼‰ã€‚
    
    Ini, TOML
    
    ```
    # åœ¨ [global] éƒ¨åˆ†æ·»åŠ 
    interfaces = lo eth0
    bind interfaces only = yes
    ```
    
    - `lo` æ˜¯æœ¬åœ°å›ç¯æ¥å£ï¼Œ`eth0` æ˜¯æ‚¨çš„æœ‰çº¿ç½‘å¡ã€‚
        

#### 3. æå‡SSHè®¿é—®å®‰å…¨

SSHæ˜¯æ‚¨ç®¡ç†æ ‘è“æ´¾çš„å…¥å£ï¼Œå¿…é¡»é‡ç‚¹ä¿æŠ¤ã€‚

1. ç¦ç”¨å¯†ç ç™»å½•ï¼Œå¼ºåˆ¶ä½¿ç”¨SSHå¯†é’¥ï¼š
    
    è¿™æ˜¯æœ€æœ‰æ•ˆçš„å®‰å…¨æªæ–½ä¹‹ä¸€ã€‚å®ƒèƒ½å®Œå…¨å…ç–«å¯†ç æš´åŠ›ç ´è§£æ”»å‡»ã€‚
    
    - åœ¨æ‚¨çš„Macä¸Šç”Ÿæˆå¯†é’¥å¯¹ï¼ˆå¦‚æœè¿˜æ²¡æœ‰çš„è¯ï¼‰ï¼š
        
        æ‰“å¼€Macçš„â€œç»ˆç«¯â€ï¼Œè¾“å…¥ ssh-keygen -t ed25519ï¼Œç„¶åä¸€è·¯å›è½¦ã€‚
        
    - å°†å…¬é’¥å¤åˆ¶åˆ°æ ‘è“æ´¾ï¼š
        
        ssh-copy-id pi@<ä½ çš„æ ‘è“æ´¾IPåœ°å€>
        
        ï¼ˆå‡è®¾æ‚¨æ ‘è“æ´¾çš„é»˜è®¤ç”¨æˆ·æ˜¯ piï¼‰ã€‚
        
    - åœ¨æ ‘è“æ´¾ä¸Šä¿®æ”¹SSHé…ç½®ï¼š
        
        sudo nano /etc/ssh/sshd_config
        
        æ‰¾åˆ°å¹¶ä¿®æ”¹ä»¥ä¸‹è¡Œä¸ºï¼š
        
        Ini, TOML
        
        ```
        PermitRootLogin no          # ç¦æ­¢rootç”¨æˆ·ç™»å½•
        PasswordAuthentication no   # ç¦æ­¢ä½¿ç”¨å¯†ç ç™»å½•
        ```
        
    - é‡å¯SSHæœåŠ¡ï¼š
        
        sudo systemctl restart ssh
        
        é‡è¦ï¼šåœ¨æ‰§è¡Œæ­¤æ“ä½œå¹¶æ–­å¼€å½“å‰è¿æ¥å‰ï¼Œè¯·åŠ¡å¿…æ–°å¼€ä¸€ä¸ªç»ˆç«¯çª—å£ï¼Œå°è¯•ç”¨SSHå¯†é’¥ç™»å½•ï¼Œç¡®ä¿æˆåŠŸåå†å…³é—­æ—§çš„è¿æ¥ã€‚
        
2. ï¼ˆå¯é€‰ï¼‰æ›´æ”¹SSHé»˜è®¤ç«¯å£ï¼š
    
    å°†ç«¯å£ä»22æ”¹ä¸ºä¸€ä¸ªä¸å¸¸ç”¨çš„ç«¯å£ï¼ˆä¾‹å¦‚2222ï¼‰ï¼Œå¯ä»¥æœ‰æ•ˆå‡å°‘è¢«ç½‘ç»œæ‰«æå™¨è‡ªåŠ¨æ”»å‡»çš„æ¬¡æ•°ã€‚
    
    - ä¿®æ”¹ sshd_config æ–‡ä»¶ï¼š
        
        Port 2222
        
    - åœ¨UFWä¸­å…è®¸æ–°ç«¯å£ï¼š`sudo ufw allow 2222/tcp`
        
    - é‡å¯SSHæœåŠ¡ã€‚
        
    - ä¹‹åç™»å½•éœ€è¦ä½¿ç”¨ï¼š`ssh -p 2222 pi@<ä½ çš„æ ‘è“æ´¾IPåœ°å€>`
        

#### 4. ä¿æŒç³»ç»Ÿæ›´æ–°ä¸ç”¨æˆ·ç®¡ç†

1. å®šæœŸæ›´æ–°ç³»ç»Ÿï¼š
    
    å®šæœŸè¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œä»¥è·å–æœ€æ–°çš„å®‰å…¨è¡¥ä¸ï¼š
    
    Bash
    
    ```
    sudo apt update && sudo apt full-upgrade -y
    ```
    
2. ä½¿ç”¨ä¸“æœ‰ä½æƒé™ç”¨æˆ·ï¼š
    
    æ‚¨å·²ç»ä¸ºæ—¶é—´æœºå™¨åˆ›å»ºäº†ä¸“ç”¨ç”¨æˆ· tmuserï¼Œè¿™æ˜¯éå¸¸å¥½çš„å®è·µã€‚è¯·ç¡®ä¿è¿™ä¸ªç”¨æˆ·ä¸å±äº sudo ç”¨æˆ·ç»„ï¼Œå®ƒçš„æƒé™ä»…é™äºè¯»å†™å¤‡ä»½ç›®å½•ã€‚
    
    - æ£€æŸ¥ç”¨æˆ·æ‰€å±ç»„ï¼š`groups tmuser`
        
    - å¦‚æœä¸æ…åŠ å…¥äº†sudoç»„ï¼Œå¯ä»¥ç§»é™¤ï¼š`sudo deluser tmuser sudo`
        

### æ€»ç»“

é€šè¿‡ä»¥ä¸Šé…ç½®ï¼Œæ‚¨çš„æ—¶é—´æœºå™¨æœåŠ¡å™¨å°†å˜ä¸ºï¼š

- **æ›´åŠ éšè”½**ï¼šç§»é™¤äº†Avahiå¹¿æ’­ï¼Œä¸ä¼šä¸»åŠ¨æš´éœ²åœ¨ç½‘ç»œä¸­ã€‚
    
- **è®¿é—®å—æ§**ï¼šé€šè¿‡é˜²ç«å¢™å’ŒSambaé…ç½®ï¼Œåªå…è®¸å±€åŸŸç½‘å†…çš„ç‰¹å®šè®¾å¤‡è®¿é—®ã€‚
    
- **ç®¡ç†å…¥å£åŠ å›º**ï¼šSSHè®¿é—®è¢«ä¸¥æ ¼é™åˆ¶ï¼Œèƒ½æœ‰æ•ˆæŠµå¾¡æœªæˆæƒçš„ç™»å½•å°è¯•ã€‚
    

è™½ç„¶ç‰ºç‰²äº†ä¸€ç‚¹ç‚¹â€œå³æ’å³ç”¨â€çš„ä¾¿åˆ©æ€§ï¼Œä½†æ¢æ¥çš„æ˜¯ä¸€ä¸ªæ›´åŠ å®‰å…¨ã€ç¨³å›ºå’Œä¸“ä¸šçš„å®¶åº­æ•°æ®å¤‡ä»½ä¸­å¿ƒã€‚

---
# å››ã€å†è®©å°åŠ©æ‰‹ä»¬å¸®æˆ‘ä¿®æ”¹é»˜è®¤é…ç½®

## **1.å°†é»˜è®¤å®‰è£…çš„smb.confé…ç½®æ–‡ä»¶ä¸Šä¼ ç»™geminiï¼Œå¸®æˆ‘ä¿®æ”¹æˆå®‰å…¨å¢å¼ºé…ç½®ï¼Œå¦‚ä¸‹ï¼š**

å¥½çš„ï¼Œéµç…§æ‚¨çš„è¦æ±‚ï¼Œè¿™æ˜¯ä¸€ä¸ªåŸºäºæ‚¨æä¾›çš„é»˜è®¤`smb.conf`æ–‡ä»¶ä¿®æ”¹è€Œæˆçš„å®‰å…¨å¢å¼ºé…ç½®ã€‚

æ­¤é…ç½®ä¸»è¦ç”¨äºå°†æ ‘è“æ´¾ä½œä¸ºä¸“ç”¨çš„**æ—¶é—´æœºå™¨ï¼ˆTime Machineï¼‰å¤‡ä»½æœåŠ¡å™¨**ï¼Œå¹¶éµå¾ªäº†å®‰å…¨æœ€ä½³å®è·µï¼šç§»é™¤äº†ä¸å¿…è¦çš„å…±äº«ï¼Œé™åˆ¶äº†è®¿é—®æƒé™ï¼Œå¹¶å¼ºåˆ¶ä½¿ç”¨æ›´å®‰å…¨çš„åè®®ã€‚

### å®‰å…¨å¢å¼ºå‹ `smb.conf` é…ç½®æ–‡ä»¶

æ‚¨å¯ä»¥ç›´æ¥ç”¨ä»¥ä¸‹å†…å®¹æ›¿æ¢æ‰æ‚¨çš„ `/etc/samba/smb.conf` æ–‡ä»¶ã€‚

Ini, TOML

```
# =====================================================================
#          SECURITY-ENHANCED SAMBA CONFIGURATION
#         for a dedicated Raspberry Pi Time Machine Server
# =====================================================================

[global]
# --- åŸºæœ¬èº«ä»½ä¸ç½‘ç»œè®¾ç½® ---
# å°† WORKGROUP æ›¿æ¢æˆæ‚¨çš„å±€åŸŸç½‘å·¥ä½œç»„åç§°ï¼Œæˆ–ä¿æŒé»˜è®¤
   workgroup = PI4BHOUSE
# è®¾ç½®æœåŠ¡å™¨çš„æè¿°ï¼Œä¼šåœ¨ç½‘ç»œä¸­æ˜¾ç¤º
   server string = %h Samba Server (Raspberry Pi)

# --- ç½‘ç»œå®‰å…¨ä¸æ¥å£ç»‘å®š ---
# IMPORTANT: ä»…å…è®¸æ¥è‡ªæ‚¨å±€åŸŸç½‘çš„è¿æ¥ï¼Œè¯·å°†'192.168.1.'æ›¿æ¢æˆæ‚¨è‡ªå·±çš„ç½‘æ®µ
# '127.' æ˜¯å…è®¸æœ¬æœºè®¿é—®ï¼Œå¿…é¡»ä¿ç•™ã€‚
   hosts allow = 192.168.1. 127.
   hosts deny = 0.0.0.0/0

# (å¯é€‰) å¦‚æœæ‚¨çš„æ ‘è“æ´¾æœ‰å¤šä¸ªç½‘ç»œæ¥å£ï¼ˆå¦‚æœ‰çº¿å’Œæ— çº¿ï¼‰ï¼Œ
# å–æ¶ˆä¸‹é¢ä¸¤è¡Œçš„æ³¨é‡Šï¼Œå¹¶æŒ‡å®šåªåœ¨å®‰å…¨çš„æœ‰çº¿æ¥å£(ä¾‹å¦‚ eth0)ä¸Šæä¾›æœåŠ¡
#   interfaces = lo eth0
#   bind interfaces only = yes

# --- åè®®å®‰å…¨ ---
# å¼ºåˆ¶ä½¿ç”¨ SMBv3 åè®®ï¼Œç¦ç”¨è€æ—§ä¸”ä¸å®‰å…¨çš„ SMBv1
   server min protocol = SMB3

# --- æ—¥å¿—è®°å½• ---
# ä¸ºæ¯ä¸ªè¿æ¥çš„å®¢æˆ·ç«¯åˆ›å»ºç‹¬ç«‹çš„æ—¥å¿—æ–‡ä»¶
   log file = /var/log/samba/log.%m
# æ—¥å¿—æ–‡ä»¶æœ€å¤§å°ºå¯¸ (å•ä½ KB)
   max log size = 1000
   logging = file
# å‘ç”Ÿä¸¥é‡é”™è¯¯æ—¶çš„å¤„ç†åŠ¨ä½œ
   panic action = /usr/share/samba/panic-action %d

# --- è®¤è¯ä¸å¯†ç  ---
   server role = standalone server
   obey pam restrictions = yes
   unix password sync = yes
   passwd program = /usr/bin/passwd %u
   passwd chat = *Enter\snew\s*\spassword:* %n\n *Retype\snew\s*\spassword:* %n\n *password\supdated\ssuccessfully* .
   pam password change = yes
   map to guest = bad user

# --- ç”¨æˆ·å…±äº«å®‰å…¨ ---
# ç¦æ­¢é root ç”¨æˆ·åˆ›å»ºå…±äº«ï¼Œå¢å¼ºå®‰å…¨æ€§
   usershare allow guests = no

# --- macOS & Time Machine å…¼å®¹æ€§ä¼˜åŒ– ---
   vfs objects = fruit streams_xattr
   fruit:metadata = stream
   fruit:model = TimeCapsule8,119
   fruit:posix_rename = yes 
   fruit:veto_appledouble = no
   fruit:wipe_intentionally_left_blank_rfork = yes 
   fruit:delete_empty_adfiles = yes 

#======================= Share Definitions =======================

# --- æ—¶é—´æœºå™¨å¤‡ä»½ä¸“ç”¨å…±äº« ---
# è¿™æ˜¯å”¯ä¸€å¯ç”¨çš„å…±äº«
[TimeMachineBackup]
   comment = Time Machine Backup Disk
# IMPORTANT: å°†è·¯å¾„ä¿®æ”¹ä¸ºæ‚¨ç”¨äºå¤‡ä»½çš„RAIDç£ç›˜é˜µåˆ—çš„æŒ‚è½½ç‚¹
   path = /mnt/timemachine
   browseable = yes
   writeable = yes
   create mask = 0600
   directory mask = 0700
# IMPORTANT: 'tmuser' æ˜¯æ‚¨ä¸ºæ—¶é—´æœºå™¨åˆ›å»ºçš„ä¸“ç”¨ç”¨æˆ·åï¼Œè¯·ç¡®ä¿å·²åˆ›å»ºè¯¥ç”¨æˆ·
   valid users = tmuser
# å¯ç”¨ Time Machine æ”¯æŒ
   fruit:time machine = yes


# --- ç¦ç”¨çš„é»˜è®¤å…±äº« ---
# å‡ºäºå®‰å…¨è€ƒè™‘ï¼Œæˆ‘ä»¬æ³¨é‡Šæ‰æ‰€æœ‰ä¸å¿…è¦çš„é»˜è®¤å…±äº«

;[homes]
;   comment = Home Directories
;   browseable = no
;   read only = yes
;   create mask = 0700
;   directory mask = 0700
;   valid users = %S

;[printers]
;   comment = All Printers
;   browseable = no
;   path = /var/spool/samba
;   printable = yes
;   guest ok = no
;   read only = yes
;   create mask = 0700

;[print$]
;   comment = Printer Drivers
;   path = /var/lib/samba/printers
;   browseable = yes
;   read only = yes
;   guest ok = no
```

### ä¸»è¦å®‰å…¨å˜æ›´è¯´æ˜

1. **é™åˆ¶è®¿é—®IP (`hosts allow`, `hosts deny`)**ï¼šè¿™æ˜¯æœ€é‡è¦çš„å®‰å…¨æªæ–½ä¹‹ä¸€ã€‚å®ƒå°†SambaæœåŠ¡çš„è®¿é—®æƒé™**ä»…é™äºæ‚¨æŒ‡å®šçš„å±€åŸŸç½‘IPåœ°å€æ®µ**ï¼Œä»ç½‘ç»œå±‚é¢é˜»æ­¢äº†æ¥è‡ªå¤–éƒ¨ç½‘ç»œçš„ä»»ä½•æ½œåœ¨è¿æ¥å°è¯•ã€‚
    
2. **å¼ºåˆ¶ä½¿ç”¨SMB3åè®® (`server min protocol`)**ï¼šé…ç½®ç¦ç”¨äº†è¿‡æ—¶ä¸”å­˜åœ¨ä¸¥é‡å®‰å…¨æ¼æ´çš„SMBv1åè®®ï¼Œå¼ºåˆ¶å®¢æˆ·ç«¯ä½¿ç”¨æ›´ç°ä»£ã€æ›´å®‰å…¨çš„SMB3åè®®è¿›è¡Œé€šä¿¡ã€‚
    
3. **ç¦ç”¨ç”¨æˆ·å…±äº« (`usershare allow guests`)**ï¼šå°†æ­¤é¡¹è®¾ä¸º`no`ï¼Œå¯ä»¥é˜²æ­¢éç®¡ç†å‘˜ç”¨æˆ·é€šè¿‡ `net usershare` å‘½ä»¤æ„å¤–åœ°åˆ›å»ºä¸å®‰å…¨çš„å…¬å¼€å…±äº«ã€‚
    
4. **ç§»é™¤ä¸å¿…è¦çš„å…±äº«**ï¼šé»˜è®¤çš„ `[homes]`, `[printers]`, å’Œ `[print$]` å…±äº«å·²è¢«å®Œå…¨æ³¨é‡Šæ‰ã€‚å¯¹äºä¸€å°ä¸“ç”¨çš„å¤‡ä»½æœåŠ¡å™¨æ¥è¯´ï¼Œå¼€å¯è¿™äº›å…±äº«ä¼šå¢åŠ ä¸å¿…è¦çš„æ”»å‡»é¢ã€‚
    
5. **å¢å¼ºmacOSå…¼å®¹æ€§ä¸åŠŸèƒ½**ï¼šåœ¨`[global]`éƒ¨åˆ†æ·»åŠ äº†ä¸€ç³»åˆ—`fruit`ç›¸å…³çš„VFSå¯¹è±¡è®¾ç½®ï¼Œè¿™å¯ä»¥æ›´å¥½åœ°æ¨¡æ‹Ÿä¸€ä¸ªåŸç”Ÿçš„è‹¹æœæ–‡ä»¶æœåŠ¡å™¨ï¼ˆå¦‚Time Capsuleï¼‰ï¼Œæå‡å…¼å®¹æ€§å’Œæ€§èƒ½ã€‚
    
6. **æ˜ç¡®æŒ‡å®šæœ‰æ•ˆç”¨æˆ· (`valid users`)**ï¼šåœ¨ `[TimeMachineBackup]` å…±äº«ä¸­ï¼Œé€šè¿‡ `valid users = tmuser` æ˜ç¡®æŒ‡å®šäº†åªæœ‰ `tmuser` è¿™ä¸ªç”¨æˆ·æ‰èƒ½è®¿é—®è¯¥å…±äº«ï¼Œé˜²æ­¢å…¶ä»–ç”¨æˆ·è¯¯ç”¨ã€‚
    

### åç»­æ­¥éª¤

1. **å¤‡ä»½æ—§é…ç½®**ï¼š
    
    Bash
    
    ```
    sudo mv /etc/samba/smb.conf /etc/samba/smb.conf.bak
    ```
    
2. **åˆ›å»ºæ–°é…ç½®**ï¼š
    
    Bash
    
    ```
    sudo nano /etc/samba/smb.conf
    ```
    
    å°†ä¸Šé¢çš„é…ç½®å†…å®¹ç²˜è´´è¿›å»ã€‚**è¯·åŠ¡å¿…æ ¹æ®æ³¨é‡Šä¸­çš„æç¤ºï¼Œä¿®æ”¹ `hosts allow` çš„ç½‘æ®µã€å…±äº«çš„ `path` ä»¥åŠ `valid users` çš„ç”¨æˆ·å**ã€‚
    
3. æµ‹è¯•é…ç½®ï¼š
    
    è¿è¡Œ testparm å‘½ä»¤æ£€æŸ¥é…ç½®æ–‡ä»¶æ˜¯å¦å­˜åœ¨è¯­æ³•é”™è¯¯ã€‚
    
    Bash
    
    ```
    testparm
    ```
    
    å¦‚æœæ²¡æœ‰é”™è¯¯ï¼Œå®ƒä¼šæ˜¾ç¤º "Loaded services file OK."ã€‚
    
4. é‡å¯SambaæœåŠ¡ï¼š
    
    ä½¿æ–°é…ç½®ç”Ÿæ•ˆã€‚
    
    Bash
    
    ```
    sudo systemctl restart smbd.service nmbd.service
    ```

---
## **2.chatgptä¿®æ”¹çš„å®‰å…¨å¢å¼ºé…ç½®ï¼š**

æˆ‘çœ‹äº†ä½ çš„ `/etc/samba/smb.conf`ï¼Œç›®å‰è¿™ä¸ªé…ç½®æ˜¯ Debian ç³»ç»Ÿè‡ªå¸¦çš„ç¤ºä¾‹ç‰ˆæœ¬ï¼Œ  
å®‰å…¨æ€§æ–¹é¢æœ‰å‡ ä¸ªæ˜æ˜¾å¯ä»¥ä¼˜åŒ–çš„åœ°æ–¹ï¼Œå°¤å…¶æ˜¯è€ƒè™‘ä½ è¦éƒ¨ç½² Time Machine ç”¨çš„å…±äº«ã€‚

æˆ‘å¸®ä½ ç›´æ¥æ”¹æˆ**å®‰å…¨å¢å¼ºç‰ˆ**ï¼Œå»æ‰ä¸å¿…è¦çš„åŒ¿åè®¿é—®ã€æ‰“å°æœºå…±äº«ã€NetBIOS å¹¿æ’­ç­‰ï¼Œ  
å¹¶åŠ ä¸Š SMB3 åŠ å¯†å’Œ Time Machine ç›¸å…³é…ç½®ã€‚

---

### ä¼˜åŒ–åçš„ smb.confï¼ˆå®‰å…¨å¢å¼ºï¼‰

```ini
[global]
   server string = Time Machine Server
   workgroup = PI4BHOUSE

   # å®‰å…¨ç›¸å…³
   map to guest = never             # ç¦æ­¢ guest è‡ªåŠ¨æ˜ å°„
   usershare allow guests = no      # ç¦æ­¢éè®¤è¯å…±äº«
   disable netbios = yes            # å…³é—­ NetBIOS å¹¿æ’­
   smb encrypt = required           # å¼ºåˆ¶ SMB3 åŠ å¯†
   min protocol = SMB2              # ç¦æ­¢ SMB1
   max protocol = SMB3

   # è®°å½•æ—¥å¿—
   log file = /var/log/samba/log.%m
   max log size = 1000
   logging = file
   panic action = /usr/share/samba/panic-action %d

   server role = standalone server
   obey pam restrictions = yes
   unix password sync = yes
   passwd program = /usr/bin/passwd %u
   passwd chat = *Enter\snew\s*\spassword:* %n\n *Retype\snew\s*\spassword:* %n\n *password\supdated\ssuccessfully* .
   pam password change = yes

[TimeMachine]
   comment = Time Machine Backup
   path = /data/smb                 # ä½ çš„å¤‡ä»½è·¯å¾„
   valid users = tmuser              # å…è®¸è®¿é—®çš„ç”¨æˆ·
   read only = no
   browseable = no                   # ä¸åœ¨ç½‘ç»œæµè§ˆä¸­æ˜¾ç¤º
   create mask = 0660
   directory mask = 0770
   vfs objects = catia fruit streams_xattr
   fruit:time machine = yes
   fruit:time machine max size = 2T  # é™åˆ¶ Time Machine å ç”¨ç©ºé—´ï¼ˆå¯è°ƒï¼‰
```

---

### æ”¹åŠ¨è¦ç‚¹

1. **ç¦æ­¢ guest**
    
    - `map to guest = never`
        
    - `usershare allow guests = no`
        
    - ä¿è¯å¿…é¡»è®¤è¯æ‰èƒ½è®¿é—®ã€‚
        
2. **å…³é—­ä¸å¿…è¦çš„æœåŠ¡**
    
    - å…³é—­ NetBIOSï¼ˆ`disable netbios = yes`ï¼‰
        
    - åˆ é™¤ `[printers]` å’Œ `[print$]` å…±äº«ï¼Œå‡å°‘ç«¯å£æš´éœ²ã€‚
        
3. **å¼ºåˆ¶ SMB3 åŠ å¯†**
    
    - `smb encrypt = required`
        
    - åªå…è®¸ SMB2 åŠä»¥ä¸Šåè®®ï¼ˆ`min protocol = SMB2`ï¼Œ`max protocol = SMB3`ï¼‰ã€‚
        
4. **æœ€å°æš´éœ²åŸåˆ™**
    
    - `browseable = no` é¿å…å…±äº«å‡ºç°åœ¨ Finder çš„â€œç½‘ç»œâ€é‡Œï¼ˆå¿…é¡»æ‰‹åŠ¨è¾“å…¥åœ°å€ï¼‰ã€‚
        
    - é™åˆ¶ç”¨æˆ·ï¼š`valid users = tmuser`ã€‚
        
5. **å¤‡ä»½ç©ºé—´é™åˆ¶**
    
    - `fruit:time machine max size = 2T` é¿å… Time Machine å æ»¡æ•´ä¸ªç£ç›˜ã€‚
        

---

### é¢å¤–å»ºè®®

- **é˜²ç«å¢™é™åˆ¶**ï¼šåªå…è®¸å†…ç½‘è®¿é—®ç«¯å£ 445
    
    ```bash
    sudo ufw allow from 192.168.1.0/24 to any port 445 proto tcp
    sudo ufw enable
    ```
    
- **å•ç‹¬ç”¨æˆ·**ï¼šç¡®ä¿ `tmuser` åªç”¨äº Time Machineï¼Œæƒé™ä»…é™ `/data/smb`ã€‚
    

---

å¦‚æœä½ æ„¿æ„ï¼Œæˆ‘å¯ä»¥å¸®ä½ æŠŠè¿™ä¸ªå®‰å…¨å¢å¼ºç‰ˆç›´æ¥**åˆå¹¶è¿›ä½ ç°æœ‰ smb.conf**ï¼Œä¿æŒå¯ç”¨æ€§åŒæ—¶ä¸ç ´åå…¶ä»–æœåŠ¡ã€‚  
ä½ è¦æˆ‘å¸®ä½ ç›´æ¥ç”Ÿæˆåˆå¹¶ç‰ˆå—ï¼Ÿè¿™æ ·ä½ ç›´æ¥æ›¿æ¢å³å¯ç”¨ã€‚

# äº”ã€ç›´æ¥äº’æ€¼ï¼Œåˆå¹¶æˆå®‰å…¨é…ç½®ï¼Œhahaï¼ˆçœ‹ç€è¿˜æ˜¯geminiæ›´ä¸“ä¸šä¸€ç‚¹ï¼Œä¸ªäººè§‚ç‚¹ï¼‰

## æé—®ï¼šä½ å’Œchatgptå„è‡ªç”Ÿæˆçš„å®‰å…¨å¢å¼ºé…ç½®æ–‡ä»¶ï¼Œæ¯”è¾ƒä¼˜ç¼ºç‚¹ï¼Œåˆå¹¶ç”Ÿæˆä¸€ä¸ª

## Geminiå›ç­”ï¼š

å¥½çš„ï¼Œæˆ‘ä»¬æ¥å¯¹è¿™ä¸¤ä¸ªç”±æˆ‘å’ŒChatGPTç”Ÿæˆçš„å®‰å…¨å¢å¼ºå‹`smb.conf`é…ç½®æ–‡ä»¶è¿›è¡Œä¼˜ç¼ºç‚¹æ¯”è¾ƒï¼Œå¹¶åœ¨æ­¤åŸºç¡€ä¸Šåˆå¹¶ç”Ÿæˆä¸€ä¸ªæ›´ä¼˜çš„æœ€ç»ˆç‰ˆæœ¬ã€‚

### ä¼˜ç¼ºç‚¹æ¯”è¾ƒ

#### æˆ‘çš„ï¼ˆGeminiï¼‰é…ç½®æ–‡ä»¶ (smb.conf.gemini-safety)

**ä¼˜ç‚¹:**

- **å¼ºå¤§çš„ç½‘ç»œå±‚å®‰å…¨**ï¼šä½¿ç”¨äº† `hosts allow` å’Œ `hosts deny` ï¼Œå°†è®¿é—®æƒé™ä¸¥æ ¼é™åˆ¶åœ¨æŒ‡å®šçš„å±€åŸŸç½‘IPæ®µå†…ï¼Œè¿™æ˜¯é˜²æ­¢æœªæˆæƒè®¿é—®çš„æœ€æœ‰æ•ˆæ‰‹æ®µä¹‹ä¸€ã€‚
    
- **æ›´ä¸¥æ ¼çš„åè®®æ ‡å‡†**ï¼šå¼ºåˆ¶ `server min protocol = SMB3` ï¼Œç›´æ¥ç¦ç”¨äº†SMBv1å’ŒSMBv2ï¼Œåªå…è®¸å½“å‰æœ€å®‰å…¨çš„åè®®ç‰ˆæœ¬ã€‚
    
- **å…¨é¢çš„macOSå…¼å®¹æ€§ä¼˜åŒ–**ï¼šåœ¨ `[global]` éƒ¨åˆ†åŒ…å«äº†è¯¦ç»†çš„ `fruit` VFSå¯¹è±¡è®¾ç½® ï¼Œè¿™èƒ½æ›´å¥½åœ°æ¨¡æ‹ŸåŸç”ŸAppleæœåŠ¡å™¨ï¼ˆTime Capsuleï¼‰ï¼Œæå‡äº†æ•´ä½“å…¼å®¹æ€§å’Œæ€§èƒ½ï¼Œè€Œä¸ä»…ä»…æ˜¯ä¸ºTime Machineæœ¬èº«ã€‚
    
- **æ›´å®‰å…¨çš„é»˜è®¤æƒé™**ï¼š`create mask = 0600` å’Œ `directory mask = 0700`  ç¡®ä¿äº†æ–°åˆ›å»ºçš„æ–‡ä»¶å’Œç›®å½•åªæœ‰æ‰€æœ‰è€…ï¼ˆå³å¤‡ä»½ç”¨æˆ·
    
    `tmuser`ï¼‰æœ‰æƒè¯»å†™ï¼Œç¬¦åˆæœ€å°æƒé™åŸåˆ™ã€‚
    
- **æ³¨é‡Šè¯¦å°½**ï¼šæ–‡ä»¶åŒ…å«äº†å¤§é‡çš„ä¸­æ–‡æ³¨é‡Šï¼Œæ¸…æ™°åœ°è§£é‡Šäº†å„é¡¹é…ç½®çš„ä½œç”¨å’Œéœ€è¦ç”¨æˆ·ä¿®æ”¹çš„åœ°æ–¹ï¼Œå¯¹ç”¨æˆ·éå¸¸å‹å¥½ã€‚
    

**ç¼ºç‚¹:**

- **æœªå¼ºåˆ¶åŠ å¯†**ï¼šæ²¡æœ‰åŒ…å« `smb encrypt = required`ã€‚è™½ç„¶SMB3é»˜è®¤ä¼šä¼˜å…ˆä½¿ç”¨åŠ å¯†ï¼Œä½†å¼ºåˆ¶è¦æ±‚ä¼šæ›´åŠ å®‰å…¨ã€‚
    
- **æœªç¦ç”¨NetBIOS**ï¼šNetBIOSæ˜¯å¹¿æ’­åè®®ï¼Œåœ¨ç°ä»£ç½‘ç»œä¸­é€šå¸¸æ˜¯ä¸å¿…è¦çš„ï¼Œç¦ç”¨å®ƒå¯ä»¥å‡å°‘ç½‘ç»œå™ªéŸ³å’Œæ½œåœ¨çš„æ”»å‡»é¢ã€‚
    
- **å¯è§çš„å…±äº«**ï¼š`browseable = yes`  ä½¿å¾—å…±äº«åœ¨ç½‘ç»œä¸Šå¯è§ï¼Œè™½ç„¶æ–¹ä¾¿ï¼Œä½†ä»å®‰å…¨è§’åº¦çœ‹ï¼Œéšè—ä¸“ç”¨å…±äº«ï¼ˆ
    
    `browseable = no`ï¼‰æ˜¯æ›´ä½³å®è·µã€‚
    
- **ç¼ºå°‘ç©ºé—´é™åˆ¶**ï¼šæ²¡æœ‰ä¸ºTime Machineå¤‡ä»½è®¾ç½®å¤§å°ä¸Šé™ (`fruit:time machine max size`)ï¼Œå¯èƒ½å¯¼è‡´å¤‡ä»½å æ»¡æ•´ä¸ªç£ç›˜é˜µåˆ—ã€‚
    

#### ChatGPT é…ç½®æ–‡ä»¶ (smb.conf.chatgpt-safety)

**ä¼˜ç‚¹:**

- **å¼ºåˆ¶åŠ å¯†**ï¼šæ˜ç¡®è®¾ç½®äº† `smb encrypt = required` ï¼Œå¼ºåˆ¶æ‰€æœ‰SMB3é€šä¿¡å¿…é¡»åŠ å¯†ï¼Œè¿™æ˜¯ä¸€ä¸ªéå¸¸å¥½çš„å®‰å…¨å®è·µã€‚
    
- **ç¦ç”¨NetBIOS**ï¼šåŒ…å«äº† `disable netbios = yes` ï¼Œå‡å°‘äº†ä¸å¿…è¦çš„ç½‘ç»œå¹¿æ’­ã€‚
    
- **éšè—å…±äº«**ï¼šè®¾ç½®äº† `browseable = no` ï¼Œä½¿å¤‡ä»½å…±äº«ä¸ä¼šå‡ºç°åœ¨ç½‘ç»œé‚»å±…ä¸­ï¼Œé˜²æ­¢è¢«è½»æ˜“å‘ç°ã€‚
    
- **å¤‡ä»½ç©ºé—´é™åˆ¶**ï¼šæä¾›äº† `fruit:time machine max size = 2T`  çš„é…ç½®ï¼Œè¿™æ˜¯ä¸€ä¸ªéå¸¸å®ç”¨çš„åŠŸèƒ½ï¼Œå¯ä»¥æœ‰æ•ˆç®¡ç†å­˜å‚¨ç©ºé—´ã€‚
    
- **æ›´æ˜ç¡®çš„Guestæ˜ å°„**ï¼šä½¿ç”¨ `map to guest = never` ï¼Œæ¯”
    
    `bad user` æ›´ç›´æ¥åœ°ç¦æ­¢äº†ä»»ä½•guestæ˜ å°„å°è¯•ã€‚
    

**ç¼ºç‚¹:**

- **ç¼ºå°‘ç½‘ç»œå±‚å®‰å…¨**ï¼š**æœ€å¤§çš„çŸ­æ¿**æ˜¯å®Œå…¨æ²¡æœ‰ `hosts allow / deny` è§„åˆ™ï¼Œå…è®¸å±€åŸŸç½‘å†…ä»»ä½•è®¾å¤‡å°è¯•è¿æ¥SambaæœåŠ¡ï¼Œå®‰å…¨æ€§è¿œä½äºæˆ‘çš„ç‰ˆæœ¬ã€‚
    
- **åè®®æ ‡å‡†ä¸å¤Ÿä¸¥æ ¼**ï¼š`min protocol = SMB2`  è™½ç„¶ç¦ç”¨äº†ä¸å®‰å…¨çš„SMBv1ï¼Œä½†ä»å…è®¸ä½¿ç”¨ç›¸å¯¹è€æ—§çš„SMBv2ã€‚
    
- **æƒé™è®¾ç½®è¿‡äºå®½æ¾**ï¼š`create mask = 0660` å’Œ `directory mask = 0770`  ç»™äºˆäº†åŒç»„ç”¨æˆ·å†™å…¥æƒé™ï¼Œå¯¹äºå•ç”¨æˆ·ä¸“ç”¨çš„Time Machineå¤‡ä»½æ¥è¯´ï¼Œè¿™æ˜¯ä¸å¿…è¦ä¸”ä¸å®‰å…¨çš„ã€‚
    
- **macOSå…¼å®¹æ€§é…ç½®ä¸å®Œæ•´**ï¼š`vfs objects` ä¸­åŒ…å«äº†`catia` ï¼Œè¿™æ˜¯ä¸€ä¸ªè¾ƒæ—§çš„æ¨¡å—ï¼Œå¹¶ä¸”ç¼ºå°‘äº†
    
    `[global]`éƒ¨åˆ†çš„å…¨å±€`fruit`ä¼˜åŒ–ã€‚
    

---

### åˆå¹¶ç”Ÿæˆçš„æœ€ç»ˆä¼˜åŒ–ç‰ˆæœ¬

ä¸‹é¢çš„é…ç½®èåˆäº†åŒæ–¹çš„ä¼˜ç‚¹ï¼Œå¹¶ä¿®å¤äº†å„è‡ªçš„ç¼ºç‚¹ï¼Œæ—¨åœ¨æä¾›**æœ€é«˜çº§åˆ«çš„å®‰å…¨æ€§å’Œæœ€ä½³çš„macOSå…¼å®¹æ€§**ã€‚

Ini, TOML

```
# =====================================================================
#          MERGED & OPTIMIZED SAMBA CONFIGURATION
#         for a dedicated Raspberry Pi Time Machine Server
#         (Combines the best of Gemini & ChatGPT's configs)
# =====================================================================

[global]
# --- åŸºæœ¬èº«ä»½ä¸ç½‘ç»œè®¾ç½® ---
   workgroup = PI4BHOUSE
   server string = %h Samba Server (Raspberry Pi)

# --- ç½‘ç»œå®‰å…¨ä¸æ¥å£ç»‘å®š (æ¥è‡ª Gemini, å…³é”®å®‰å…¨å±‚) ---
# ä»…å…è®¸æ¥è‡ªæ‚¨å±€åŸŸç½‘çš„è¿æ¥ï¼Œè¯·å°†'192.168.1.'æ›¿æ¢æˆæ‚¨è‡ªå·±çš„ç½‘æ®µ
   hosts allow = 192.168.1. 127.
   hosts deny = 0.0.0.0/0
# ç¦ç”¨NetBIOSï¼Œå‡å°‘å¹¿æ’­ (æ¥è‡ª ChatGPT)
   disable netbios = yes

# --- åè®®ä¸åŠ å¯†å®‰å…¨ (åŒæ–¹åˆå¹¶ä¼˜åŒ–) ---
# å¼ºåˆ¶ä½¿ç”¨ SMB3 åè®® (æ¥è‡ª Gemini, æ›´ä¸¥æ ¼)
   server min protocol = SMB3
# å¼ºåˆ¶æ‰€æœ‰SMB3é€šä¿¡åŠ å¯† (æ¥è‡ª ChatGPT, æ›´å®‰å…¨)
   smb encrypt = required

# --- æ—¥å¿—è®°å½• ---
   log file = /var/log/samba/log.%m
   max log size = 1000
   logging = file
   panic action = /usr/share/samba/panic-action %d

# --- è®¤è¯ä¸å¯†ç  ---
   server role = standalone server
   obey pam restrictions = yes
   unix password sync = yes [cite: 3]
   passwd program = /usr/bin/passwd %u
   passwd chat = *Enter\snew\s*\spassword:* %n\n *Retype\snew\s*\spassword:* %n\n *password\supdated\ssuccessfully* .
   pam password change = yes [cite: 4, 12]
# æ˜ç¡®ç¦æ­¢Guestæ˜ å°„ (æ¥è‡ª ChatGPT, æ›´æ˜ç¡®)
   map to guest = never
# ç¦æ­¢é root ç”¨æˆ·åˆ›å»ºå…±äº«
   usershare allow guests = no

# --- å…¨å±€ macOS & Time Machine å…¼å®¹æ€§ä¼˜åŒ– (æ¥è‡ª Gemini, æ›´å…¨é¢) ---
   vfs objects = fruit streams_xattr
   fruit:metadata = stream
   fruit:model = TimeCapsule8,119
   fruit:posix_rename = yes
   fruit:veto_appledouble = no
   fruit:wipe_intentionally_left_blank_rfork = yes
   fruit:delete_empty_adfiles = yes

#======================= Share Definitions =======================

# --- æ—¶é—´æœºå™¨å¤‡ä»½ä¸“ç”¨å…±äº« (åŒæ–¹åˆå¹¶ä¼˜åŒ–) ---
[TimeMachineBackup]
   comment = Time Machine Backup Disk
# å°†è·¯å¾„ä¿®æ”¹ä¸ºæ‚¨ç”¨äºå¤‡ä»½çš„RAIDç£ç›˜é˜µåˆ—çš„æŒ‚è½½ç‚¹
   path = /mnt/timemachine
# è®¾ç½®ä¸ºä¸å¯æµè§ˆï¼Œå¢å¼ºéšè—æ€§ (æ¥è‡ª ChatGPT)
   browseable = no
# ç¡®ä¿å¯å†™
   writable = yes [cite: 5]
# è®¾ç½®ä¸¥æ ¼çš„æ–‡ä»¶/ç›®å½•æƒé™ (æ¥è‡ª Gemini, æ›´å®‰å…¨)
   create mask = 0600
   directory mask = 0700
# æŒ‡å®šç”¨äºæ—¶é—´æœºå™¨çš„ä¸“ç”¨ç”¨æˆ·å
   valid users = tmuser
# å¯ç”¨ Time Machine æ”¯æŒ
   fruit:time machine = yes
# é™åˆ¶æ­¤å¤‡ä»½å ç”¨çš„æœ€å¤§ç©ºé—´ï¼Œè¯·æ ¹æ®æ‚¨çš„ç£ç›˜å¤§å°è°ƒæ•´ (æ¥è‡ª ChatGPT, åŠŸèƒ½å®ç”¨)
   fruit:time machine max size = 2T
```

### æœ€ç»ˆç‰ˆæœ¬ä¼˜åŠ¿æ€»ç»“ï¼š

1. **åˆ†å±‚å®‰å…¨**ï¼šåŒæ—¶æ‹¥æœ‰**ç½‘ç»œå±‚é˜²ç«å¢™** (`hosts allow`) å’Œ**åº”ç”¨å±‚åŠ å¯†** (`smb encrypt`)ï¼Œæ„å»ºç«‹ä½“é˜²å¾¡ã€‚
    
2. **æœ€ä¸¥åè®®**ï¼šåªå…è®¸`SMB3`åè®®ï¼Œæœç»äº†æ‰€æœ‰å·²çŸ¥çš„è€æ—§åè®®æ¼æ´ã€‚
    
3. **æœ€å°æƒé™**ï¼šæ— è®ºæ˜¯æ–‡ä»¶ç³»ç»Ÿæƒé™ (`create mask`) è¿˜æ˜¯ç”¨æˆ·è®¿é—®æƒé™ (`valid users`)ï¼Œéƒ½éµå¾ªäº†æœ€å°åŒ–åŸåˆ™ã€‚
    
4. **å¹²å‡€éšè”½**ï¼šç¦ç”¨äº†NetBIOSå¹¿æ’­å¹¶éšè—äº†å…±äº«ç›®å½•ï¼Œä½¿æœåŠ¡å™¨åœ¨ç½‘ç»œä¸­â€œæ›´å®‰é™â€ï¼Œä¸æ˜“è¢«å‘ç°ã€‚
    
5. **åŠŸèƒ½å®Œæ•´**ï¼šä¸ä»…æä¾›äº†æœ€å…¨é¢çš„macOSå…¼å®¹æ€§ä¼˜åŒ–ï¼Œè¿˜åŒ…å«äº†å®ç”¨çš„å¤‡ä»½å¤§å°é™åˆ¶åŠŸèƒ½ã€‚
    
6. **æ¸…æ™°æ˜äº†**ï¼šä¿ç•™äº†è¯¦å°½çš„æ³¨é‡Šï¼Œæ–¹ä¾¿æ‚¨æ ¹æ®è‡ªå·±çš„ç¯å¢ƒè¿›è¡Œä¿®æ”¹å’Œç»´æŠ¤ã€‚

---

## æé—®ï¼šä½ å’Œgeminiå„è‡ªç”Ÿæˆçš„å®‰å…¨å¢å¼ºé…ç½®æ–‡ä»¶ï¼Œæ¯”è¾ƒä¼˜ç¼ºç‚¹ï¼Œåˆå¹¶ç”Ÿæˆä¸€ä¸ª

## Chatgptå›ç­”ï¼š

å¾ˆå¥½ï¼Œä½ ç°åœ¨æœ‰ä¸¤ä¸ªç‰ˆæœ¬çš„å®‰å…¨å¢å¼ºé…ç½®æ–‡ä»¶ï¼š

- **ChatGPT ç‰ˆ**ï¼ˆ`smb.conf.chatgpt-safety`ï¼‰
    
- **Gemini ç‰ˆ**ï¼ˆ`smb.conf.gemini-safety`ï¼‰
    

æˆ‘å¸®ä½ å¯¹æ¯”ä¸¤ä»½çš„å®‰å…¨ç­–ç•¥å·®å¼‚ï¼Œç„¶ååˆå¹¶æˆä¸€ä¸ª**ç»¼åˆä¼˜åŒ–ç‰ˆ smb.conf**ã€‚

---

## ğŸ” å¯¹æ¯” ChatGPT ä¸ Gemini é…ç½®

### ChatGPT ç‰ˆç‰¹ç‚¹

âœ… ä¼˜ç‚¹ï¼š

- å…³é—­ **guest è®¿é—®**ï¼ˆ`map to guest = never`ï¼‰
    
- å…³é—­ **NetBIOS å¹¿æ’­**ï¼ˆ`disable netbios = yes`ï¼‰
    
- å¼ºåˆ¶ **SMB3 åŠ å¯†**ï¼ˆ`smb encrypt = required`ï¼‰
    
- è®¾ç½® `min protocol = SMB2, max protocol = SMB3`
    
- ç§»é™¤äº† `[printers]` ç­‰å¤šä½™å…±äº«
    
- `fruit:time machine max size` é™åˆ¶ Time Machine ç©ºé—´
    

âš ï¸ ç¼ºç‚¹ï¼š

- æ²¡æœ‰è®¾ç½® `server min protocol = SMB3`ï¼ˆGemini ç‰ˆæœ‰ï¼‰
    
- æ²¡æœ‰å¯¹ `guest ok` æ˜¾å¼è®¾ä¸º `no`ï¼ˆè™½ç„¶ `map to guest` å·²ç»ç¦æ­¢äº†ï¼Œä½†æ˜ç¤ºæ›´ç¨³å¦¥ï¼‰
    

---

### Gemini ç‰ˆç‰¹ç‚¹

âœ… ä¼˜ç‚¹ï¼š

- æ˜¾å¼è®¾ç½® `server min protocol = SMB3`ï¼ˆæ›´å®‰å…¨ï¼Œæœç» SMB2ï¼‰
    
- æ˜¾å¼è®¾ç½® `guest ok = no`
    
- ä½¿ç”¨ `auth methods = guest sam winbind`ï¼Œæ›´ç»†è‡´çš„è®¤è¯ç­–ç•¥
    
- é»˜è®¤å…³é—­ `ntlm auth`ï¼ˆé¿å…å¼±è®¤è¯ï¼‰
    

âš ï¸ ç¼ºç‚¹ï¼š

- å¦‚æœæŸäº›è€è®¾å¤‡è¿˜ä¾èµ– SMB2ï¼Œå®Œå…¨ç¦ç”¨å¯èƒ½å¯¼è‡´ä¸å…¼å®¹ï¼ˆä½†å¯¹ Time Machine æ¥è¯´æ²¡é—®é¢˜ï¼‰
    
- æ²¡æœ‰ `fruit:time machine max size`ï¼Œå®¹æ˜“å¯¼è‡´ç£ç›˜è¢«å æ»¡
    

---

## ğŸ† åˆå¹¶ä¼˜åŒ–ç‰ˆ smb.conf

ç»“åˆä¸¤è€…ä¼˜ç‚¹ï¼Œæœ€ç»ˆé…ç½®å¦‚ä¸‹ï¼š

```ini
[global]
   server string = Time Machine Server
   workgroup = PI4BHOUSE

   # å®‰å…¨è®¾ç½®
   map to guest = never
   usershare allow guests = no
   guest ok = no
   disable netbios = yes
   server min protocol = SMB3   # Gemini: æ›´ä¸¥æ ¼ï¼Œåªå…è®¸ SMB3
   smb encrypt = required
   ntlm auth = no                  # ç¦æ­¢ NTLMv1 å¼±è®¤è¯

   # æ—¥å¿—
   log file = /var/log/samba/log.%m
   max log size = 1000
   logging = file
   panic action = /usr/share/samba/panic-action %d

   server role = standalone server
   obey pam restrictions = yes
   unix password sync = yes
   passwd program = /usr/bin/passwd %u
   passwd chat = *Enter\snew\s*\spassword:* %n\n *Retype\snew\s*\spassword:* %n\n *password\supdated\ssuccessfully* .
   pam password change = yes

[TimeMachine]
   comment = Time Machine Backup
   path = /data/smb
   valid users = tmuser
   read only = no
   browseable = no
   create mask = 0660
   directory mask = 0770
   vfs objects = catia fruit streams_xattr
   fruit:time machine = yes
   fruit:time machine max size = 2T  # é™åˆ¶æœ€å¤§å¤‡ä»½å®¹é‡
```

---

## âœ… ä¼˜åŒ–æ€»ç»“

- **ç»§æ‰¿ ChatGPT ç‰ˆ**ï¼šåŠ äº† `fruit:time machine max size`ï¼Œé˜²æ­¢ç£ç›˜è¢«å¡«æ»¡ã€‚
    
- **ç»§æ‰¿ Gemini ç‰ˆ**ï¼šå¼ºåˆ¶ `SMB3`ã€`ntlm auth = no`ã€`guest ok = no`ï¼Œè¿›ä¸€æ­¥æé«˜å®‰å…¨æ€§ã€‚
    
- åˆ é™¤äº†æ— ç”¨çš„ `[printers]` å’Œ `[homes]`ï¼Œå‡å°‘æš´éœ²é¢ã€‚
    

---

# å¦å¤–ï¼Œä¸æ‡‚å°±é—®ï¼Œå“ˆå“ˆï¼

## æé—®ï¼š

å¸®æ ¸å®geminiç»™çš„ä¼˜åŒ–é…ç½®ï¼š

macOS & Time Machine å…¼å®¹æ€§ä¼˜åŒ– ---
   vfs objects = fruit streams_xattr
   fruit:metadata = stream
   fruit:model = TimeCapsule8,119
   fruit:posix_rename = yes 
   fruit:veto_appledouble = no
   fruit:wipe_intentionally_left_blank_rfork = yes 
   fruit:delete_empty_adfiles = yes 

## geminiå›ç­”ï¼š

ç»æ ¸å®ï¼Œæ‚¨æä¾›çš„è¿™ç»„ `--- macOS & Time Machine å…¼å®¹æ€§ä¼˜åŒ– ---` é…ç½®æ˜¯**æ­£ç¡®ä¸”éå¸¸ç†æƒ³çš„**ã€‚ âœ…

è¿™æ˜¯ä¸€ä¸ªç”¨äºSambaæœåŠ¡å™¨çš„ç°ä»£åŒ–â€œæœ€ä½³å®è·µâ€é…ç½®ï¼Œæ—¨åœ¨ä¸ºmacOSå®¢æˆ·ç«¯ï¼ˆå°¤å…¶æ˜¯æ—¶é—´æœºå™¨ï¼‰æä¾›æœ€ä½³çš„å…¼å®¹æ€§ã€ç¨³å®šæ€§å’Œæ€§èƒ½ã€‚

### å„é¡¹å‚æ•°è§£æ

- `vfs objects = fruit streams_xattr`: è¿™æ˜¯æ ¸å¿ƒã€‚å®ƒå¯ç”¨äº†ä¸¤ä¸ªå…³é”®çš„Sambaè™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿï¼ˆVFSï¼‰æ¨¡å—ã€‚
    
    - **fruit**: ä¸“é—¨ç”¨äºå¢å¼ºä¸è‹¹æœSMBå®¢æˆ·ç«¯å…¼å®¹æ€§çš„æ¨¡å—ã€‚
        
    - **streams_xattr**: å…è®¸å°†æ–‡ä»¶å…ƒæ•°æ®ï¼ˆå¦‚èµ„æºåˆ†å‰ï¼‰å­˜å‚¨åœ¨æ–‡ä»¶çš„æ‰©å±•å±æ€§ä¸­ï¼Œè¿™æ˜¯macOSæ‰€å¿…éœ€çš„ã€‚
        
- `fruit:model = TimeCapsule8,119`: è¿™ä¸€è¡Œè®©æ‚¨çš„SambaæœåŠ¡å™¨å‘ç½‘ç»œä¸­çš„Macè®¾å¤‡â€œä¼ªè£…â€æˆä¸€ä¸ªè‹¹æœå®˜æ–¹çš„æ—¶é—´èƒ¶å›Šï¼ˆTime Capsuleï¼‰ï¼Œè¿™ä¼šä½¿macOSæ›´æ„¿æ„ä¿¡ä»»å®ƒå¹¶å°†å…¶ä½œä¸ºæ—¶é—´æœºå™¨çš„å¤‡ä»½ç›®æ ‡ã€‚
    
- `fruit:metadata = stream` / `fruit:posix_rename = yes` ç­‰å…¶ä»– `fruit:*` é€‰é¡¹: è¿™äº›éƒ½æ˜¯å¯¹`fruit`æ¨¡å—çš„å¾®è°ƒï¼Œç”¨äºæ­£ç¡®å¤„ç†è‹¹æœç‰¹æœ‰çš„æ–‡ä»¶å…ƒæ•°æ®ã€å‘½åè§„åˆ™å’Œèµ„æºåˆ†å‰ï¼Œç¡®ä¿æ•°æ®åœ¨ä¼ è¾“å’Œå­˜å‚¨è¿‡ç¨‹ä¸­ä¸ä¼šä¸¢å¤±ä¿¡æ¯ï¼Œå¹¶æå‡è¯»å†™æ•ˆç‡ã€‚
    

**ç»“è®º**ï¼šæ‚¨å¯ä»¥æ”¾å¿ƒåœ°å°†è¿™ä¸€æ•´å—é…ç½®æ”¾åœ¨æ‚¨çš„ `smb.conf` æ–‡ä»¶çš„ `[global]` éƒ¨åˆ†ã€‚å®ƒä¸ºæ‚¨çš„æ—¶é—´æœºå™¨å¤‡ä»½æœåŠ¡å™¨æä¾›äº†åšå®å¯é çš„åŸºç¡€ã€‚

## chatgptå›ç­”ï¼š

æˆ‘å¸®ä½ æ ¸å®ä¸€ä¸‹ ğŸ‘‡

ä½ åˆ—å‡ºçš„è¿™æ®µé…ç½®ç¡®å®æ˜¯ **Gemini ç»™å‡ºçš„ Time Machine å…¼å®¹æ€§ä¼˜åŒ–**ï¼Œå®ƒä»¬éƒ½æ˜¯ Samba é’ˆå¯¹ **macOS å®¢æˆ·ç«¯ï¼ˆå°¤å…¶æ˜¯ Time Machine å’Œ Finderï¼‰** çš„æ¨èå‚æ•°ï¼Œæ¥æºä¸»è¦æ˜¯ **vfs_fruit æ¨¡å—**ï¼ˆSamba è‡ªå¸¦ï¼Œæ–‡æ¡£åœ¨ `man vfs_fruit`ï¼‰ã€‚

---

### é€é¡¹è¯´æ˜

```ini
vfs objects = fruit streams_xattr
```

- **å¿…é¡»**ï¼šå¯ç”¨ `fruit` å’Œ `streams_xattr` æ¨¡å—ï¼Œæ‰èƒ½è®© SMB æ›´å¥½åœ°æ”¯æŒ macOS çš„ HFS+/APFS ç‰¹æ€§ï¼ˆèµ„æºåˆ†å‰ã€æ‰©å±•å±æ€§ï¼‰ã€‚
    

```ini
fruit:metadata = stream
```

- å°†æ–‡ä»¶çš„ **å…ƒæ•°æ®å­˜å‚¨åœ¨æ‰©å±•å±æ€§ï¼ˆxattrï¼‰é‡Œ**ï¼Œå…¼å®¹ macOS Finder æ ‡ç­¾ç­‰åŠŸèƒ½ã€‚
    

```ini
fruit:model = TimeCapsule8,119
```

- å‘ macOS å®£å‘Šè‡ªå·±æ˜¯ä¸€ä¸ª **Apple Time Capsule è®¾å¤‡**ã€‚
    
- è¿™ä¼šè®© Time Machine è¯†åˆ«è¯¥ SMB å…±äº«ä¸ºæœ‰æ•ˆçš„å¤‡ä»½ç›®æ ‡ã€‚
    

```ini
fruit:posix_rename = yes
```

- ä½¿ç”¨ **POSIX åŸå­é‡å‘½å**ï¼Œé¿å… Finder/Time Machine å‡ºç°â€œæ–‡ä»¶æ­£åœ¨ä½¿ç”¨â€ä¹‹ç±»çš„é”™è¯¯ã€‚
    

```ini
fruit:veto_appledouble = no
```

- `.AppleDouble` æ–‡ä»¶æ˜¯ macOS ä¸ºå­˜æ”¾æ‰©å±•å±æ€§å’Œèµ„æºåˆ†å‰ç”Ÿæˆçš„éšè—æ–‡ä»¶ã€‚
    
- è®¾ç½®ä¸º `no` è¡¨ç¤ºå…è®¸å®ƒä»¬å­˜åœ¨ï¼Œé¿å… Finder æŠ¥é”™ã€‚
    

```ini
fruit:wipe_intentionally_left_blank_rfork = yes
```

- åˆ é™¤ç©ºçš„èµ„æºåˆ†å‰ï¼ˆresource forkï¼‰ï¼Œä¿æŒå­˜å‚¨å¹²å‡€ã€‚
    

```ini
fruit:delete_empty_adfiles = yes
```

- è‡ªåŠ¨åˆ é™¤ç©ºçš„ `.AppleDouble` æ–‡ä»¶ï¼Œé¿å…ç›®å½•é‡Œå †ç§¯åƒåœ¾ã€‚
    

---

### âœ… ç»“è®º

è¿™å‡ è¡Œ **éƒ½æ˜¯å®‰å…¨çš„ä¼˜åŒ–é…ç½®**ï¼Œèƒ½æé«˜ macOS ä¸ Samba çš„å…¼å®¹æ€§ï¼Œå°¤å…¶æ˜¯ Time Machineã€‚  
å»ºè®®åˆå¹¶åˆ°ä½ çš„ **TimeMachine å…±äº«é…ç½®å—**é‡Œï¼Œå’Œæˆ‘ä¹‹å‰ç»™å‡ºçš„ `fruit:time machine = yes` ä¸€èµ·ä½¿ç”¨ã€‚

---

æ¯”å¦‚æœ€ç»ˆ `[TimeMachine]` å¯ä»¥å†™æˆï¼š

```ini
[TimeMachine]
   comment = Time Machine Backup
   path = /data/smb
   valid users = tmuser
   read only = no
   browseable = no
   create mask = 0660
   directory mask = 0770

   vfs objects = fruit streams_xattr
   fruit:time machine = yes
   fruit:time machine max size = 2T

   # --- macOS & Time Machine å…¼å®¹æ€§ä¼˜åŒ– ---
   fruit:metadata = stream
   fruit:model = TimeCapsule8,119
   fruit:posix_rename = yes
   fruit:veto_appledouble = no
   fruit:wipe_intentionally_left_blank_rfork = yes
   fruit:delete_empty_adfiles = yes
```

---

# å¦å¦å¤–ï¼Œå“ˆå“ˆï¼Œchatgptç»™çš„ç­”æ¡ˆè¦ä»”ç»†æ ¸å®ï¼Œè¿™æ˜¯è§‰å¾—gptç»™çš„é…ç½®æœ‰ç–‘é—®è®©geminiæŸ¥çš„ã€‚

## æé—®ï¼š

ntlm auth = noè¿™ä¸ªé…ç½®æ˜¯ä¸æ˜¯éœ€è¦

## geminiå›ç­”ï¼š

è¿™æ˜¯ä¸€ä¸ªéå¸¸å¥½çš„é—®é¢˜ï¼Œæ¶‰åŠåˆ°è®¤è¯åè®®çš„å®‰å…¨ç»†èŠ‚ã€‚

ç­”æ¡ˆæ˜¯ï¼šåœ¨æ‚¨è¿™ä¸ªåœºæ™¯ä¸‹ï¼ˆæ ‘è“æ´¾ä½œä¸ºç‹¬ç«‹çš„æœåŠ¡å™¨ï¼ŒMacä½œä¸ºå®¢æˆ·ç«¯ï¼‰ï¼Œ**ä¸å»ºè®®é…ç½® `ntlm auth = no`**ï¼Œä½†è¿™èƒŒååŠ å¼ºå®‰å…¨æ€§çš„æƒ³æ³•æ˜¯æ­£ç¡®çš„ã€‚

æˆ‘ä»¬æ¥è¯¦ç»†è§£é‡Šä¸€ä¸‹ï¼š

### 1. NTLM Auth æ˜¯ä»€ä¹ˆï¼Ÿ

NTLM (NT LAN Manager) æ˜¯ä¸€ç§å¾®è½¯çš„è®¤è¯åè®®ã€‚å®ƒæœ‰å‡ ä¸ªç‰ˆæœ¬ï¼š

- **LanMan/NTLMv1**: éå¸¸å¤è€ä¸”æå…¶ä¸å®‰å…¨ï¼Œæ—©å·²è¢«ç ´è§£ï¼Œåº”è¯¥è¢«å½»åº•ç¦ç”¨ã€‚
    
- **NTLMv2**: æ˜¯ç›®å‰åœ¨éåŸŸï¼ˆnon-domainï¼‰ç¯å¢ƒä¸­ï¼Œä¾‹å¦‚æ‚¨è¿™å°ç‹¬ç«‹çš„æ ‘è“æ´¾æœåŠ¡å™¨ï¼Œæ‰€ä½¿ç”¨çš„**æ ‡å‡†ä¸”å®‰å…¨çš„è®¤è¯åè®®**ã€‚
    

### 2. `ntlm auth = no` ä¼šåšä»€ä¹ˆï¼Ÿ

è¿™ä¸ªé…ç½®ä¼š**å®Œå…¨ç¦ç”¨ NTLMv1 å’Œ NTLMv2 è®¤è¯**ã€‚

åœ¨å¤§å‹ä¼ä¸šç½‘ç»œä¸­ï¼Œé€šå¸¸ä¼šä½¿ç”¨æ›´é«˜çº§çš„Kerberosåè®®è¿›è¡Œè®¤è¯ã€‚åœ¨é‚£ç§ç¯å¢ƒä¸‹ï¼Œç¦ç”¨NTLMv2ä»¥å¼ºåˆ¶ä½¿ç”¨Kerberosæ˜¯åˆç†çš„å®‰å…¨ç­–ç•¥ã€‚

ä½†æ˜¯ï¼Œåœ¨æ‚¨çš„æ ‘è“æ´¾ç‹¬ç«‹æœåŠ¡å™¨ä¸Šï¼Œ**å¹¶æ²¡æœ‰é…ç½®Kerberosç¯å¢ƒ**ã€‚å› æ­¤ï¼ŒNTLMv2æ˜¯æ‚¨çš„Macå®¢æˆ·ç«¯èƒ½å¤Ÿç”¨æ¥å‘SambaæœåŠ¡å™¨éªŒè¯èº«ä»½çš„å”¯ä¸€å®‰å…¨æœºåˆ¶ã€‚å¦‚æœæ‚¨è®¾ç½®äº† `ntlm auth = no`ï¼Œå°†ä¼šå¯¼è‡´ï¼š

**Macæ— æ³•å®Œæˆèº«ä»½éªŒè¯ï¼Œæ‚¨çš„æ—¶é—´æœºå™¨å°†æ— æ³•è¿æ¥åˆ°å¤‡ä»½ç£ç›˜ã€‚**

### 3. æ­£ç¡®çš„å®‰å…¨é…ç½®æ˜¯ä»€ä¹ˆï¼Ÿ

æ‚¨çš„ç›®æ ‡æ˜¯ç¦ç”¨è€æ—§ä¸å®‰å…¨çš„åè®®ï¼ŒåŒæ—¶ä¿ç•™å¿…è¦çš„ç°ä»£åè®®ã€‚å› æ­¤ï¼Œæ­£ç¡®çš„åšæ³•ä¸æ˜¯å®Œå…¨ç¦ç”¨NTLMï¼Œè€Œæ˜¯**å¼ºåˆ¶Sambaåªä½¿ç”¨å®‰å…¨çš„NTLMv2ç‰ˆæœ¬**ã€‚

ç°ä»£çš„Sambaç‰ˆæœ¬ï¼ˆå¦‚Samba 4.11åŠä»¥åï¼‰é»˜è®¤å°±åªä½¿ç”¨NTLMv2ï¼Œä½†ä¸ºäº†ç¡®ä¿é…ç½®çš„æ˜ç¡®æ€§å’Œå‘åå…¼å®¹æ€§ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­æ˜¾å¼å£°æ˜ã€‚

### æœ€ç»ˆæ¨èçš„é…ç½®

æˆ‘ä»¬å¯ä»¥åœ¨ä¹‹å‰åˆå¹¶çš„æœ€ç»ˆä¼˜åŒ–ç‰ˆæœ¬çš„ `[global]` éƒ¨åˆ†ï¼Œ`--- è®¤è¯ä¸å¯†ç  ---` è¿™ä¸ªåŒºåŸŸï¼Œå†å¢åŠ ä¸€è¡Œæ¥æ˜ç¡®è¿™ä¸€ç‚¹ã€‚

è¿™æ˜¯æ›´æ–°åçš„ `[global]` éƒ¨åˆ†ï¼Œæ·»åŠ äº† `ntlm auth = ntlmv2-only`ï¼š

Ini, TOML

```
[global]
# --- åŸºæœ¬èº«ä»½ä¸ç½‘ç»œè®¾ç½® ---
   workgroup = PI4BHOUSE
   server string = %h Samba Server (Raspberry Pi)

# --- ç½‘ç»œå®‰å…¨ä¸æ¥å£ç»‘å®š ---
   hosts allow = 192.168.1. 127.
   hosts deny = 0.0.0.0/0
   disable netbios = yes

# --- åè®®ä¸åŠ å¯†å®‰å…¨ ---
   server min protocol = SMB3
   smb encrypt = required

# --- æ—¥å¿—è®°å½• ---
   log file = /var/log/samba/log.%m
   max log size = 1000
   logging = file
   panic action = /usr/share/samba/panic-action %d

# --- è®¤è¯ä¸å¯†ç  ---
# æ˜ç¡®Sambaåªæ¥å—NTLMv2è®¤è¯ï¼Œæ‹’ç»ä¸å®‰å…¨çš„NTLMv1/LanMan
   ntlm auth = ntlmv2-only

   server role = standalone server
   obey pam restrictions = yes
   unix password sync = yes
   passwd program = /usr/bin/passwd %u
   passwd chat = *Enter\snew\s*\spassword:* %n\n *Retype\snew\s*\spassword:* %n\n *password\supdated\ssuccessfully* .
   pam password change = yes
   map to guest = never
   usershare allow guests = no

# --- å…¨å±€ macOS & Time Machine å…¼å®¹æ€§ä¼˜åŒ– ---
   vfs objects = fruit streams_xattr
   fruit:metadata = stream
   fruit:model = TimeCapsule8,119
   fruit:posix_rename = yes
   fruit:veto_appledouble = no
   fruit:wipe_intentionally_left_blank_rfork = yes
   fruit:delete_empty_adfiles = yes
```

**æ€»ç»“ä¸€ä¸‹**ï¼š

- `ntlm auth = no`: **ä¸è¦ç”¨**ã€‚å®ƒè¿‡äºä¸¥æ ¼ï¼Œä¼šç ´åæ‚¨ç¯å¢ƒä¸­çš„æ­£å¸¸è®¤è¯ã€‚
    
- `ntlm auth = ntlmv2-only`: **æ¨èæ·»åŠ **ã€‚å®ƒæ˜ç¡®äº†æ‚¨çš„å®‰å…¨æ„å›¾â€”â€”åªå…è®¸NTLMv2ï¼Œä»è€Œç¦ç”¨äº†æ‰€æœ‰ä¸å®‰å…¨çš„æ—§ç‰ˆè®¤è¯åè®®ï¼ŒåŒæ—¶ä¿è¯äº†ä¸macOSå®¢æˆ·ç«¯çš„å…¼å®¹æ€§ã€‚